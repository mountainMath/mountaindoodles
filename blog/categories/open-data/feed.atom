<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: open data | Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/blog/categories/open-data/feed.atom" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2016-08-18T08:02:00-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[What's up with RT?]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/04/rt/"/>
    <updated>2016-08-04T13:18:51-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/04/rt</id>
    <content type="html"><![CDATA[<p>RT is Vancouver&rsquo;s zoning for duplexes. Over time, various areas have been zoned to allow duplexes. Examples are
Kits Point, much of Point Grey Road reaching up to Broadway, much of Granview-Woodlands, parts of Mount Pleasant and many
other areas.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=4&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt_teardowns.png" style="width:50%;float:right;margin-left:10px;"></a>
Recently I have had some interesting conversations <a href="https://twitter.com/fixbced/status/748196970783637504">on Twitter regarding RM-6</a>
and over BBQ dinner about RT-7. Then the
<a href="http://vancouver.ca/home-property-development/grandview-woodland-community-plan.aspx">Granview-Woodland plan</a>
passed by council, and it contains a curious provision of reducing the outright FSR for the
RT-zoned properties from 0.6 to 0.5.</p>

<p>All of which got me thinking. What is RT supposed to accomplish, how does the diverse RT-zoning rules influence development
and how is RT overall performing?</p>

<!-- more -->


<p>To make things complicated many RT zoning rules contain provisions to allow for higher FSR, and more than two units,
under the &ldquo;heritage preservation&rdquo; program. Most people like the multi-plex developments that come out of this process,
but the road there is quite adurous. Permitting takes a long time and is marred by uncertainty. Those projects are
done by small developers, that are ill-equipped to deal with risky and drawn-out rezoning processes.</p>

<p>These would be great projects carried out by small developers that lead to gentle and affordable density,
as this kind of re-development does not require land-assembly and does not lead
to crazy land-value lifts that require CACs to claw back some of that value rise
<a href="http://doodles.mountainmath.ca/blog/2016/04/01/on-dirt-and-houses/">as we explained before</a>.</p>

<p>We have some ideas what a refreshed RT (and RS) should look like, and there are
<a href="https://pricetags.wordpress.com/2016/07/29/open-letter-on-the-downzoning-of-grandview-woodland-rt/">some efforts to push for changes</a>.
We leave the details of this to the experts and take a little field expedition to
see how the different flavours of RT (and RM) perform in data.</p>

<h3>Why RT?</h3>

<p>One central question to ask is: What is the purpose of RT (or any) zoning? The initial idea was to allow higher density
than RS, with two stratified properties on one lot. But since the creation of RT the RS zoning has undergone significant
changes and allows, in many cases, for higher FSR and higher unit count, although not stratified. In much of RS three
units are allowed on each lot, the main house, a secondary suite and a laneway house.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=5&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rs_rt_land.png" style="width:50%;float:left;margin-right:10px;"></a>
So how does RT perform in the wild? There seems to be little effect RT vs RS zoning has on land values. The
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=6&amp;mapBase=2">boundaries between RS and RT</a>
can&rsquo;t be discerned from a
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=5&amp;mapBase=2">land value map of all residential properties in RS, RT (and First Shaugnessey) zones</a>.</p>

<p>How good are RT lots at realizing &ldquo;zone capacity&rdquo;, that is how many of the historically SFH get turned over into duplexes,
or in some cases multi-plexes (through the heritage presercation program)?
That depends as the following graph shows.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_sfh" style="height:200px;max-width:640px;" data-url="/data/zone_sfh.json"></div>
</div>


<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/types_rt.png" style="width:50%;float:left;margin-right:10px;"></a>
We can also study this by mapping out
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">all residential lots in RT zones</a>,
and color them depending if they are single family lots, duplexes or multi-plexes.</p>

<p>Some RT areas are essentially indistinguishable from RS areas, they are almost entirely comprised of single family lots.
A good example is the
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-4,residential]&amp;zoom=14&amp;lat=49.2733&amp;lng=-123.0646&amp;layer=20&amp;mapBase=2">RT-4, most of which is in Grandview-Woodlands</a>.
And being in RT rathern than RS they often don&rsquo;t even get the benefits of a laneway house. Coach houses, which are legal
in many RT areas and could be stratified, come with such onerous side setbacks that they are very hard to build on
regular lots.</p>

<p>There is a lot of untapped &ldquo;zoned capacity&rdquo;. Similarly, some of the
newer RM zones show little appetite for realizing &ldquo;zoned capacity&rdquo;, possibly due to the added difficulty of having to
assemble lots to do so.</p>

<p>One can argue about whether this is good or bad. Or one can look at the variation between the different types of RT and RM
zones to see what causes the difference.</p>

<h3>Downzoning</h3>

<p>To understand how downzoning works we want to consider two different types on analysis. One is to look at what happened
after RS zone was changed to reduce site coverage in the 1980 in response to concerns about &lsquo;monster homes&rsquo;. We ran
an analysis using LIDAR data to understand the effect on the physical form of SFH and found that while site coverage
indeed decreased sharply, the <a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">bulk of the building remained unchanged</a>.
and the rule change seems to have done little in easing concerns about &lsquo;monster homes&rsquo;, it simply changed some of the
parameters determining what &lsquo;monster homes&rsquo; look like.</p>

<p>Another way to look at the matter is to compare how re-development happened in difference zones. This is very hard, since
there are many factors other than zoning that determine if a building gets re-developed. To get some idea we compiled two
numbers for each of the RS, RT and RM zones (ignoring some of the delicacies in the zoning code and lumping together all
sub-zones with the same leading number. So for example we lumped RT-4, RT-4A, RT-4N and RT-4AN into one category we simply
label &ldquo;RT-4&rdquo;.</p>

<p>First we check how many residential properties got re-developed since 2000.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_redevelopment" style="height:200px;max-width:640px;" data-url="/data/zone_redevelopment.json"></div>
</div>


<p>Next we take a look what percentage of the existing residential stock is in immediate danger of being torn down, using the
<a href="http://doodles.mountainmath.ca/blog/2016/01/18/redevelopment/">methodology developed earlier</a>.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_teardown" style="height:200px;max-width:640px;" data-url="/data/zone_teardowns.json"></div>
</div>


<p>While there is some correspondence between re-development activity and ratio of teardowns, there are a number of notable
exceptions. RT-1 and RM-9 stand out, but these are
<a href="https://mountainmath.ca/map/assessment?filter=[zoneE_RM-9_RT-1]&amp;zoom=14&amp;lat=49.2146&amp;lng=-123.1282&amp;layer=5&amp;mapBase=2">oddball cases with just a few properties</a>.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/new_types_rt.png" style="width:50%;float:right;margin-left:10px;"></a>
We can also map just <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">residential properties in RT that were re-developed since 2000</a>
and colour them by SFH, Duplex and Multi-plex status. We can clearly see how some RT areas, like RT-7, don&rsquo;t see much
re-development, others, like RT-6 see mostly multi-plexes being developed. Some zones, like RT-10, 11, 12 are too new
to be judged on development happening since 2000. For example, zooming in on
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT-10,residential,years_2009]&amp;zoom=15&amp;lat=49.2485&amp;lng=-123.0734&amp;layer=20&amp;mapBase=2">developments in RT-10 since 2009 paints a very different picture</a>.</p>

<p>There is lots of stuff to explore, but for today I want to look at RT-7 and RT-6 in more detail.</p>

<h4>RT-7</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&zoom=15&lat=49.2617&lng=-123.1654&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-7.png" style="width:50%;float:left;margin-right:10px;"></a>
A much more interesting case is RT-7, with 35% of properties teardowns but only 4.1% of properties re-developed since 2000.
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=4&amp;mapBase=2">Looking at the map</a>
we see that RT-7 is comprised of two pockets on the west side, and the teardown candidates stand out in red and orange.
Filtering further to see what
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential,years_2000]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=20&amp;mapBase=2">has been re-developed since 2000</a>
we see that, considering the size of the two pockets, re-development favours the eastern pocket near 16th and Arbutus. We
can clearly see that that the eastern pocket has an overall more valuable building stock, although it is not clear if that
is due to higher rates of re-development or for other reasons, for example the presence of some slightly larger lots. We
also note that re-development does produce duplex units and even some multi-plex.</p>

<p>So what is going on here? Looking at the <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-7.pdf">RT-7 zoning</a> we
see that the area has been downzoned to 0.4 FSR as was rencently pointed out to me, which can conditionally be upzoned
to 0.6 FSR. Additionally, there are caps on the number of units per hectar to further restrict density.</p>

<h4>RT-6</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&zoom=16&lat=49.2606&lng=-123.1097&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-6.png" style="width:50%;float:right;margin-left:10px;"></a>
Another interesting example is RT-6. RT-6 has seen modest levels of re-develpment and has a <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2606&amp;lng=-123.1097&amp;layer=4&amp;mapBase=2">relatively healthy building
stock</a>.
What&rsquo;s even more interesting is that it contains
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">many multi-plexes</a>.
And more importantly, <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential,years_2000]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">developments since 2000 have mostly produced multi-plexes</a>.</p>

<p>Prime examples of the <em>gentle density</em> that we keep hearing about. I would say that something is working very well here.</p>

<p>So what&rsquo;s the difference? In contrast to RT-7 <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-6.pdf">RT-6 zoning</a> allows for 0.6 FSR
outright, conditionally increased to 0.75. But there are other important differences too. The RT-7 lots are typically
smaller with many at about 340m&sup2; compared to the 580m&sup2; typical RT-6 lots.
(Although RT-7 also contains some 580m&sup2; lots).</p>

<h3>Conclusion</h3>

<p>Does downzoning work? It depends what the goal is. Looking at the RT-7 example, downzoning has slowed re-development compared
to other areas in the city, but it also lead to a deterioration in building stock in RT-7. This is a stop-gap measure,
eventually that lower value building stock will get re-developed.</p>

<p>The combination of larger lots and the heritage retention program in the RT-6 zoning seems to work in producing
gentle density, except that the permitting process takes too long and it is not immediately clear what purpose the
heritage preservation has that allows stripping the building down to the studs and possibly moving it to the front and
then building an infill in the back. There must be a better way to deal with concerns behind
heritage preservation (not much is &ldquo;preserved&rdquo; in this process) and at the same time cut down on the time it
takes to jump through all the permit hoops involved.</p>

<p>It is clear that RS and RT (and RM) zoning would hugely profit from a clearer vision what these zonings should accomplish
and by using data to benchmark how these targets are met.</p>

<div><script>

function bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter,rangeLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d");
    if (!rangeLabelFormatter) rangeLabelFormatter=rangeFormatter;
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;

d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  
  var container=d3.select(div.node().parentNode);
  container.selectAll('.legend.no-margin').remove();
  var legend=container.append('div').attr('class',"legend no-margin");
  legend.append('p').html('<i style="background:'+graphData.color + '"></i>' + graphData.label +  '<span style="float:right;margin-right:10px;" id="' + graphData.class+'_value"></span>');
  
  x.domain(data.map(function(d) { return d.date }));
  y.domain([0, d3.max(data, function(d) { return d.count; })]);
  
  var domainTickValues=[];
  var skip=Math.round(40/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", graphData.class + " bar")
      .style("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.count); })
      .attr("height", function(d) { return height - y(d.count); })
      .on('mouseover',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('click',function(d){
       d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('touch',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('mouseout',function(){d3.select('#'+this.classList[0]+'_value').text('')});

      
});

}



var percentageFormatter=d3.format(".1%");
var textFormatter=function(d){return d};
var teardownLabelFormatter=function(d){return percentageFormatter(d) + " teardowns"};
var sfhLabelFormatter=function(d){return percentageFormatter(d) + " SFH"};
var redeveopmentLabelFormatter=function(d){return percentageFormatter(d) + " built since 2000"};
bar_graph(d3.select("#graph_redevelopment"),false,textFormatter,percentageFormatter,textFormatter,redeveopmentLabelFormatter);
bar_graph(d3.select("#graph_teardown"),false,textFormatter,percentageFormatter,textFormatter,teardownLabelFormatter);
bar_graph(d3.select("#graph_sfh"),false,textFormatter,percentageFormatter,textFormatter,sfhLabelFormatter);
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mixing Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data/"/>
    <updated>2016-07-06T09:19:04-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data</id>
    <content type="html"><![CDATA[<p>Census data is very rich and with <a href="https://censusmapper.ca">CensusMapper</a> we now have about 1 billion data points right at
our fingertips. And we have managed to open up some of our interfaces for everyone to <a href="http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone/">explore data and make their own maps
and freely share them</a>.</p>

<p>Things really get interesting when one mixes custom data with census data. While, at this point, these are not part of
the freely available CensusMapper functionality we still wanted to share what can be done.</p>

<p>At CensusMapper we have developed three basic ways to rapidly mix custom data with census data. So this is really three
blog posts in one.</p>

<!-- more -->


<h3>1. Overlay Mapping</h3>

<p>First up, advanced users can upload custom datasets and map them on top of census data.
<a href="http://doodles.mountainmath.ca/images/restaurants_2.png"><img  src="http://doodles.mountainmath.ca/images/restaurants_2.png" style="width:50%;float:right;margin-left:10px;"></a>
For example, we took a
<a href="http://data.vancouver.ca/datacatalogue/businessLicence.htm">business license dataset</a> from the City of Vancouver open
data catalogue, filtered it by the <em>BusinessType</em> field to only include businesses starting with &ldquo;Restaurant&rdquo; or
&ldquo;Liquor Establishment&rdquo; and uploaded them to CensusMapper to map it on top of census data. We have used a map
for <em>median age</em> that was <a href="https://twitter.com/jofu_/status/750564269796823041">recently created using CensusMapper&rsquo;s free public interface</a>
(have you made <a href="https://censusmapper.ca/maps/new">your own CensusMapper map</a> yet?), we have faded out areas outside of
Vancouver and coloured <em>Liquor Establishments</em> in red and <em>Restaurants</em> in blue.</p>

<p>Giving a visual impression of your own dataset in relation to census data is the first step to location analysis.</p>

<h3>2. Populate Custom Data with Census Data</h3>

<p>Next
up is to populate your own dataset with census data for further analysis. For the restaurants, we may be interested in
attaching population estimates in 5 minute walking distance from each location. We might also be interested in specific
age brackets, or numbers of recent immigrants
from specific countries that we may want to target with a new restaurant, or maybe even     income data.</p>

<p>This can be a time consuming and painful process,
but we have automated this at CensusMapper.</p>

<p>To showcase how this works we will show an example using elementary school catchment areas in the City of Vancouver. The
areas we have (from the <a href="http://data.vancouver.ca/datacatalogue/publicPlaces.htm">Vancouver Open Data Catalogue</a>) are
quite out of date, but for the purpose of this example they work as we will compare them to 2011 census data. We will look at the
<a href="https://censusmapper.ca/maps/419">school aged population</a> in each catchment.</p>

<!--
The general census release data does not fit our task perfectly, the census splits by age in early May 2011 and not by
year born and it does not have fine enough age brackets to estimating accurate school catchment numbers.
[BC Stats](http://www.bcstats.gov.bc.ca/StatisticsBySubject/Demography/PopulationEstimates.aspx) has finer age brackets
computed to school district (not catchment) boundaries, but their estimates are ridiculously far off of census numbers
when using matching age brackets and years that their usefulness is highly questionable. 
-->


<p><a href="http://doodles.mountainmath.ca/images/e-schools.png"><img  src="http://doodles.mountainmath.ca/images/e-schools.png" style="width:50%;float:left;margin-right:10px;"></a>
Using the visual overlay we notice that the catchment areas do fit boundaries of Dissemination Areas shown on the map
reasonably well, with some exceptions. The same cannot be said for Census Tracts, we can be reasonably confident that
Dissemination Area data is fairly accurate.</p>

<p>Next we use the built-in CensusMapper functionality to automatically populate the catchment areas with the census
data we are interested
in. When Dissemination Areas don&rsquo;t line up with the catchment boundaries we go down to Dissemination Blocks to estimate
how many children live on what side of the catchment boundary. We
<a href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/">previously explained this process in more detail</a>, the result is
a spreadsheet with the population data by age for each catchment area.</p>

<div id='schools'></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/colorbrewer.js" charset="utf-8"></script></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/school_bar_graph.js" charset="utf-8"></script></div>


<p>Here we show the results by school, the select element can be used to select any school of interest. The whole process
of populating the school data with census data just required uploading the catchment boundaries and selecting which
variables to attach.</p>

<h3>3. Custom Census Data Mapping</h3>

<p>Sometimes it is not practical to map custom data on CensusMapper. Maybe the custom data is too sensitive to be uploaded
to CensusMapper servers. Or it is quite complex and is better mapped separately. So we created an API to pull in
census data from CensusMapper to easily show census data on custom maps. And dynamically mix in your own data. As an
example we mix census data with data from BCAssessment, again obtained through the
<a href="http://vancouver.ca/your-government/open-data-catalogue.aspx">Vancouver Open Data Catalogue</a> (and enriched with
<a href="http://www.metrovancouver.org/data">open data from Metro Vancouver</a>).
For demonstration purposes take Dissemination Area
geographies and Dwelling Characteristic data from CensusMapper and mash it up with our
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2604&amp;lng=-123.1417&amp;layer=14&amp;mapBase=2">processed assessment data</a>
to explore the <a href="http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use/">differences in how single family properties are classified</a>.</p>

<p><a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=0" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_unit_count.png" style="width:50%;float:right;margin-left:10px;"></a>
For example we can <a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=0">compare BC Assessment single family lot count to Stats Canada unit count</a>
in the dissemination areas
that are exclusively made up of single family lots. This gives an indication of how many suites and laneway houses there
are in those areas. The census is prone to undercount units, but still does a better job at estimating them than other data sources,
like the city or BC Assessment.</p>

<p>One of the reasons why census unit counts come up higher than other methods is that the census also counts illegal units,
which naturally are not part of other official government counts. There are different reasons why a suite may be illegal:
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=5" target="_blank"><img  src="http://doodles.mountainmath.ca/images/illegal_units.png" style="width:50%;float:left;margin-right:10px;"></a>
It could simply be that the owner has not made the effort to register it. Or the suite may not be up to code.
And in some cases, a property may have more than one suite in the main building, which is illegal in the City of Vancouver.
The latter ones we can pick out in census data, since a house with two secondary suites &ndash; so three dwelling units in one building in
total &ndash; is classified as being an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. So, in census dissemination areas that
only have duplex or single family lots as residential land uses based on assessment and land use data, we can look for
how many dwelling units the census places in an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. And
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=5">map them</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SDH Zoning and Land Use]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use/"/>
    <updated>2016-06-17T09:34:37-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use</id>
    <content type="html"><![CDATA[<p>Recently the question around the amount of space taken up (exclusively) by single detached houses has show up on my
Twitter feed citing that
SFH take up <a href="https://twitter.com/WayneFougere/status/743211599821844481">70%</a>,
<a href="https://twitter.com/MitchellReardon/status/739957295564476416">66%</a>,
and <a href="https://twitter.com/karensawa/status/743235428011020288">57%</a>,
<a href="http://www.cknw.com/2016/06/02/the-lynda-steele-show-bob-rennie-on-supply-and-demand/">56% (timestamp 3:50)</a>.
I personally have thrown in
<a href="https://twitter.com/vb_jens/status/738608945741238272">34%</a> as a contender. And, just for the fun of it, by the end of
this post I will have thrown 33% and 28% and my favorite, 81%, into the mix.</p>

<p>What&rsquo;s going on, how can there be such a large range of estimates for what seems to be a simple question? The answer
lies in the details of what exactly the question is asking, all of the above numbers are correct answers to one particular
version of very similar questions.</p>

<h3>TL;DR</h3>

<p>The takeaway I think is most useful for general purposes:</p>

<pre><code>35% of all households live on single family and duplex properties
making up 81% of Vancouver's residential land, while the     
remaining 65% of households live on 19% of the residential land. 
</code></pre>

<!-- more -->


<p>There are two fundamental ways to attack the question. One is through zoning, that is to look at area where only SDH can
be built. The other is through land use, that is looking at what area is currently occupied by SDH lots.</p>

<h3>Single Detached Houses</h3>

<p>First we need to understand what we mean by single detached house. There are two common, but quite different definitions
out there. One stems from the zoning code and refers to a property that is not stratified and has a single main structure
on it, possibly with one suite, and possibly a laneway house. This is the definition most commonly used. When someone says
they own a single family house, this is what they are talking about. Let&rsquo;s call them <em>single detached properties</em>.
There are around 75,000 of these in the City of Vancouver.</p>

<p>Stats Canada employs a different definition. To them a <em>single detached dwelling</em> is single dwelling unit comprised of a
free-standing (detached) structure. A <em>single detached property</em> may contain exactly one dwelling unit, in which case
Stats Canada would also call it a <em>single detached dwelling</em>. If the house has a secondary suite, Stats Canda would
classify it as a <em>duplex</em>. If it has a laneway house, Stats Canada would classify the laneway house as a separate
<em>single detached dwelling</em>. Stats Canada reports 47,530 <em>single detached dwellings</em> in the City of Vancouver.</p>

<p>Because of this discrepancy, sometimes it is useful to look as single family houses and duplexes combined. Especially
if one wants to mix in census data to for example look at the number of households that live in these dwellings. While
there are about 75,000 <em>single detached properties</em> in Vancouver, it is fair to assume that there are significantly more
than 75,000 households living on these properties once we account for secondary suites and laneway houses.</p>

<h3>Zoning</h3>

<p><a href="http://vancouver.ca/files/cov/Zoning-Map-Vancouver.pdf" target="_blank"><img  src="http://doodles.mountainmath.ca/images/zoning_van_pdf.png" style="width:50%;float:right;margin-left:10px;"></a>
Vancouver is divided up into zones that determine what can (and cannot) be legally built on the land.
If one is primarily concerned with the area of land that where only single detached houses can be built, then zoning is
the right metric to look at.</p>

<p>There are two zones that essentially only allow single family houses as residential properties, the RS zones and,
to some extent, First Shaughnessy. Each of these has it&rsquo;s own pitfalls. The first issue is that parks are generally zoned
RS, but one cannot build single family homes in parks. Moreover, while RS does not allow residential land uses other
than single detached houses, it does allow for other land uses, like parks, schools, assisted living and other institutional
uses. So RS zoned land area is a poor proxy for the question of where single family houses could be built. At the very
<a href="https://mountainmath.ca/map/assessment?zoom=13&lat=49.2517&lng=-123.1232&layer=6" target="_blank"><img  src="http://doodles.mountainmath.ca/images/zoning_van.png" style="width:50%;float:left;margin-right:10px;"></a>
least we should exclude parks from the equation, but probably also schools and other institutional land uses. After all,
it is delusional to think that even if a school were to close down and the land be sold for development that single
detached dwelling would be built on that land. Next comes the question if we should only include the lots that single
family homes could be built on, or also include the surrounding roads. After all, the roads are needed to serve the lots.
But they also serve the schools and parks, so maybe only a certain portion of the roads should be included? It gets messy,
the second image shows only non-institutional and non-park properties (no roads) coloured by zone, interactive version
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2517&amp;lng=-123.1232&amp;layer=6">here</a>.</p>

<p>The numbers between 70% and 56% mentioned up top are (probably) derived using some version of zoned area, possibly excluding
parks or schools for some, but including roads within RS zoning. It is easy to underestimate
the space roads take up in the City of Vancouver, overall roads right of ways make up 28% of City of Vancouver land.</p>

<p>At the end of this though process, we are starting to gravitate away from zoning and toward land use.</p>

<h3>Land Use</h3>

<p>We can simplify the discussion by asking how much space currently is taken up by single family properties. The answer
to this is 33%. I have previously written about the
<a href="http://doodles.mountainmath.ca/blog/2016/02/29/land-use/">land use breakdown</a> for Metro Vancouver municipalities, but
single detached homes were not broken out separately, single detached and duplex properties combined take up 34% of
Vancouver&rsquo;s land. One can play the numbers a little more, maybe only look at single detached properties within RS zoning.
That puts the number at 28%. Throw in Shaugnessy and it rises to 29%. Recall that this excludes roads right of way.</p>

<p><a href="https://mountainmath.ca/land_use/map?zoom=13&lat=49.2544&lng=-123.1268&mu_filter=[%22VA%22]&lu_filter_n=[]" target="_blank"><img  src="http://doodles.mountainmath.ca/images/land_use_van.png" style="width:50%;float:right;margin-left:10px;"></a>
Here is an interactive (data-heavy) map that shows the land use for
<a href="https://mountainmath.ca/land_use/map?zoom=13&amp;lat=49.2544&amp;lng=-123.1268&amp;mu_filter=[%22VA%22]&amp;lu_filter_n=[]">just for the City of Vancouver (plus Musqueam 2)</a>.</p>

<h3>Multi-Unit Housing</h3>

<p>One can ask the same question about other housing types, and we can read off the numbers from the
<a href="http://doodles.mountainmath.ca/blog/2016/02/29/land-use/">land use breakdown</a>. 3.2% of land is taken up with low rise
apartments, 1.9% with townhouses, 1.2% with high rise, 0.3% by non-market housing, 0.9% by mixed use low rise and 0.7%
by mixed use high rise. Adding all of this up we get that 8.2% of land is taken up by housing that is not single detached
or duplex. And it also includes some commercial space in the mixed use developments.</p>

<p>That means that overall in Vancouver 42.2% of the land is used for residential purposes, 81% of which is occupied by
single detached and duplex properties and the remaining 19% is occupied by all other building forms.</p>

<h3>Share of Households in Different Land Uses</h3>

<p>We may be interested in the population density these different land use patterns entail. That&rsquo;s where things get a little
tricky, we will turn to the census for answers. From the standard census releases we can only discern the share of
dwellings that are single detached and duplex properties combined, and that number is 93,370 dwelling units. Overall
there are 264,575 dwelling units, so single family and duplex units make up 35% of all dwelling units in CoV. Glossing
over the issue that some of these may not be occupied we conclude that 35% of all households live on single family and
duplex properties making up 81% of Vancouver&rsquo;s residential land,
while the remaining 65% of households live on 19% of the residential land.</p>

<h3>Fine Print</h3>

<p>There are a number of issues with the data that might change the numbers slightly, but not by much. The first is that
the land use dataset I use lump the City of Vancouver together with Musqueam 2. That slightly changes the land use mix
and areas reported, but the effect on all numbers mentioned here is very small. Next up is the number of dwelling units
on single detached or duplex properties. The census number is likely to under report some secondary suites (although it
captures more than BCAssessment does), and properties with more than one secondary suite (so some illegal suites) will
show up as an apartment building in census data. Moreover, the census data is from 2011, the land use data we used is
about a year old, and we have manually adjusted for some recent upzoning. So there is some give or take in the numbers,
I would not expect more than a one percent move in the numbers I reported as a result.</p>

<h3>Further Questions</h3>

<p>This does not answer the question what percentage of the population lives on single family or duplex properties. To
estimate that one would have to first estimate the number of people per houshold for the different land uses, as we
expect them to differ significantly. One can start exploring how the number of people per dwelling unit varies
<a href="https://censusmapper.ca/maps/391">on CensusMapper</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FSR]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/20/density/"/>
    <updated>2016-05-20T22:51:29-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/20/density</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/map/assessment?layer=16" target="_blank"><img  src="http://doodles.mountainmath.ca/images/fsr.png" style="width:50%;float:right;margin-left:10px;"></a>
Ever since I played with the <a href="http://mountainmath.ca/vancouver_lidar/map">LIDAR-generated building height data</a> I thought
that I should use that to map gross floor area (GFA) and floor space ratio (FSR). Gross floor area is the total floor area
inside the building envelope. So for a three storey building, it is the area of the footprint times three.
Floor space ratio is the GFA divided by the area of the parcel it sits on. There are several reasons why this may be
interesting.</p>

<p>GFA is the currency of the developer. Especially once we enter the world of apartment or commercial buildings,
gross floor area is directly proportional to the amount of money a developer can charge for a property, either when stratified
and sold or when rented out.</p>

<p>FSR on the other hand is a measure of density, and it is the currency of the zoning code. Height and site coverage are
also regulated in the zoning code and there is an obvious relationship to FSR. But because GFA is so important to the
developer, FSR usually receives more attention in public discussions.</p>

<p>Read on or <a href="https://mountainmath.ca/map/assessment?layer=16" target="_blank" class='btn btn-default'>head straight for the interactive map</a> to browse
Vancouver by FSR. Read the disclaimer at the bottom before using any data for purposes other than general reference.</p>

<!-- more -->


<h3>Maximum Allowable FSR and Spot Zoning.</h3>

<p>The maximum allowable FSR is set by the zoning code. Because land is so valuable in Vancouver, most people will try
to maximize GFA when building a new building, so they typically go right up to the maximum allowable FSR. Previously we have
<a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">examined the effects of various related metrics like height and site coverage</a>
for single family homes.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=15&lat=49.2599&lng=-123.1583&layer=6" target="_blank"><img  src="http://doodles.mountainmath.ca/images/spot-zoning.png" style="width:30%;float:right;margin-left:10px;"></a>
At least this is how it works for RS/RT zones. If you are looking to develop a different property, say a mixed use or
an apartment building or commercial building you will probably be looking to up-zone. That is, you will try to convince
the city (and the local population) to allow you to build more GFA than zoning would allow. If successful the city will
create a new zone just for your property and ask for some compensation in form of CACs (aiming to recoup about 80% of the
uplift in value the up-zoning creates) in return. That process is called
spot zoning and it can be seen in form of the little &ldquo;Comprehensive Development&rdquo; zones that are visible as yellow
sprinkles in the otherwise quite uniform zones on the map.</p>

<p>In reality the process of up-zoning a property is a lot more complex, arduous and time consuming, which favours larger
developers with deep pockets that can take the risk and sit out the long process of eventually obtaining higher GFA. One
of the many reasons why the &ldquo;missing middle&rdquo; is missing.</p>

<h3>Mapping Density</h3>

<p><a href="https://censusmapper.ca/maps/302#16/49.2375/-123.1573" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_people.png" style="width:30%;float:left;margin-right:10px;"></a>
From Census data we know the <a href="https://censusmapper.ca/maps/302">nighttime density</a>, that is where people live and sleep.
But we don&rsquo;t know where they are
during the daytime.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=16&lat=49.238&lng=-123.154&layer=16" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_fsr.png" style="width:30%;float:right;margin-left:10px;"></a>
FSR is also often seen as such a measure of density, although it only focuses on density on property parcels and neglects
all the space between parcels, like roads right of ways and parks.</p>

<p>In mostly residential neighbourhoods the two densities correspond quite closely, but in areas with large commercial buildings
(nighttime) population density can be quite low while FSR is very high as can easily be seen by comparing the two maps.</p>

<p><a href="https://mountainmath.ca/assessment_gl/map?zoom=16&lat=49.2384&lng=-123.1567" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_tax.png" style="width:30%;float:left;margin-right:10px;"></a>
<a href="https://mountainmath.ca/assessment_gl/map">Tax density</a>, that is property taxes collected per area, give another view of
&ldquo;density&rdquo; in the city that highlights relative property values and emphasises commercial land use that pays five times
the residential tax rate.</p>

<p>There are lots of other measures of density that are important for different purposes, for example <a href="http://mountainmath.ca/census3">household density</a>
(in full 3D, requires modern computer),
<a href="https://censusmapper.ca/maps/359">the density of private dwelling units</a> or <a href="https://censusmapper.ca/maps/35">toddler density</a> just to name a few.</p>

<h3>Next Steps</h3>

<p>There are several directions I want to take this. Now that FSR is available for all properties, I can
compare purpose built rental buildings to strata buildings. For example, in my
<a href="http://mountainmath.ca/assessment/split_map">Buildings and Dirt map</a> I can&rsquo;t integrate purpose
built rentals because I don&rsquo;t know how many rental units they have. The assessment data from the Vancouver Open Data portal,
does not have that information, and BC Assessment won&rsquo;t share it (in a hassle-free way). But I can make a similar map based on GFA instead of
number of units and examine
how GFA effect land and building values across different land uses. And in many ways GFA may be a better unit for comparisons
than number of suites.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=13&lat=49.2488&lng=-123.1211&layer=17&filter=res" target="_blank"><img  src="http://doodles.mountainmath.ca/images/value_per_gfa.png" style="width:50%;float:right;margin-left:10px;"></a>
Or I can just make a <a href="https://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2684&amp;lng=-123.1354&amp;layer=17">straight-up map of total assessed value per GFA</a>.
And maybe add a filter to only show this for <a href="https://mountainmath.ca/map/assessment?zoom=13&amp;lat=49.2488&amp;lng=-123.1211&amp;layer=17&amp;filter=res">residential and mixed use units</a>
like in the image if that&rsquo;s what we are interested in.</p>

<p>Another interesting application is to use this data to do something along the lines of this
<a href="http://www.nytimes.com/interactive/2016/05/19/upshot/forty-percent-of-manhattans-buildings-could-not-be-built-today.html?_r=0">excellent analysis the New York Times published</a>
for Vancouver. FSR, next to building heights and lot coverage that I
<a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">have already analysed from a different angle</a>,
is an important metric to detect buildings that could not be rebuilt under regular zoning.</p>

<p>Lastly, having data on building GFA, together with assessment open data, allows for reverse-engineering of the GFA of individual
strata units. That makes the analysis of condo assessment data more meaningful as we can analyse assessed condo values by
unit size. One of the reasons why we are only talking about single family homes (or in some cases RS zoned homes) and
not condos is that it is very easy to compare single family homes. But comparing condos doesn&rsquo;t make much sense unless
one also has data on the size of each condo. And this has probably focused the public debate too much on single family
homes when we should be paying a lot more attention to condos. And purpose built rental units.</p>

<h3>Disclaimer</h3>

<p>The FSR was estimated using coarse building data extracted from LIDAR data. The motivation was to use the FSR for aggregate
analysis and not for getting accurate estimates of individual buildings.</p>

<p>Secondary buildings like garages or laneway houses are only inconsistently detected and mapped. The data is from 2009,
buildings built after that are greyed out.</p>

<p>The algorithm to compute FSR
from this building data is rather crude and only makes rudimentary attempts to adjust for varying floor heights of buildings
different for land uses, overhangs and eyebrows and dealing with pitched roofs or mechanical units.</p>

<p>Building data was clipped to property polygons to deal with cases of buildings spanning several legal lots or not properly
separated.</p>

<p>The FSR computed only roughly resembles the FSR defined in building codes. In particular our model with grossly
overestimate the FSR for buildings with overhanging features like
the Lookout on the Harbour Centre.</p>

<p>Block level aggregates will underestimate FSR in the presence of properties excluded from the FSR calculation.</p>

<p>Do not be use the FSR estimates as an authoritative source for any individual building FSR.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Physical SFH Form Over Time]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/"/>
    <updated>2016-03-05T22:58:06-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time</id>
    <content type="html"><![CDATA[<p>I was curious how the physical parameters of Single Family Houses changed over time.</p>

<p>Using the <a href="https://mountainmath.ca/map/assessment">assessment dataset</a> merged with the <a href="https://mountainmath.ca/land_use/map">land use dataset</a>
allows to fairly accurately pick out single family houses, and also holds the age of most properies. Together with
the City of Vancouver LIDAR-generated building dataset <a href="https://mountainmath.ca/vancouver_lidar/map">that I have played with before</a>
we can look at physical building parameters.</p>

<!-- more -->


<p>The city dataset is a little coarse, it only contains the main building and does not map things like garages. It&rsquo;s a little
rough and should probably be interpreted cautiously on an individual building level. One could spend the time and derive the
building data directly from the raw LIDAR dataset optimized for this purpose, but for some overview statistics the building
dataset that was derived by the city is just fine. The LIDAR was taken in 2009, so we only consider houses built before that time.</p>

<h3>Site coverage</h3>

<p>One question is how the site coverage of the buildings have changed over time. We simply line up the buildings by the year
they were built, compute the site coverage of the main building relative to the parcel size and graph the quintiles for
each year. For good measure, we throw in the 10 and 90 percentile whiskers.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_coverage" style="height:200px;max-width:640px;" data-url="/data/sfh_coverage.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>What jumps out immediately is that around 1988 there apparently was a change in zoning law that reduced site coverage
of the main building. <strike>I don&rsquo;t know anything about the history of building codes, maybe someone that does could shed some
light onto this.</strike> <a href="https://twitter.com/BrendanDawe/status/706737206484795392">Twitter was fast to provide the answer</a>
it appears that changes in building code were implemented to counteract the growing footprint of houses at the time, details
can be found in <a href="https://open.library.ubc.ca/cIRcle/collections/ubctheses/831/items/1.0086386">Barbara Pettit&rsquo;s Ph.D. thesis</a>.</p>

<h3>Building Height</h3>

<p>The next obvious point of analysis is how building height, in meters, changed over time.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_height" style="height:200px;max-width:640px;" data-url="/data/sfh_height.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>We observe a similar jump in the data around 1988, with building height jumping up as site coverage decreases.</p>

<h3>Building Volumes</h3>

<p>Now let&rsquo;s look at how &ldquo;massive&rdquo; the buildings are, measured by volume in cubic metres.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_volume" style="height:200px;max-width:640px;" data-url="/data/sfh_volume.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>The graph does show that in general houses have gotten more massive starting in the late 80s, but after that have more or less
maintained the same volume. It shows that the combined effect of the regulation change in the late 80s that resulted in
smaller building footprints and taller buildings was that buildings overall got bulkier.</p>

<h3>Roof Type</h3>

<p>Lastly we see how the roof type changes over time, plotting the number of buildings with given roof type for each year.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_roof" style="height:200px;max-width:640px;" data-url="/data/sfh_roof.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>Flat roofs seem to have been quite popular between the mid 60s to mid 80s.</p>

<h3>Length to Width Ratio (Update)</h3>

<p>A question about a regulation change in 1938 <a href="https://twitter.com/GRIDSVancouver/status/706879555550613504">came up on Twitter</a>,
so I thought I should check into the length-to-width ratio to see if anything can be seen there. A ratio of 1
would mean a square footprint, a ratio of 2 means the house is twice as long as wide.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_square" style="height:200px;max-width:640px;" data-url="/data/sfh_square.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>No obvious changes around 1938, but our houses became a lot more square after the late 80s zoning changes.</p>

<h3>Next Steps</h3>

<p>After starting to see what kind of data can be derived from LIDAR data we can start to explore different questions. The
graphs open a small window into the physical parameters of single family homes over time and are only of limited general
interest.</p>

<p>For
more serious analysis we would most likely have to start from the raw LIDAR data, which takes a little bit of effort.</p>

<div><script src="http://doodles.mountainmath.ca/javascripts/box.js"></script></div>




<script>

function stacked_bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d")
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;
var legend=d3.select(div.node().parentNode).select('.legend');


d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  var color = d3.scale.ordinal().domain(graphData.colors.map(function(d,i){return i}))
  .range(graphData.colors);
  var domain=data.map(function(d){return d.date;});
  x.domain(domain);

  function graphValueId(i){
      return graphData.class + '_' + i + '_value'
  }

  graphData.labels.forEach(function(text,i){
    var color=graphData.colors[i];
    var html='<i style="background:' + color + '"></i> ' + text + ' <span style="float:right;margin-right:10px;" id="' + graphValueId(i) + '"></span>'
    legend.append('p').html(html);
  });
  
  data.forEach(function(d) {
      var y0 = 0;
      d.values = color.domain().map(function(i) { return {date: d.date, y0: y0, y1: y0 += +d.count[i]}; });
      d.total = d.values[d.values.length - 1].y1;
  });
  y.domain([0, d3.max(data, function(d) { return d.total; })]);

  var domainTickValues=[];
  var skip=Math.round(40/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

    function updateTooltip(d,i){
       color.domain().forEach(function(j){
             var value=d && i==j ? (domainLabelFormatter(d.date) + ': ' +rangeFormatter(d.y1-d.y0)) : '';
             d3.select('#'+graphValueId(j)).text( value);
       });
    }

  var year=svg.selectAll(".year")
    .data(data)
        .enter().append("g")
          .attr("class", "g");
  year.selectAll(".color-bar")
      .data(function(d) { return d.values; })
    .enter().append("rect")
      .attr("class", graphData.class + " color-bar")
      .attr("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.y1); })
      .attr("height", function(d) { return Math.max(0, y(d.y0) - y(d.y1)); })
      .attr("fill",function(d,i) {return color(i);})
      .on('mouseover',updateTooltip)
      .on('click',updateTooltip)
      .on('touch',updateTooltip) 
      .on('mouseout',function(){updateTooltip(null,i)});

      
});

}

var yearFormatter=d3.format();
stacked_bar_graph(d3.select("#sfh_roof"),true,yearFormatter,null,yearFormatter);
</script>

]]></content>
  </entry>
  
</feed>
