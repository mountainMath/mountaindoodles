<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: census | Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/blog/categories/census/feed.atom" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2017-04-10T16:27:01-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Surprise Maps]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2017/04/10/surprise/"/>
    <updated>2017-04-10T08:43:58-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2017/04/10/surprise</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/668"><img src="http://doodles.mountainmath.ca/images/surprise.png" style="width:50%;float:right;margin-left:10px;"></a>
At CensusMapper we like building models based on census data. We now
have a <a href="http://doodles.mountainmath.ca/blog/2017/03/22/comparing-censuses/">common tiling for 2011 and 2016 geographies</a>
that allows us to easily model changes over time. After building a model
we often want to see how well the model performs. An easy way to do this is to
simply map the difference of observations and model predictions.</p>

<p>Those maps are great and it is easy to understand what is mapped. But they are difficult to interpret properly. In many cases
a better metric to map is how consistent the observations in each region are with the model. Which brings us to Bayesian surprise maps.</p>

<!-- more -->


<p>There is a <a href="https://medium.com/@uwdata/surprise-maps-showing-the-unexpected-e92b67398865">great post</a> making the rounds on the
web, and when it recently <a href="https://twitter.com/LGeospatial/status/850806648201388032">showed up again in my Twitter feed</a>
I finally decided to get in on the fun.</p>

<h3>The Problem</h3>

<p><a href="https://censusmapper.ca/maps/584#15/49.2089/-123.1141"><img src="http://doodles.mountainmath.ca/images/marine_gateway_nbhd.png" style="width:50%;float:left;margin-right:10px;"></a>
To understand why surprise maps can be so useful, let&rsquo;s look a a concrete example. Suppose we want to understand dwelling units
that are not used as primary residences. (Which incidentally seems to be everyone currently living in Vancouver or Toronto.) To
that end we can simply consult <a href="https://censusmapper.ca/maps/584">the map of these</a> based on the 2016 census. As we try and
understand better what is happening in each region and we zoom in more and more we start to run into issues. Consider
<a href="https://censusmapper.ca/maps/584#15/49.2089/-123.1141">this example looking at the Marine Gateway neighbourhood in Vancouver</a>. We
see two areas coloured in dark blue, indicating a high rate. The left is the site of the MC2 development that got completed
just before the census and we discussed <a href="http://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/">earlier in detail</a>.
The right one is a large area with exactly one private dwelling unit, which happens not to be a primary residence for anyone. If
someone did use it as primary residence it would show up on the other extreme end of our colour spectrum. Either way, it does not
really give much useful information, it is mostly a distraction that takes attention away from MC2 that has a more important story
to tell.</p>

<p>Similarly, areas with very low dwelling counts are much more likely to see high variations of rates of non-permanent residence buildings
purely for statistical reasons. This results in a <a href="https://censusmapper.ca/maps/584#16/49.2425/-123.1777">&ldquo;checkerboard&rdquo; pattern</a>
that is mostly due to statistical noise and hides meaningful variations in the data.</p>

<h3>Surprise maps</h3>

<p><a href="https://censusmapper.ca/maps/669#15/49.2089/-123.1141"><img src="http://doodles.mountainmath.ca/images/marine_gateway_nbhd2.png" style="width:50%;float:right;margin-left:10px;"></a>
That&rsquo;s were surprise maps come in. As a first step, instead of colouring by the rate of non-primary residence dwellings,
let&rsquo;s colour by how this rate differs from our expectations. So we re-interpret our original map as mapping the difference from expectations
where the expectation is that all dwellings are used as primary residences. Alternatively we can also take the regional average
rate of non-primary residence dwellings and map the deviation from the average. Or we could build a
<a href="https://censusmapper.ca/maps/669">more elaborate model</a> using the 2011 rates and the change in overall rates per net new dwelling unit.</p>

<p>Either way, what we are doing here is we make a guess what we think the rate of non-primary residence units should be in each area
and we compare it with observations. The better our guess is, the stronger the &ldquo;checkerboard&rdquo; pattern will become due to simple
statistical noise as can easily be seen when
<a href="https://censusmapper.ca/maps/669#16/49.2425/-123.1777">comparing the more advanced model</a>
to the <a href="https://censusmapper.ca/maps/584#16/49.2425/-123.1777">checkerboard observed using the &ldquo;zero&rdquo; model</a>. In practice that
means that we have to click into each region to see the number of dwelling units, as well as the rate, to understand how we want
to interpret the result. Through this labour intensive process we will then weed out the area with just 1 dwelling unit and ignore
it.</p>

<p>Surprise maps don&rsquo;t map the actual difference of model and observation, they map how consistent the model is with the observation
in each area. To go back to our initial example of an area with only one dwelling unit in it. No matter if that unit is used as
primary residence or not, this cannot be taken as strong evidence that our model is wrong. We should assign this a neutral colour.
The MC2 development on the other hand contained 570 dwelling units in 2016, a large deviation from the model indicates that
our model might have some problems.</p>

<p>In surprise maps, we colour each area by the amount of evidence observations in a that area gives against our model. To have good evidence
against our model, observations should deviate from model prediction, and we should be able to exclude regular statistical noise as
a cause for this.</p>

<p>For this example, we chose a mixture of the &ldquo;base rate&rdquo; and &ldquo;de Moivre funnel&rdquo; models
<a href="http://idl.cs.washington.edu/files/2017-SurpriseMaps-InfoVis.pdf">described in this excellent paper</a> where we essentially modify
the de Moivre funnel model by allowing an arbitrary model to take the place of the average of our variable. We also keep track
of the sign of the evidence we collect against our model, so whether our model underpredicted or overpredicted the rate of
non-primary residence dwelling units.</p>

<p><a href="https://censusmapper.ca/maps/668#15/49.2089/-123.1141"><img src="http://doodles.mountainmath.ca/images/marine_gateway_nbhd3.png" style="width:50%;float:left;margin-right:10px;"></a>
The <a href="https://censusmapper.ca/maps/668">result is a map that makes it much easier to sport &ldquo;surprising&rdquo; areas</a>,
that is areas where observations provide good evidence
that our model does not hold well there.</p>

<p>We can now go back to check the <a href="https://censusmapper.ca/maps/668#16/49.2425/-123.1777">Marine Gateway area</a> we looked at before,
and we see that the only areas that contribute solid evidence against our model are the unexpectedly high rates at the MC2 development,
as well as the unexpectedly low rates at the area to the east between Main and Frasier streets.</p>

<h3>Surprise Maps in CensusMapper</h3>

<p><a href="https://censusmapper.ca/maps/671"><img src="http://doodles.mountainmath.ca/images/child_poverty_surprise.png" style="width:50%;float:right;margin-left:10px;"></a>
We baked these kind of surprise maps into CensusMapper, so now we can easily apply this to any other kind of observable.</p>

<p>The CensusMapper surprise maps that are implemented right now require as input a &ldquo;model&rdquo; , an &ldquo;observation&rdquo; a &ldquo;base&rdquo; variable
(the number of dwelling units, averaged over the 2011 and 2016 censuses in our case) and a standard deviation of the difference
between model and predictions. For now, that standard deviation will have to be entered manually. At some point we can automate
that process and compute it directly in CensusMapper on the server, but this variable cannot be computed dynamically on the client
like all the other variables in CensusMapper as it requires knowledge of all regions of interest, not just the ones in the current
map view. Moreover, other parameters like estimates of accuracy of census counts as well ask statistical rounding and other
operations that may have been performed on the data, can be added in to account for the fact that the rate observed in the census
is different from the actual rate. We added the ability to make the standard deviation region dependent, which allows us to
account for estimates of the accuracy of the census data based on region dependent variables.</p>

<p>For a simple example what this might look like consider child poverty. We have
<a href="https://censusmapper.ca/maps/132">mapped this variable in CensusMapper</a>, but at times
it can be hard to distill out the really important areas that have high child poverty rates as well as a high number of
children overall. We added a shading to regions that have particularly low NHS return rates
(and similarly for the full census return rates) to give some indication of reliability, and we display the return rate on hover.
We have added a scatter plot of the rate vs the total number of children in poverty to the
map story, so that the user can more easily determine how significant a high child poverty rate in each particular region is.</p>

<p>Another way to deal with these issues is to make a <a href="https://censusmapper.ca/maps/671">child poverty surprise map</a>.
As model we can simply use the assumption that there
are zero children in poverty in each area. We scale the standard deviation of the child poverty rate linearly by the return rate
to weight down areas with low return rate. The result is a map that colours each region by the amount of evidence they provide
against the model assumption of zero children in poverty.</p>

<p>This makes it easier to filter out regions that have a low number
of children overall, where high rates of child poverty might just be a statistical fluke.</p>

<h3>Where to go from here</h3>

<p>Should all maps be surprise maps? No, there is value in just mapping straight up census variables, or mapping plain differences
of observations from the model. But there are many good reasons why such maps should be complemented,
or in some cases even replaced by, surprise maps.</p>

<p>Some kind of automation to aid the selection of appropriate standard deviation for the surprise model is needed before we can
open this up to a wider user base. Or CensusMapper server has an R server running that ties directly into the database and
communicates with the web server, so we need to build the appropriate scripts that can automate this task.</p>

<p>Another logical extension is to include proximity data into the Bayesian estimates. If one Census Tract provides good evidence
against our model, but that evidence is distributed uniformly across Dissemination Areas within it, then our surprise map
will show weaker evidence at the dissemination area level simply because each area has a smaller base population. But we could
check if the deviation from the model is localized in just one Dissemination Area, or also present in neighbouring
Dissemination Areas, and include that information in our estimates. This approach would also help with the problem if the evidence
is concentrated in an area that is split between to Census Tracts and drowned out by outher data in these respective tracts. So
it won&rsquo;t show up at the Census Tract level because of the particular ways the boundaries were drawn (MAUP), and it will get
diluted out at the Dissemination Area level because of low base population counts. Adding in proximity measures could recover
this evidence at the Dissemination Area level.</p>

<p>There are lots of other interesting possibilities of using surprise maps while leveraging the dynamic nature of CensusMapper.
One may allow for several models and let
relative importance of the models self-adjust with the map view. The output would then be for each map view a linear combination
of the models that provides the best fit for the current map view, as well as the evidence each region in the current map view provides
against the model.</p>

<p>We will keep experimenting with surprise models and at some point open up some of it&rsquo;s capabilities to a wider group
of CensusMapper users.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Marine Gateway and Joyce-Collingwood]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood/"/>
    <updated>2017-04-03T12:46:47-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2017/04/03/joyce-collingwood</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/584#11/49.2389/-123.0977"><img src="http://doodles.mountainmath.ca/images/non-primary.png" style="width:50%;float:right;margin-left:10px;"></a>
There has been some <a href="http://www.theglobeandmail.com/real-estate/vancouver/bcs-empty-home-problem-moving-beyond-just-vancouver/article34130746/">recent confusion</a>
that got <a href="http://vancouversun.com/business/local-business/three-transit-oriented-communities-in-metro-rival-coal-harbour-for-empty-or-underused-housing">confounded further</a>
about transit-oriented development
in Vancouver harbouring a large number of non-primary residence homes. Good data is
important in moving forward in Vancouver&rsquo;s crazy housing market. Without proper
context, a couple of data points can serve to paint a very misleading picture
of what is happening. So I decided to fill in some gaps on the very narrow
question of understanding the CT level numbers that get tossed around.
No deep analysis, just looking into the CTs in question to see where the numbers that the census
picked up came from.</p>

<h3>TL;DR</h3>

<p>To understand the overall rate of 24.4% non-primary residence dwelling units at the Joyce census tract,
one should split the area into the Wall Centre Central Park development (99.2% non primary residence units)
and the rest of the CT (3.4% non-primary residence units).</p>

<p>To understand the Marine Gateway CT (24% non-primary residence dwellings),
it should be split inte the block with Marine Gateway development (13.7%),
the block containing the MC2 development (67.4%), and the rest (10.1%).</p>

<p>Comparing any of these very recent developments to the much older Coal Harbour makes no sense.
Coal Harbor is still &ldquo;filling in&rdquo; although at a stubbornly slow rate. It will be interesting
to see if the new vacancy tax can help speed that up.</p>

<!-- more -->


<h3>Marine Gateway</h3>

<p><a href="https://www.google.ca/maps/@49.2114587,-123.1170704,3a,75y,94.33h,114.49t/data=!3m6!1e1!3m4!1sdPusgUyW9gIfMiDEYVcduw!2e0!7i13312!8i6656!6m1!1e1"><img src="http://doodles.mountainmath.ca/images/ec2_streetview.png" style="width:50%;float:left;margin-right:10px;"></a></p>

<p>To understand the 24% non-primary residence units in the census tract containing the
Marine Gateway development, we split the area into three parts.
The block with the Marine Gateway
development has in 460 dwelling units, 63 (13.7%) of which were found not to be
primary residences. The block north of that containing MC2 had 570 dwelling units
394 (67.4%) of which were not used as primary dwellings. The remaining part of the
CT as 1,507 dwelling units, 152 (10.1%) of which were not used as primary dwellings.</p>

<p>What we see here quite nicely is how the rates of non-primary residence units
are changing as the buildings they are in get older. Both Marine Gateway and MC2 are fairly
recent projects, but Marine Gatway itself got completed about a year before MC2,
and have significantly lower rates of non-primary residence homes.</p>

<p>What needs further sleuthing is the rate of 10.1% for the rest of the CT,
which is significantly higher than the baseline of 5.4% in 2011. There are no
other larger pockets of increase of non-primary residence units in that area.
This is might be best analysed in conjunction with similar increases in non-primary
residence dwellings in some other single
family neighbourhoods and goes beyond the scope of this short note.</p>

<h4>Data:</h4>

<ul>
<li><a href="https://censusmapper.ca/maps/584#16/49.2117/-123.1146">Non-primary residences</a></li>
<li><a href="https://censusmapper.ca/maps/586#15/49.2155/-123.1105">Change in non-primary residence dwellings</a></li>
<li><a href="https://censusmapper.ca/maps/650#15/49.2155/-123.1105">Total change in non-primary residence dwellings</a></li>
</ul>


<h3>Joyce-Collingwood</h3>

<p><a href="https://www.google.ca/maps/@49.2342503,-123.0248672,3a,75y,147.43h,109.85t/data=!3m6!1e1!3m4!1s22enJ14Z6DaYnXcsXcqYqw!2e0!7i13312!8i6656!6m1!1e1"><img src="http://doodles.mountainmath.ca/images/wall_centre.png" style="width:50%;float:right;margin-left:10px;"></a>
The story for Joyce-Collingwood is quite a bit cleaner (but holds some data complexities that
manifest themselves in geocoding changes between censuses that can mess with fine-grained data).</p>

<p>The articles focus on the increase by 609 CT-level non-primary residence dwelling units at Joyce. The articles
hypothesise that &ldquo;Speculation is one of our prime suspects&rdquo; and
&ldquo;We don’t know why, but we know it’s concentrated in a few neighbourhoods.&rdquo;
without making any effort to look beyond CT-level data to find out.</p>

<p>Diving in we see immediately that the Dissemination Block at the north-west
corner of Kingsway and Boundary had 707 non-primary residence dwelling units in 2016,
vs 3 in 2011. That&rsquo;s a net change of 704 non-primary residence dwelling units
in just that block. It
block contains the Wall Centre Central Park development, that completed
shortly before the census. The census counted 713 units, only 6 of
which it found occupied.</p>

<p>At the same time, population dropped by 161 people in this block, as the
previous single family homes made way to the new development, easily
explaining the drop in population by 57 in the CT level data that
<a href="https://twitter.com/Ayan604/status/848952053435047936">has people scratching their heads</a>.</p>

<p>So what&rsquo;s the rate of non-primary residence buildings once we take out the
Wall Centre Central Park that got completed just before the census?</p>

<p>It&rsquo;s 3.4%. Which explains why Jennifer Gray-Grant, executive director at Collingwood Neighbourhood House,
was quoted finding the stat of 24% non-primary residence home &ldquo;perplexing&rdquo;.</p>

<p>It is also interesting to look back through time to see
<a href="https://censusmapper.ca/maps/400#16/49.2348/-123.0310">the rates in 2006</a>, when
the area around Aberdeen Park had 18.1% non-primary residence units. I am guessing
that some major building projects got completed in the year before the census,
by 2011 the number of non-primary residence units dropped dramatically.</p>

<h4>Data:</h4>

<ul>
<li><a href="https://censusmapper.ca/maps/584#16/49.2358/-123.0287">Non-primary residences</a></li>
<li><a href="https://censusmapper.ca/maps/586#16/49.2358/-123.0287">Change in non-primary residence dwellings</a></li>
<li><a href="https://censusmapper.ca/maps/650#16/49.2358/-123.0287">Total change in non-primary residence dwellings</a></li>
</ul>


<h3>Olympic Village</h3>

<p>The high rate of non-primary resident units in 2011 in the Olympic Village should
be seen in the context of the City&rsquo;s decision not to sell the units below cost
but hold onto the units and sell them
at a later point when the market recovers, which eventually paid off.</p>

<p>To understand the current overall rate of 9.4% non-primary residence units, it is
instructional to simply zoom into the block level data and observe how the
rates change depending on the completion time of the building.</p>

<h4>Data:</h4>

<ul>
<li><a href="https://censusmapper.ca/maps/584#15/49.2665/-123.1159">Non-primary residences</a></li>
<li><a href="https://censusmapper.ca/maps/586#15/49.2665/-123.1159">Change in non-primary residence dwellings</a></li>
<li><a href="https://censusmapper.ca/maps/650#15/49.2665/-123.1159">Total change in non-primary residence dwellings</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Comparing Censuses]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2017/03/22/comparing-censuses/"/>
    <updated>2017-03-22T13:28:51-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2017/03/22/comparing-censuses</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/624#14/49.2608/-123.1556"><img src="http://doodles.mountainmath.ca/images/pop_change.png" style="width:50%;float:right;margin-left:10px;"></a>
It&rsquo;s great to have fresh census data to play with. Right now we only have
three variables, population, dwellings and households. There is still lots
of <a href="http://doodles.mountainmath.ca/blog/2017/02/10/2016-census-data/">interesting information that can be extracted</a>.</p>

<p>So we started exploring in our <a href="http://doodles.mountainmath.ca/blog/2017/03/06/rs-population-change/">last post</a>,
things get really interesting when looking at change between censuses. But as we noted, there are
several technical difficulties that need to be overcome.</p>

<p>So we at CensusMapper took that as and invitation to do what we love most: breaking down barriers.</p>

<!-- more -->


<p>The biggest difficulty in comparing censuses is that census geographies change over time to adapt to new
demographic realities on the ground. Whenever that happens, there is no easy way to compare data across
censuses.</p>

<h3>Custom Tabulations</h3>

<p>The best way to compare data across censuses is to pull a custom tabulation for data on a common geography,
there are a couple of things to keep in mind though:</p>

<p>1) It costs money (or at least time if part of a specific research project with access to a StatCan data centre),
2) it takes time to complete a custom tabulation, and
3) custom tabulations are typically not available at fine geographic levels.</p>

<p>For these reasons, comparing data across censuses is usually confined to select university research projects
or well-resourced private interest. And to make matters worse, custom tabulations are rarely shared. I have
asked university research groups if they were willing to share custom tabulations through CensusMapper, but got turned down
every time so far. While the
<a href="http://www.science.gc.ca/eic/site/063.nsf/eng/h_F6765465.html?OpenDocument">Tri-Agency Open Access Policy on Publications</a>,
postulates that research needs to be published in open access journals and the data also needs to be made available, in practice
research groups often keep their data locked up long after publication.</p>

<p>But some public agencies do make their custom tabulations available, for example the City of Vancouver has custom tabulations
for neighbourhood boundaries <a href="http://data.vancouver.ca/datacatalogue/index.htm">available on their open data catalogue</a>.</p>

<h3>Comparable Regions</h3>

<p>But even without custom tabulations we can compare regions if they have not changed across censuses. For example, we can compare
how the City of Vancouver or Metro Vancouver have change over time by tracing them through censuses, as their geography has not
changed. Census regions are tracked through their unique region identifier, which allows people to establish
timelines for regions. When doing so one quickly runs into issues with this approach though.</p>

<p>Just because a region has the same name and unique geographic identifier does not guarantee that the region has not changed. Simple
examples of this are Census Metropolitan Areas that can change quite dramatically over time without this being reflected in the name
or region identifier. For example, Ottawa, Montreal or Abbotsford were all expanded, some substantially) from the 2011 to the 2016 census.</p>

<p>For example, by just comparing Census Metropolitan Area data, Montreal&rsquo;s population grew by 7.2% between 2011 and 2016. But a good
chunk of that was simply due to the geographic region of the CMA being expanded, taking the 2016 expanded region as a base and
including all people that lived in that region in 2011, including the ones that lived outside of the 2011 CMA of Montreal but
that are now included in the 2016 CMA, the region&rsquo;s population only grew by 4.2%.</p>

<p>On top of large changes like this, many smaller regions have undergone slight boundary adjustments while keeping their unique identifier,
which move some people from one geographic region to another. And as one drills down into finer geographies one can easily
find geocoding errors in the data, where people were moved from one region to another between censuses without any region
adjustment taking place. These geocoding problems may persists in custom tabulations, but they are likely to even out as one
moves to higher aggregation levels.</p>

<h3>CensusMapper comparable regions</h3>

<p><a href="https://censusmapper.ca/maps/648"><img src="http://doodles.mountainmath.ca/images/pop_adjusted.png" style="width:50%;float:left;margin-right:10px;"></a>
At CensusMapper we decided that it would be in the general interest to be able to compare standard census variables
across all aggregation levels. So we wrote some scripts to create a &ldquo;least common denominator&rdquo; tiling for all of
Canada for all aggregation levels,
ranging from Census Blocks to all of Canada. The idea is to keep regions that have not changed and, for regions that did change,
join regions together in a way that the joins match again across censuses. While this sounds simple in principle, there are lots
of issues and pitfalls along the way. Hopefully we have properly dealt with all of them now. We have done some testing, and
there are still have 285 regions (36 CTs, 245 CSDs and 4 CMAs) where the adjusted and computed 2011 population counts don&rsquo;t
quite add up. For example, 348 people were moved between Coquitlam and Port Coquitlam in this fashion, most of it due to an
adjustment between CTs 9330287.01 and 9330291.01 that is not due to a change in geographic boundary. In the example of Airdrie
trading 705 people with Rocky view this is associated with a change of the census geography, but no change in name or
geographic identifier. In most cases the adjustment is much smaller than this. Even more extreme than Airdrie is the case
of CTs 5350512.00 and 5350511.01 in Mississauga that swapped 1074 people without any apparent boundary change.</p>

<p>We have a <a href="https://censusmapper.ca/maps/648">map that highlights all these difference at or above the CT zoom level</a>, and in all maps we shade areas with adjusted
population counts and we indicate the actual population adjustment on hover.</p>

<h3>The Good, the Bad and the Ugly</h3>

<p><a href="https://censusmapper.ca/maps/588#14/49.2613/-123.1568"><img src="http://doodles.mountainmath.ca/images/dw_change.png" style="width:50%;float:right;margin-left:10px;"></a>
So what does all of this buy us? For now, we get comprehensive maps comparing population, dwellings and households across the
2011 and 2016 censuses at all geographic levels, including Dissemination Blocks. As new census data rolls in, we will be
able to compare data down to the Dissemination Area level. That&rsquo;s pretty cool, we think.</p>

<p>What could be bad about this? Census data is far from perfect. And mapping differences tends to bring out the problems in
Census Data. Incorrectly enumerated dwellings, households or population, geocoding issues, as well as changes in geographies.</p>

<p>And things start to get really ugly when the rest of the census data comes in where statistical rounding was applied. Even if
everything was perfectly enumerated and geocoded, statistical rounding means that inevitably some areas will have census data
that has been rounded up in one year and rounded down in the next. And taking differences will bring this out very strongly,
especially at the Dissemination Area level. It is hard to overstate the effect of this, statistical rounding means that when
mapping change at small aggregation levels we will map lots of statistical noise.</p>

<p>There is however still value in showing and
working with differences of census variables at small aggregation levels, but the results are much harder to interpret.
One very simple workflow that we use regularly is to generally use Census Tract level data, but zoom in to Dissemination Areas
when we want more context for particular Census Tract values. Doing this, salted and peppered with a good dose of caution and
ideally some ground truthing, we can greatly refine our insights in what is going on in that Census Tract.</p>

<p>For this
reason we are decided to, at this point, keep fine grained data publicly available. We are aware that this will lead to
some people misinterpreting census data, but this is already happening at any aggregation level and is generally not a
sufficient argument to lock up data in our view. We may add more visual aids to warn the user of unreliable results, like adding
pattern shading to results that could be dramatically effected by small difference errors due to statistical rounding or
sampling/enumeration issues.</p>

<h3>Maps</h3>

<p>We opened up a number of maps on CensusMapper that explore changes between the 2011 and 2016 censuses down to the block level.</p>

<ul>
<li><a href="https://censusmapper.ca/maps/624">Population Change</a></li>
<li><a href="https://censusmapper.ca/maps/588">Dwelling Change</a></li>
<li><a href="https://censusmapper.ca/maps/586">Change in Non-Primary Residence Dwellings</a></li>
<li><a href="https://censusmapper.ca/maps/590">Change in Household Size</a></li>
<li><a href="https://censusmapper.ca/maps/596">Components of Population Change</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RS Population Change]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2017/03/06/rs-population-change/"/>
    <updated>2017-03-06T11:06:57-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2017/03/06/rs-population-change</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/583"><img src="http://doodles.mountainmath.ca/images/pop_change_ct.png" style="width:50%;float:right;margin-left:10px;"></a>
With reporting on the new census numbers gaining traction, and now
Mayor Robertson
<a href="http://www.cbc.ca/news/canada/british-columbia/gregor-robertson-statement-vancouver-character-homes-review-1.4011100">picking up on single family neighbourhoods losing population</a>
we thought it is time to crunch some numbers.</p>

<p>Why does it need number crunching? All the reporting so far is based on looking at CT (Census Tract) aggregates, like e.g. in the
map shown and linked to the right. But there is actually no
single CT in the City of Vancouver that only contains RS zoning. Deducing results by just looking on CT aggregates can lead
to misleading reporting, like we have seen with unoccupied dwellings in the &ldquo;Marine Gateway Neighbourhood&rdquo;. Given how prominent
this topic has become it is high time to dig into the details.</p>

<h3>TL;DR</h3>

<p>In summary, we can confirm that RS (single family), RT (duplex) and FSD neighbourhoods have been dropping population.
Slightly. Looking separately at the
east and the west side, we notice that population in these neighbourhoods dropped by about 1% on the west side and increased
slightly on the east side.</p>

<p>In all groupings that we looked at the household size dropped and the rate of unoccupied dwellings increased. This was counter-acted
by a growth in dwelling units, mostly confined to RS zones where laneway houses and suites were added (or newly discovered
in the 2016 census).</p>

<p>We split the analysis into <em>core</em> regions, blocks that lie completely within RS, RT and FSD zoning, and <em>fringe</em> regions,
blocks that have RS, RT or FSD zoning as well as other zoning. Fringe regions grew in population and had overall lower rates
of unoccupied units when compared to core regions.</p>

<!-- more -->


<h3>Comparing Censuses</h3>

<p>Comparing data across censuses is hard. For one, definitions change from one census to the next
and thus variables aren&rsquo;t always comparable. Four our immediate goal of comparing
population, private dwellings, and private households between the 2011 and 2016 censuses
that is not a concern.</p>

<p>Comparing data is relatively easy when census geographies are large (i.e. CT, CSD level or higher)
and the census geography matches exactly the area that we are interested in. For CSDs (Municipalities)
this is often the case, but at the sub-municipal level, the CTs (Census Tracts) or other sub-municipal
aggregation levels rarely line up with the regions one is interested in.</p>

<p>For example, if one is interested in changes in population in RS (single family zoned) neighbourhoods in
Vancouver, looking at selected CTs will only give some initial indication. The reason is that
there is actually no CT in the City of Vancouver that is entirely RS zoned. There are several that
come close (the closest one is CT 9330015.01 around 41st and Thyne, which actually
increased population from 5,364 in 2011 to 5,485 in 2016) but it shows how tricky
it is to answer the really simple question how the population changed in RS neighbourhoods.</p>

<p>So how to deal with this issue? The cleanest way is a custom tabulation from StatCan, but that takes
time, costs money, and may still
<a href="https://twitter.com/vb_jens/status/838561779970011136">result in problems when data was not geocoded correctly</a>,
which is next to impossible to detect in custom tabulations.</p>

<p>An alternative way is to compare censuses at finer aggregation levels, that is at DAs (Dissemination Areas) or
DBs (Dissemination Blocks).</p>

<h3>Comparing Censuses at DA or DB levels</h3>

<p>For our concrete example, that means we look for DBs within RS zoning and work with these.</p>

<p>There are several difficulties with this approach. The most important is that the finer data we look at,
the more likely we pick up problems with Census data (yes, there are problems) and mistake them for real world data.
For our case through, we can avoid some of that by aggregating over all DBs within RS zoning to even out some
of these issues. Morever, we can visually inspect the data to look for any particular DB that seems to be problematic
and do some ground-truthing to see if the issues are only in the data or actually on the ground.</p>

<p>The next difficulty is technical in nature. Census geographies, including DBs and DAs, can change from one census to
another and thus may not be comparable. In order to get reliable results we need to make sure that we work with
a common set of geographies for both the 2011 and 2016 censuses. Luckily this is only a technical problem that can be
overcome as census geographies don&rsquo;t just change randomly but still retain some basic comparability.</p>

<p>And it&rsquo;s perfect timing, since we just created a &ldquo;least common denominator&rdquo; tiling derived from 2011 and 2016 DBs and DAs. At
CensusMapper we work with &ldquo;cartographic&rdquo; DBs (so we clip our major bodies of water), which leads to a minor issue where
between 2011 and 2016 things were clipped slightly differently which yielded two DBs in 2011 (with 16 and 17 people in it)
being clipped out (and having no people in it) in 2017, likely a combination of adjusting some tolerances in the StatCan
algorithms as well as some minor changes in geocoding that moved the population into an adjacent DB
(like e.g. happened with 59150971009 and 59150971008 south of King Edward split along Carnarvon). Apart from that, the
result is a tiling of Canada by DB and DA-based geographies that allow for consistent comparisons across the two censuses.</p>

<p>In numbers there were 493,192 cartographic DBs in 2016, 489,676 in 2016, and these resulted in a least common denominator tiling
by 445,953 DB-based geographies.</p>

<h3>RS, RT and FSD Zones and Population Change</h3>

<p><img src="http://doodles.mountainmath.ca/images/filter_all.png" style="width:50%;float:right;margin-left:10px;">
Back to our original question, how did population change in RS zoning. Before we go there, we think it makes more sense to expand
the question to ask for RS, RT (duplex) and FSD (First Shaughnessy) combined as these are about equally restrictive in what
we allow there.</p>

<p>Grabbing the <a href="http://data.vancouver.ca/datacatalogue/zoning.htm">latest available zoning data</a> and uploading it to
CensusMapper makes it easy to download the 2011 and 2016 dissemination blocks that intersect RS, RT and FSD zoning. We removed the RS part
that snakes along the downtown beaches and covers Stanley Park, as well as the sliver creeping up False Creek and covering the marinas there.</p>

<p>When we intersect the census data with the zones, we also compute the overlap each DB has with the zoning and disregard any region
with less than 10% overlap. Moreover we divide the dissemination blocks into <em>core</em> blocks where
the overlap is greater than 99% and <em>fringe</em> blocks, where the overlap is less than 99%.</p>

<p>One should remember that a significant
portion (a majority actually) of RS, RT and FSD dwellings are contained in &ldquo;fringe&rdquo; areas.
So it is best to focus on the rates of change, we would expect the total number of population decline
of all RS, RT and FSD zoned properties to be higher.</p>

<p>Here are the results:</p>

<pre><code>RS, RT, FSD
core: 236 DB, fringe: 475 DB
Population 2011 - 2016
core pop change: -69, fringe pop change: 6673, core total pop: 124916, fringe total pop: 284231
Dwellings 2011 - 2016
core dw change: 2812, fringe dw change: 7142, core total dw: 47008, fringe total dw: 121488
Households 2011 - 2016
core hh change: 1194, fringe hh change: 5127, core total hh: 42298, fringe total hh: 111801
</code></pre>

<p><img src="http://doodles.mountainmath.ca/images/filter_core.png" style="width:50%;float:right;margin-left:10px;">
What we see is that the population in the &ldquo;core&rdquo; DBs did drop. Slightly. At the same time the number of dwellings
increased quite noticeably by 6.3% in the core, with essentially all of the dwelling growth located within RS zones
(as opposed to RT and FSD). So most of that dwelling
growth is due to suites and laneway houses. Note that we only capture 47008 dwellings in the &ldquo;core&rdquo; RS, RT, FSD areas,
which is less
than half of the dwelling units in RS, RT and FSD with the remaining dwellings are located within the &ldquo;fringe&rdquo; regions.</p>

<p><a href="https://censusmapper.ca/maps/596"><img src="http://doodles.mountainmath.ca/images/van_pop_comp.png" style="width:50%;float:left;margin-right:10px;"></a>
Interestingly, the number of households grew much slower than the number of dwellings in the &ldquo;core&rdquo; regions, increasing the rate
of unoccupied units from 7% to 10%. Following our decomposition of population growth <a href="https://censusmapper.ca/maps/596">mapped here</a>
and <a href="http://doodles.mountainmath.ca/blog/2017/02/10/2016-census-data/">explained in more detail in a previous post</a>, we see
that the population growth of -69 in the &ldquo;core&rdquo; regions can be decomposed into:</p>

<ul>
<li>-3,699 due to declining household size,</li>
<li>-4,321 due to increase in unoccupied dwellings, and</li>
<li>7,952 due to increase in dwelling units.</li>
</ul>


<p><img src="http://doodles.mountainmath.ca/images/filter_fringe.png" style="width:50%;float:right;margin-left:10px;">
We can do the same analysis for the &ldquo;fringe&rdquo; areas, where RS, RT and FSD zoning mixes with other zones. Here we get a population
increase by 2.4%, driven by an increase
in dwelling units by 6.2%, and dampened by shrinking household size and a
more modest increase in the rate of unoccupied units from 6.7% in 2011 to 8% in 2016. We note that
the rate of unoccupied units increased significantly less on the fringe when compared to the core.</p>

<p>Breaking up the population growth of 6,673 people as before we have:</p>

<ul>
<li>-6,667 due to declining household size,</li>
<li>-3,996 due to increase in unoccupied dwellings, and</li>
<li>17,336 due to increase in dwelling units.</li>
</ul>


<h4>The West Side</h4>

<p>Lastly, we probably can&rsquo;t talk about this without running a separate analysis for the west side. So here we go.</p>

<pre><code>RS, RT, FSD
core: 88 DB, fringe: 184 DB
Population 2011 - 2016
core pop change: -510, fringe pop change: 1631, core total pop: 42878, fringe total pop: 105309
Dwellings 2011 - 2016
core dw change: 572, fringe dw change: 2426, core total dw: 16735, fringe total dw: 49210
Households 2011 - 2016
core hh change: -18, fringe hh change: 1226, core total hh: 15066, fringe total hh: 44907
</code></pre>

<p>We see that this confirms conventional wisdom that the population decline in the core areas of RS, RT, FSD is stronger
on the west side (and in fact population did increase overall in the core areas on the east side). The rate of unoccupied (by usual residents)
units was quite similar to the overall RS, RT, FSD, climbing from 6.7% in 2011 to 10% in 2016.</p>

<p>Again splitting up the population change of -510 people in the &ldquo;core&rdquo; area into components we get:</p>

<ul>
<li>-458 due to declining household size,</li>
<li>-1,587 due to increase in unoccupied dwellings, and</li>
<li>1,535 due to increase in dwelling units.</li>
</ul>


<p>For the &ldquo;fringe&rdquo; west side areas we again observe that population increased at 1.5%, dwellings by 5.1% and
the rate of unoccupied units grew slower from 6.6% to 8.7%. Splitting up the population change of 1,631 people:</p>

<ul>
<li>-1,278 due to declining household size,</li>
<li>-2,466 due to increase in unoccupied dwellings, and</li>
<li>5,376 due to increase in dwelling units.</li>
</ul>


<h3>Glossary</h3>

<p>We are a little loose with our use of language. In this post &ldquo;unoccupied&rdquo; is always short for &ldquo;not occupied by usual residents&rdquo;,
so in simpler terms &ldquo;not used as primary residence&rdquo;. &ldquo;Occupied&rdquo; refers to &ldquo;used as primary residence&rdquo;.</p>

<p>West side and east side were divided along the longitude for Ontario road.</p>

<p>Core regions are Dissemination Blocks that have at least 99% overlap with RS, RT or FSD zoning.</p>

<p>Fringe regions are Dissemination Blocks that have between 10% and 99% overlap with RS, RT or FSD zoning.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2016 Census Data - Part 1]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2017/02/10/2016-census-data/"/>
    <updated>2017-02-10T20:27:10-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2017/02/10/2016-census-data</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/583"><img src="http://doodles.mountainmath.ca/images/van_pop_change.png" style="width:50%;float:right;margin-left:10px;"></a>
Finally the first batch of 2016 census data has arrived on Tuesday AM and
CensusMapper was updated with the new census numbers by mid-morning.</p>

<p>Dissemination Block data was a little harder to find, but with the help
of some friendly StatCan people I finally managed to locate the data and
add that too this afternoon.</p>

<p>Time for writing up some observations. I am hoping to find time to do
this regularly as more data gets released.</p>

<!-- more -->


<p>The first batch of data only comes with three variables: Population, dwellings and households.
And two more, a data quality flag indicating areas with incomplete enumeration and the area of
each geographic region. Area itself is more tricky than it seems at first, one has
to make decisions what to count. Lakes? Rivers? National or Regional Parks?</p>

<p>Next to these variables, we also got the corresponding 2011 population for all geographic
regions at the CT/CSD level and above to aid the comparison, but these
were not available at the DA or DB level.</p>

<p>The variables seem straight forward, but nothing is simple when it comes to big projects like a census,
so it might we worthwhile to spend a little bit of time looking at them.</p>

<h3>Population</h3>

<p><a href="https://censusmapper.ca/maps/591"><img src="http://doodles.mountainmath.ca/images/van_pop_density.png" style="width:50%;float:right;margin-left:10px;"></a>
The quintessential census variable counts the number of people in each census region. With the exception
of people that have a primary residence elsewhere in Canada or abroad. There are several reasons for this,
the simples one is to avoid the double-counting of people.</p>

<h3>Dwellings</h3>

<p>&ldquo;Dwellings&rdquo; is short for &ldquo;private dwellings&rdquo;, this does not count collective dwellings
like prisons, student dorms, hospitals or nursery homes or even some coops. This can lead
to interesting situation where there are zero private dwellings (and zero households) but non-zero population.
Metro Vancouver has 45 such dissemination blocks. But these people are
only counted if they don&rsquo;t have a primary residence somewhere else, which
often is the case for students in dorms. But not for all students, as the
Dissemination Block on UBC campus that&rsquo;s wedged between NW Marine, University,
Lower Mall and Agronomy shows.
It has zero dwellings, zero households, but a population of 890 people.</p>

<h3>Households</h3>

<p>The &ldquo;dwellings, occupied by usual residents&rdquo; is also called &ldquo;households&rdquo;. It
refers to a private dwelling that is used as a primary residence, and the inhabitants
make up a household. If inhabitants of a dwelling only live there temporarily and/or has
a primary residence somewhere else in Canada or abroad, then they are not
counted in the population nor the household counts.</p>

<h3>Unoccupied Dwellings</h3>

<p><a href="https://censusmapper.ca/maps/584"><img src="http://doodles.mountainmath.ca/images/van_unoccupied.png" style="width:50%;float:left;margin-right:10px;"></a>
The difference between dwellings and households is &ldquo;dwellings, not occupied by usual residents&rdquo;. Essentially, that&rsquo;s
dwellings that are not used as primary residences. It&rsquo;s a fun variable to look at, and it
is available at the very fine Census Block level. In some cases, a Census Block can contain just one apartment building.</p>

<h3>Mixing Variables</h3>

<p>The fun starts when we mix these variables. And compare them to the previous
censuses. And there are lots of ways to do that, here are a few:</p>

<h4>Population Change</h4>

<p><a href="https://censusmapper.ca/maps/583"><img src="http://doodles.mountainmath.ca/images/van_pop_change.png" style="width:50%;float:right;margin-left:10px;"></a>
The most immediate variable to look at is population change. We have
complete Canada-wide data at the CT level or above, but if we are really
interested we can also view this data for DAs and DBs that stayed the same
across the census years. The issue with doing that is that some regions will have
not data, and one has to be very careful not to read too much into an incomplete
dataset. Which is why I usually don&rsquo;t like giving out maps that contain incomplete data like this.
But this is great for diving into specific regions to get more information.</p>

<h4>Dwelling Change</h4>

<p><a href="https://censusmapper.ca/maps/588"><img src="http://doodles.mountainmath.ca/images/van_dw_change.png" style="width:50%;float:left;margin-right:10px;"></a>
This is a great way to see where more dwellings got built. This only measures
net changes, so even if a region shows zero dwelling increase, there could have
been quite a bit of construction in the area. In particular, if houses with secondary
suites get torn down and replaced by houses without secondary suites, it will
show up as a decline in the number of dwelling units.</p>

<h4>Non-primary residence dwellings</h4>

<p><a href="https://censusmapper.ca/maps/586"><img src="http://doodles.mountainmath.ca/images/van_uo_change.png" style="width:50%;float:right;margin-left:10px;"></a>
More formally, these are &ldquo;dwellings not occupied by usual residents&rdquo;, it&rsquo;s
the difference between dwellings and households and the object of continued
scrutiny in Vancouver. And a good portion of these are the target of the
upcoming empty home tax to either monetize non-primary resident homes or
nudge them into the rental market.</p>

<h4>Household size change</h4>

<p><a href="https://censusmapper.ca/maps/590"><img src="http://doodles.mountainmath.ca/images/van_hs_change.png" style="width:50%;float:left;margin-right:10px;"></a>
A big part of population change is the change in household size. Canada wide the
trend to smaller households is continuing. That means that if the number of dwellings
and the rate of unoccupied dwellings in a region remain unchanged, then the
population in the area will decline if it follows the national trend to
smaller household size.</p>

<h3>Population Change Null Sum Game</h3>

<p>From looking at CensusMapper, the variable that got by far the most attention
nationally in the past three days is Population Change. It&rsquo;s great to
see where population grew or declined. But almost immediately people wonder
why population change was different in one region compared to another.</p>

<p>The first step to this is the Population Null Sum Game. You need the</p>

<ul>
<li>Dwelling Change</li>
<li>Change in Unoccupied Dwellings</li>
<li>Change in Household size</li>
</ul>


<p>to play. The game is then to express Population Change in terms of those three,
and thus &ldquo;explaining&rdquo; population change in terms of these variables. There are
of course other ways to split up the Population Change variable, but I find
this a useful one.</p>

<p>Nathaniel Lauster kicked the game off
<a href="https://homefreesociology.wordpress.com/2017/02/10/if-you-build-it-will-they-come/">with this great post</a>.
Let&rsquo;s follow up his inter-municipal level analysis with some intra-municipal numbers.</p>

<p>We will focus on the City of Vancouver only. People are welcome to use CensusMapper
to repeat this for whatever region they are interested in. Vancouver has the
nice advantage that at the dissemination area geography only on change was made.
A 2011 downtown DA got split into two for 2016. That makes it very easy to carry
this out at the DA level.</p>

<h3>Components of Population Change</h3>

<p>First we refine our variables a little bit it seems more interesting to use the rate of unoccupied builings as a variable,
rather than the number of these. We want to express population change <code>Δpop</code> as a
linear combination of</p>

<ul>
<li>Dwelling change <code>Δdw</code></li>
<li>Change in ratio of unoccupied dwellings <code>Δur</code></li>
<li>Change in household size <code>Δhs</code></li>
</ul>


<p>More formally:</p>

<pre><code>Δpop = hs₁₁ * (1-ur₁₁) * Δdw - hs₁₁ * dw₁₆ * Δur +  hh₁₆ * Δhs
</code></pre>

<p>where <code>hs₁₁=pop₁₁/hh₁₁</code> is the household size in 2011 as computed by dividing the population by the number of households,
<code>ur₁₁</code> is the rate of unoccupied dwellings in 2011, <code>dw₁₆</code> is the number of dwellings in 2016 and <code>hh₁₆</code> is the number of households in 2016.</p>

<p>It is simple algebra to check that the identity holds.</p>

<p><a href="https://censusmapper.ca/maps/596"><img src="http://doodles.mountainmath.ca/images/van_pop_comp.png" style="width:50%;float:right;margin-left:10px;"></a>
The first term gives the contribution to population growth due to the growth in dwellings, assuming that household size and the rate of unoccupied dwellings
are unchanged from 2011.</p>

<p>The second term give the population growth due to the change in the rate of unoccupied dwellings and the third term gives the
population growth due to a change in household size.</p>

<p>Great, all that&rsquo;s left to do is to type the formula into CensusMapper and graph the relative contribution of each of these terms. To make this work
we will have to make due with using only the magnitude of each term, but we can visualize the sign in the bar graph widget when
we hover over an area.</p>

<p>This makes it very easy to compare different areas and see how the different components contribute to the change in
population in each area.</p>
]]></content>
  </entry>
  
</feed>
