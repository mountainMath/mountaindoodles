<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vancouver | Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/blog/categories/vancouver/feed.atom" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2016-10-05T10:51:38-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Secondary Suites and Taxes]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/10/04/secondary-suites-and-taxes/"/>
    <updated>2016-10-04T14:59:20-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/10/04/secondary-suites-and-taxes</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/519#12/49.2597/-123.1243" target="_blank"><img  src="http://doodles.mountainmath.ca/images/secondary_suites.png" style="width:50%;float:right;margin-left:10px;"></a>
A couple of weeks ago I started thinking about secondary suites, laneway houses and taxes in the City of Vancouver. The number
of secondary suites and laneway houses has been continuously growing. Rental income
is probably one of the main reasons people choose to activate a secondary suite. What are the tax implications?</p>

<!-- more -->


<h2>Secondary Suites</h2>

<p>How many secondary suites are out there? Nobody really knows, but we have some estimates. Comparing single family properties
from the assessment roll to census counts provides one estimate. This is likely a lower bound as the census is prone to
undercount suites. Using this method, we arrive at a lower bound of 30,000 single family properties with a suite in 2011,
up from about 27000 in 2006. The <a href="https://censusmapper.ca/maps/519#12/49.2597/-123.1243">above map</a> gives a rough idea
of their location, although it also includes the roughly 2000 stratified duplex properties.</p>

<p>Of these we estimate that 7,000 had more than one suite in 2011, with a similar number in 2006. The number of laneway houses was
quite small in 2011, likely less than 400. But by now the number has grown to over 2,000.</p>

<p>In total that adds up to an estimated around 37,000 suites in the city of Vancouver in 2011. Probably more in the
recent 5 years, maybe fewer in the years between 2006 and 2011. Most of these will be operated as suites, with the main
unit serving as a principal residence of the property owner. But this also includes investment properties where each
unit, including the main unit in the house, are rented out.</p>

<p>For this post we will focus entirely on the suites. We might expand on this analysis at some later point and separate
out owner-occupied homes from investment properties. Moreover we will use the more conservative estimate of 30,000
suites. Feel free to adjust that estimate in the interactive at the bottom see how this effects the estimates we make.</p>

<h2>Income Tax</h2>

<p>Secondary suite rental income needs to be recorded on
<a href="http://www.cra-arc.gc.ca/E/pbg/tf/t776/t776-15e.pdf">CRA form T776</a> and, after claiming deductions, taxed.</p>

<p>Estimating the average suite rental income at $1,000, claiming $200 in deductions leaves us with $800 or $9,600 in
monthly taxable income. With single family homeowners generally above the median income we use a marginal tax rate of 35%
to estimate $3,360 of taxes per secondary suite, so cumulative $100,800,000 in income taxes payed on secondary suite
rental income in the City of Vancouver.</p>

<h2>Capital Gains Tax</h2>

<p>Assessing the capital gains implications is more complex. The capital gains exemption applies to a <em>housing unit</em>. If a
property with several housing units is sold, only the capital gains attributed to the unit used as principal residence
is exempt from taxation. Typically the portion of taxable gains is determined by the relative areas of the rented and
principal residence parts of the home.</p>

<p>So the question whether the portion of a house taken up by a secondary suites is exempt from capital gains essentially
boils down to the question whether or not the secondary suite counts as a &ldquo;self–contained domestic establishment
for earning rental income&rdquo; or as &ldquo;one or more rooms in the home&rdquo;. I have asked the CRA to clarify how this would apply
to someone converting a portion to a house to secondary suite or building a laneway house, to which I got the following
response.</p>

<blockquote><p>The conversion of a portion of a house that otherwise is the taxpayer’s principal residence for the purpose of earning income or the creation of a separate building or structure on land that forms part of the taxpayer’s principal residence for the purpose of earning income are examples of structural changes that would result in a deemed disposition and reacquisition of a portion of the property.</p></blockquote>

<p>Similarly, when a homeowner deactivate a suite and absorbes it into their main residence that would trigger another
&ldquo;deemed disposition (and reacquisition) thereof at fair market value&rdquo;. Which then would trigger a &ldquo;taxable capital
gain attributable to the period of use of such portion of the property for income–producing purposes&rdquo;, just like it
would at a sale of the property.</p>

<p>In the case when the homeowner rents out their entire home and later moves back in again, the homeowner can, under
certain circumstances, make an election that he can maintain the primary residence status for most recent 4 years during
which the home was rented out. I have asked the CRA to clarify if a similar election could be made for a secondary suite,
when for example after four years of renting the suite is deactivated and again absorbed in the main house and the response
was that &ldquo;such an election cannot be made where there is only a partial change in use of the property.&rdquo;</p>

<p>Based on this I am fairly convinced that the portion of a home used as a secondary suite or laneway house is not exempt
from capital gains tax. Despite my best efforts I might still be reading this wrong, in which case I would love to have
an expert weight in on this.</p>

<h3>Estimating Captial Gains Generated by Suites</h3>

<p>To estimate the amount of capital gains tax based on secondary suites expected to accrue annually in the City of Vancouver
we use the inflation-adjusted land value gain of a home as a
proxy for the portion of the appreciation of the property that is not due to improvements the owner made to the home, i.e.
the portion that would be subject to capital gains tax if this wasn&rsquo;t a primary residence.</p>

<p>To compute the taxable gains for an individual property we take the difference between the current land value and the
(inflation-adjusted) present land value at the time the property was bought. To simplify things a little we will consider the
current average (over SFH with suite) land value, the average holding period (years between buy and sell), and the
average inflation-adjusted land value gains. This can be refined, but should suffice for our purposes.</p>

<p>Going back to our estimate, the current (July 2015) average land value of single family homes was $1,640,000. Suites skew toward
the east, where average land value was $1,080,000. We roughly average these and take $1,300,000 as our base value. As
average holing period we take 10 years, and we compute the average inflation-adjusted land value gain between 2005
and 2015 at 10.4% (9.7% on east side). So let&rsquo;s use 10%.</p>

<p>That gives an estimate of the annual land value gain of $850,000 over 10 years, or $85,000 on average per year.
As a sanity check, this is in line with estimates of average annual land value gain for single family properties
<a href="http://doodles.mountainmath.ca/blog/2016/01/24/work-vs-twiddling-thumbs/">we have done before</a>, although these weren&rsquo;t
inflation-adjusted.</p>

<p>Roughly estimating that on
average a secondary suite takes up about a quarter of the area of a
house, we attribute $21,250 of the $85,000 annual land value gains to the secondary suite for tax purposes.</p>

<p>Of course capital gains tax are only payable when the property sells, but the yearly average gains accumulate and eventually
properties will sell. In which case we expect capital gains taxes to be payed on $21,250 per year the suite was rented.
So if a person sells a home with a suite that was rented for the last 10 years, the person will have to pay capital gains
taxes on $212,500. On average, we expect $21,250 of taxable capital gains income per house with suite per year.</p>

<p>The way capital gains tax works is that half of the gains are taxed at the marginal tax rate. As these tend to be large
sums of money at a time, it is safe to assume that the the effective tax rate on the gains is relatively high, say 35% or
more. Some of the taxes could be deferred by e.g. transferring the gains into RRSPs and later taxed at a lower rate. But
we will ignore this, it has the effect of lowering the effective tax rate on the gains and move the tax payments into the future,
but will not effect the overall amount of capital gains declared.</p>

<p>Assuming an effective tax rate of 35% on the gains we expect on average $3,700 of taxes payed per home with suite per
year through this mechanism. With
conservatively estimated 30,000 secondary suites in Vancouver that adds up to a tidy sum of $111,000,000 for capital gains
taxes paid due to secondary suites in the City of Vancouver. Per year.</p>

<h2>To Rent or Not to Rent Out a Suite</h2>

<p>Since a rental suite incurs both income and capital gains tax obligations the question arises what minimum rent is required
to offset the capital gains obligations in a particular year. Typically homeowners don&rsquo;t know the annual value value gains
ahead of time, so this is more of an academic exercise than a practical questions. The important takeaway is that the
capital gains exemption has the effect of dramatically lowering the cap rate for converting part of a principal residence
into a rental unit.</p>

<p>The math is quite simple, we need to compare the net rental income (rent minus deductions) to the capital gains taxes
payable due to the rental. A more comprehensive way to look at this is to look at the
CAP rate based on land value investment, in this case the net rental income (after-tax rental income minus deductions)
per land value attributed to the suite. With our standard assumptions this sits at 1.9%.</p>

<p>This we can compare to the effective tax rate on the capital gains, which is given by multiplying half of the tax rate
(as only half the gains are taxed at that rate) with the rate of land value rise, which comes in at 1.75% with our standard assumptions.</p>

<p>To conclude this calculation we define the net cap rate as the difference between the cap rate and the effective tax rate
on the capital gains. If this is positive, it is the advantageous to rent. If it is negative, leaving the property vacant
will yield higher returns.</p>

<p>More specifically if we want to understand if it was advantageous to rent out a suite in a particular year for a particular
property we can adjust the assumptions in the interactive at the bottom accordingly. For example, in the year 2015 we
saw an average land value gain of about 20%. Adjusting the rate in the interactive, and setting the holding period to 1 year,
we get a net CAP rate of -1.6%. The break-even rent, above which it is advantageous to rent out the suite, was $1,820.</p>

<h2>Taxes Collected</h2>

<p>It would be interesting to compare these estimates with actual taxes collected. But this won&rsquo;t be easy without internal
CRA data. The census for example does not break out rental income. But it does break out capital gains income. Not all
capital gains income stems from selling homes with secondary suites of course and again, the census does not break out
the sources of the capital gains income. But capital gains income is rare enough, especially on the suite-heavy east side,
to yield some information.</p>

<p>In the City of Vancouver, a total of
$830 million of net capital gains and losses was reported to the CRA in 2010,
most of which was claimed by people living on the west side. When comparing
to 2010 taxes we should adjust our calculation to the average east side single family land value of $620,000 in 2010 and
might want to assume a very conservative inflation-adjusted land value gain of 5% per year (I have no data before 2005,
but one could use sales data to estimate this better). This would yield an expected taxable annual capital gains of $10,000
per suite in each area (with expected annual taxes generated of $1,750 per suite), adding up to over one third of all
capital gains reported in the City of Vancouver that year. So for a census tract with 500 suites
we would expect on average $5m of capital gains declared per year resulting from property transactions of some
of these properties and attributed to the portion of the properties taken up by a suites (resulting in $1.75m of expected taxes).</p>

<p><a href="https://censusmapper.ca/maps/480">Eyeballing the total capital gains reported</a>
in areas that have a high density of secondary suites suggests that tax compliance could be improved. It seems that the
changes in requiring the reporting of a sale of a principal residence that were announced yesterday will do just that.</p>

<h2>Interactive</h2>

<p>For people interested in adjusting the assumptions made for these estimates I made a quick interactive to facilitate this.
Adjust to fit your own assumptions.</p>

<h4>Assumptions</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>Secondary Suites</td><td><input type="range" id="suite"></td><td id="suiteValue"></td></tr>
<tr><td>Average Portion of House Taken by Suite</td><td> <input type="range" id="area"></td><td id="areaValue"></td></tr>
<tr><td>Average Rent</td><td> <input type="range" id="rent"></td><td id="rentValue"></td></tr>
<tr><td>Average Rent Deductions</td><td> <input type="range" id="deductions"></td><td id="deductionsValue"></td></tr>
<tr><td>Average Marginal Tax Rate</td><td><input type="range" id="tax"></td><td id="taxValue"></td></tr>
<tr><td>Average SFH Land Value</td><td><input type="range" id="land"></td><td id="landValue"></td></tr>
<tr><td>Average SFH Holding Period</td><td><input type="range" id="years"></td><td id="yearsValue"></td></tr>
<tr><td>Average Inflation-Adjusted Land Value Gain</td><td><input type="range" id="gain"></td><td id="gainValue"></td></tr>
</table>


<h4>Computed Quantities of Interest</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>CAP Rate</td><td id="cap_rate"></td></tr>
<tr><td>Effective Cap Gains Tax Rate</td><td id="effective_tax_rate"></td></tr>
<tr><td>Net CAP Rate</td><td id="net_cap_rate"></td></tr>
<tr><td>Break-Even Rent</td><td id="minimal_rent"></td></tr>
</table>


<h4>Annual Taxes Generated</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>Annual Income Tax Generated</td><td id="income_tax"></td></tr>
<tr style="display:none;"><td>Average Annual Adjusted Total Land Value Gain</td><td id="av_lv_gain"></td></tr>
<tr><td>Annual Cap Gains Tax Generated</td><td id="cap_gains_tax"></td></tr>
<tr><td>Annual Total Tax Generated</td><td id="total_tax"></td></tr>
</table>




<div><script>
var percentageFormatter=d3.format(".1%");
var currencyFormatter=d3.format("$,.3r");
var numberFormatter=d3.format(",.0f");

var suiteValue=30000,
    rentValue=1000,
    deductionsValue=0.2,
    landValue=1300000,
    gainValue=0.1,
    yearsValue=10.0,
    areaValue=0.25,
    minimalRentValue=1000,
    taxValue=0.35;
document.getElementById('suite').value=(suiteValue-20000.0)/400.0;
document.getElementById('rent').value=(rentValue-500)/20;
document.getElementById('deductions').value=deductionsValue*100;
document.getElementById('area').value=areaValue*100;
document.getElementById('tax').value=taxValue*100;
document.getElementById('gain').value=(gainValue+0.1)/0.6*100;
document.getElementById('land').value=(landValue-200000)/20000;
document.getElementById('years').value=yearsValue*5;

function updateResults(){
   $('#suiteValue').html(numberFormatter(suiteValue));
   $('#rentValue').html(currencyFormatter(rentValue));
   $('#deductionsValue').html(percentageFormatter(deductionsValue));
   $('#areaValue').html(percentageFormatter(areaValue));
   $('#taxValue').html(percentageFormatter(taxValue));
   $('#landValue').html(currencyFormatter(landValue));
   $('#gainValue').html(percentageFormatter(gainValue));
   $('#yearsValue').html(numberFormatter(yearsValue));

   var value1=suiteValue*rentValue*(1-deductionsValue)*taxValue*12.0;
   $('#income_tax').html(currencyFormatter(value1));
   var lvGain=landValue*(1-(1-gainValue)**yearsValue)/yearsValue;
   var value2=suiteValue*taxValue*areaValue*lvGain/2.0;
   $('#av_lv_gain').html(currencyFormatter(lvGain));
   $('#cap_gains_tax').html(currencyFormatter(value2));
   $('#total_tax').html(currencyFormatter(value1+value2));
   var minimalRent=landValue*areaValue*gainValue/2*taxValue/(1-taxValue)/(1-deductionsValue)/12.0;
   $('#minimal_rent').html(currencyFormatter(minimalRent));
   var capRate=rentValue*12*(1-deductionsValue)*(1-taxValue)/(landValue*areaValue);
   $('#cap_rate').html(percentageFormatter(capRate));
   var effectiveRate=taxValue/2.0*gainValue;
   $('#effective_tax_rate').html(percentageFormatter(effectiveRate));
   $('#net_cap_rate').html(percentageFormatter(capRate-effectiveRate));
}

$('#suite').on('change',function(){
    suiteValue=parseFloat(this.value)*400.0+20000.0;
    updateResults();
});
$('#area').on('change',function(){
    areaValue=parseFloat(this.value)/100.0;
    updateResults();
});
$('#rent').on('change',function(){
    rentValue=parseFloat(this.value)*20+500;
    updateResults();
});
$('#land').on('change',function(){
    landValue=parseFloat(this.value)*20000+200000;
    updateResults();
});
$('#deductions').on('change',function(){
    deductionsValue=parseFloat(this.value)/100.0;
    updateResults();
});
$('#gain').on('change',function(){
    gainValue=parseFloat(this.value)/100.0*0.6-0.1;
    updateResults();
});
$('#years').on('change',function(){
    yearsValue=Math.round(parseFloat(this.value)/5);
    document.getElementById('years').value=yearsValue*5;
    updateResults();
});
$('#tax').on('change',function(){
    taxValue=parseFloat(this.value)/100.0;
    updateResults();
});

updateResults();
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Measuring Housing Affordability]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability/"/>
    <updated>2016-09-14T12:06:06-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/assessment/split_map" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_price_2015.png" style="width:50%;float:right;margin-left:10px;"></a>
Housing affordability is a serious issue that deserves attention. Affordability is generally defined comparing incomes
to housing costs. And ideally also factoring in transportation cost, although that&rsquo;s seldom done and we will not attempt
today.</p>

<p>Recently we <a href="http://doodles.mountainmath.ca/blog/2016/08/31/incomes/">took a detailed look at income data</a>. Using what we
learned, together with our
<a href="https://mountainmath.ca/assessment/split_map">detailed data on the development of prices of single family properties in Vancouver</a>,
we turn to the never dying question of affordability of single family homes.</p>

<!-- more -->


<p><a href="https://mountainmath.ca/assessment/split_map?year=2010" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_price_2010.png" style="width:50%;float:left;margin-right:10px;"></a>
Let&rsquo;s go through the motions of how different choices in income data can lead to different stories. Some general choices of
what income to use is often pretty obvious. Others are more subtle and a matter of judgement. For simplicity we focus
entirely on the situation in 2010, because that&rsquo;s the last year we have detailed income data for the City of Vancouver
and we also have <a href="https://mountainmath.ca/assessment/split_map?year=2010">detailed publicly available single family housing price data</a>.</p>

<p>When talking about housing, the starting point is to look at income of (private) households (as opposed to individual income).
We may also want to consider the owner-renter split in the region we are interested in. For simplicity we will skip this.</p>

<h3>Household Income</h3>

<p>Households are as diverse as
dwelling types. If we write a story about single family housing, household income of all households is too broad to be
relevant. For example,
in the city of Vancouver there are about 75,500 single family lots, but 264,573 households. So at most 28% of households
can live in the main house on a single family lot. Taking the median household income makes no sense in this situation.
We need to narrow down the target group. In Calgary on the other hand,
59% of the dwelling stock is single detached (and there are more properties if we count the ones with suites like we
did for Vancouver), so in that case the assumption that the median household is looking to buy a single family home is
more reasonable. Although the median household probably won&rsquo;t be looking to buy the median single family home but a lower-priced one.</p>

<h3>Family Income</h3>

<p>So how should we measure the affordability of single family properties? That&rsquo;s not an easy question. A natural choice may
be to focus in on the 151,330 census families in Vancouver. Again, there are more than twice as many candidates as single
family properties. So maybe narrow it down even further an only look at the 88,515 census
families with children at home. Or the 63,790 couple families with children at home. Realistically speaking, even
going with couple families with children at home there just aren&rsquo;t enough single family properties to go around. Unless we
are willing to force out all of the roughly 45% of the occupants of the main house on single family lots that currently only have
1 or 2 people living in there. But overall, couple families with children is probably a better metric for affordability
for single family homes. Others will of course also buy single family homes, but maybe we will be less worried if
they can&rsquo;t afford one.</p>

<h3>Family with Children Income</h3>

<p>To complete the example, in 2010 the median single family property cost $848,000 (average $1,133,000) and the median
couple family with children income in private households was $92,068 (average $123,252).
That gives a dwelling value to income ratio of around 9.2, showing that the median single family property is not
affordable for the median couple family with children. By affordable we mean that with a 20% down payment the shelter
costs stay below 30% of pre-tax income, which requires a ratio of at most 6.6 assuming an interest rate of 3% and 25
years amortization.</p>

<p>If we were to more realistically assume that the median income couple family with children were to look to buy a single
family property priced at the 10 percentile level of $606,100 we get a dwelling value to income ratio of 6.6, barely
squeezing in below our affordability cutoff.</p>

<h3>Matching Income Quantiles with Housing Quantiles</h3>

<p>Another way to slice the data is to look at the household income distribution. By definition there are 37,750
single family homes more expensive than the median single family home. From the income distribution there are 44,215
households with income over $125,000. Taking $125,000 as our income we get a median dwelling value to income ratio of 6.8.
Only when throwing in some secondary suite rental income can we get to the
&lsquo;barely affordable&rsquo; 6.6 ratio. Adding rental income is double-dipping though, rental income should already be
included in our total income numbers. Assuming secondary suite rental income is correctly reported.</p>

<h3>Using Median Household Income</h3>

<p>Using the household income instead we would have gotten a ratio of 13.4, which is ridiculously unaffordable. But then
again, the notion that the median household should be able to purchase the median single family property
(or even a low-value single family property) is also ridiculous.</p>

<p><a href="https://censusmapper.ca/maps/37" target="_blank"><img  src="http://doodles.mountainmath.ca/images/local_affordability_index.png" style="width:50%;float:right;margin-left:10px;"></a>
Somewhat more reasonable is to <a href="https://censusmapper.ca/maps/37">compare household income to all housing</a>,
not just single family. This still ignores that
half of the population in Vancouver is renting, but still can yield some interesting insights if one is interested in
more detailed spatial distribution of affordability and compare it to other cities.</p>

<p>Adding a scatter plot of local affordability index by proportion of owner households shows how in Vancouver, unlike
in comparable cities, the percentage of owner households is a weak determinant of local affordability.</p>

<h3>What about Affordability Today?</h3>

<p>This analysis assumes that all these households are comfortable to max out when buying a home and that there are no other
competing significant financial obligations like heavy student loans. And, just as a reminder, we were looking at 2010.
As of 2015 the price of the median single family home has increased 67%. We don&rsquo;t have 2015 income numbers for the City of
Vancouver (yet), but Couple Family median income for Metro Vancouver has increased 13% between 2010 and 2014, the last
year with available data. Extrapolating out that trend to 2015, and assuming that whatever other income metrics we were
looking at, we get an estimated income increase by 16%. So any affordability ratio is about 1.4 times worse in 2015 compared
to the 2010 ratio. What may have been &lsquo;barely affordable&rsquo; in 2010 is clearly unaffordable in 2015.</p>

<p>So we used the detailed income data available for 2010 to get very good understanding of the affordability situation in 2010.
Then we used regional income trends to extrapolate that data to 2015 and matched it with 2015 housing data to get more up-to-date
estimates. This is generally an effective method that yields good results.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Quick Guide to Income Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/31/incomes/"/>
    <updated>2016-08-31T09:17:12-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/31/incomes</id>
    <content type="html"><![CDATA[<p>The news media has an extraordinarily difficult time with income data. And that&rsquo;s only partially the media&rsquo;s fault.
In general, income data is a funny beast. So I decided to give a quick overview over income data that&rsquo;s available through
Statistics Canada. To make things a little more concrete I focused on Vancouver as an example, but everything applies
equally well to any other area in Canada.</p>

<p>Most journalists I talked to care about accurate and relevant statements. If that&rsquo;s you, you will need to keep reading
and dive down the slightly wonkish income rabbit hole.</p>

<p>For those that don&rsquo;t really care, I made a
<em>quotable random income generator</em>. Just hit the &ldquo;generate&rdquo; button copy &amp; paste the result and link this post as source.
(Use at own risk!)</p>

<!-- more -->




<div class='income-generator'>
    <div class='income-choices'>
        <div class="geo"></div>
        <div class="med_av"></div>
        <div class="tax"></div>
        <div class="hh"></div>
        <div> income is </div>
        <div class="income"></div>
    </div>
    <a class="btn btn-default" style="background:orange;">Click to Generate Random Income Numbers</a>
</div>


<p>The income numbers don&rsquo;t fit the story? No problem, just play again until you get something you like!</p>

<h3>Geographic Regions</h3>

<p>The first thing to do when quoting income numbers of any sort is to decide what region to use. Seems straight forward
enough, but in reality <a href="https://twitter.com/vb_jens/status/744407354867736576">hardly ever done</a>. In the Vancouver
context, it simply comes down to deciding if one wants to
report on income for the City of Vancouver or Metro Vancouver. Both are frequently referred to as just &ldquo;Vancouver&rdquo;. Which
is just fine as long as it is clear from the context which region we are talking about. And more importantly, whatever
the income is compared to (e.g. housing price data) are taken for the same region.</p>

<h3>Base Demographics</h3>

<p>Next we have to choose a base demographic we are interested in, choose which income distribution is relevant for our context.
In some cases this choice is obvious. If we are writing a story on lone parents in the City of Vancouver, we would want
to look at the income distribution of lone parent households. If we are looking at the development of wages, we should
consider individual incomes. For a story on consumer spending we may want to look at after-tax income.</p>

<p>We may also be interested in specific type of income, for example only in investment income. Or the net capital gains
and losses. Or pension benefits. Or self-employment income.</p>

<h3>Statistic</h3>

<p>Often we would like to distill everything down to a single number. Typically we would choose the average or median
income from the distribution we are interested in, but we may also choose other statistics, for example the top quintile.
Which one we choose really depends on the story. As a rule of thumb, choose median incomes if you are interested in the
&lsquo;typical&rsquo; person or household. Choose average income if you are interested in the questions relating to the total amount
of money earned in a given area. Income quantiles are great to focus in on certain subgroups of the population.</p>

<h3>Availability</h3>

<p>Generally we also have to consider the availability of information. The census has very detailed income data in their
standard release that allow us to be very specific about what kind of incomes we are interested in. And if that&rsquo;s not
enough we can make a special request to StatsCan to narrow the incomes down to a group we are interested in, for example incomes
of renter households as was done in the <a href="http://rentalhousingindex.ca">rental housing index</a>.</p>

<p>Annual income data is available from CANSIM (Statistics Canada&rsquo;s socioeconomic database), but the geography is coarser
than in the census. Generally we can only
expect to get annual data for the whole country, provinces, census metropolitan areas, but not census
subdivisions (municipalities) or finer geographies.</p>

<h3>Sources and Comparability</h3>

<p>All income data eventually come down to CRA taxfiler data. But the devil is in the details. For the 2006 and 2011
censuses, there was a mixture between self-reporting and cross-referencing of individual level income data with CRA data.
And even self-reported data would again undergo quality control and get somewhat adjusted according to CRA data.</p>

<p>But there are important differences in the data, both on what kind of income is included and also what people are included.</p>

<p>The details are endless, many of them won&rsquo;t matter. Here are a couple to look out for:</p>

<ul>
<li>CANSIM is a comprehensive sample, census data is roughly a 1 in 5 subsample which may lead to sampling bias especially
in small geographies.</li>
<li>CENSUS data is sensitive to non-return bias. Not just no-return bias introduced by the NHS, but also by census undercounts
which, for example, were in the 10% range for the 25 to 29 year old demographic in both the 2006 and 2011 censuses.</li>
<li>CANSIM and the Census have different denominators for reporting average or median incomes. CANSIM reports on all
T1 taxfilers, as well as various family types. Some data can be broken out into age groups at
the 15 and 65 year cutoffs,
whereas Census reports only on people (15 or older) (or families or households) in &ldquo;private households&rdquo; with income greater
than zero.</li>
<li>the definition of &ldquo;private household&rdquo; changed between 2006 and 2011 censuses.</li>
<li>2011 and 2006 censuses differ slightly in what is included as income, for example
<a href="http://www12.statcan.gc.ca/census-recensement/2006/ref/dict/pop123-eng.cfm">2006 included RRSP withdrawls</a>,
<a href="https://www12.statcan.gc.ca/nhs-enm/2011/ref/dict/pop123-eng.cfm">2011 didn&rsquo;t</a> (both include pensions and RRIFs).
2011 includes net capital gains and losses as a percentage of total income in a separate category, 2006 did not
include any information on capital gains.</li>
</ul>


<p>So even when comparing CANSIM income data to census income data for the appropriate year we should expect some differences.
Or comparing 2006 to 2011 income, even if hypothetically an area had identical tax returns, we would still see differences.
Generally speaking, CANSIM average and median income estimates are lower than census estimates as it includes a larger pool
of people that are likely to have lower income.</p>

<h3>Where to get the goods?</h3>

<p><img  src="http://doodles.mountainmath.ca/images/yvr_income.png" style="width:50%;float:right;margin-left:10px;">
The latest census income numbers are available via <a href="https://www12.statcan.gc.ca/nhs-enm/2011/dp-pd/prof/index.cfm">Statistics Canada</a>.
I am biased and prefer the <a href="https://censusmapper.ca/maps/467">CensusMapper</a> interface. For 2011 data, choose any
2011 CensusMapper map, select the geographic
region you are interested in and press the &ldquo;more&rdquo; button on the popup to bring up the &ldquo;census wheel&rdquo;. Then drill into the
&ldquo;income&rdquo; section, the last NHS variable in the widget.</p>

<p>CANSIM has annual data based on taxfiler information for coarser geographies. So you won&rsquo;t be able to get data for the City of Vancouver
or neighbourhoods within the city like with census data, but you can get data for Metro Vancouver. And you can get it for
more recent years. Things get complex very fast there are
<a href="http://www5.statcan.gc.ca/cansim/a33?themeID=3868&amp;spMode=tables&amp;chunkSize=213">213 CANSIM tables with income data</a></p>

<p>At CensusMapper we are still firmly planning integrate CANSIM data into the CensusMapper interface, but their API refresh got pushed back
to sometime 2018 and we can&rsquo;t justify the extra resources to integrate CANSIM data temporarily using the old API just
to switch it over a year later.</p>

<h3>Too Abstract?</h3>

<p>Want to see how this works on an example? Just read the
<a href="http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability/">next post on using income data for housing affordability</a>.</p>

<script>
var geoData=['City of Vancouver','Metro Vancouver'];
var med_avData=['median','average'];
var taxData=['pre-tax','after-tax'];
var hhData=['individual','household','family','family with children'];
$('.income-generator .btn').on('click',function(e){
     $('.income-generator').addClass('active');
     $('.income-choices .geo').text(geoData[Math.round(Math.random())]);
     $('.income-choices .med_av').text(med_avData[Math.round(Math.random())]);
     $('.income-choices .tax').text(taxData[Math.round(Math.random())]);
     $('.income-choices .hh').text(hhData[Math.round(3.9999*Math.random()-0.5)]);
     $('.income-choices .income').text('$' + Math.round(80*Math.random()+40)+',000');
});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What's up with RT?]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/04/rt/"/>
    <updated>2016-08-04T13:18:51-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/04/rt</id>
    <content type="html"><![CDATA[<p>RT is Vancouver&rsquo;s zoning for duplexes. Over time, various areas have been zoned to allow duplexes. Examples are
Kits Point, much of Point Grey Road reaching up to Broadway, much of Granview-Woodlands, parts of Mount Pleasant and many
other areas.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=4&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt_teardowns.png" style="width:50%;float:right;margin-left:10px;"></a>
Recently I have had some interesting conversations <a href="https://twitter.com/fixbced/status/748196970783637504">on Twitter regarding RM-6</a>
and over BBQ dinner about RT-7. Then the
<a href="http://vancouver.ca/home-property-development/grandview-woodland-community-plan.aspx">Granview-Woodland plan</a>
passed by council, and it contains a curious provision of reducing the outright FSR for the
RT-zoned properties from 0.6 to 0.5.</p>

<p>All of which got me thinking. What is RT supposed to accomplish, how does the diverse RT-zoning rules influence development
and how is RT overall performing?</p>

<!-- more -->


<p>To make things complicated many RT zoning rules contain provisions to allow for higher FSR, and more than two units,
under the &ldquo;heritage preservation&rdquo; program. Most people like the multi-plex developments that come out of this process,
but the road there is quite adurous. Permitting takes a long time and is marred by uncertainty. Those projects are
done by small developers, that are ill-equipped to deal with risky and drawn-out rezoning processes.</p>

<p>These would be great projects carried out by small developers that lead to gentle and affordable density,
as this kind of re-development does not require land-assembly and does not lead
to crazy land-value lifts that require CACs to claw back some of that value rise
<a href="http://doodles.mountainmath.ca/blog/2016/04/01/on-dirt-and-houses/">as we explained before</a>.</p>

<p>We have some ideas what a refreshed RT (and RS) should look like, and there are
<a href="https://pricetags.wordpress.com/2016/07/29/open-letter-on-the-downzoning-of-grandview-woodland-rt/">some efforts to push for changes</a>.
We leave the details of this to the experts and take a little field expedition to
see how the different flavours of RT (and RM) perform in data.</p>

<h3>Why RT?</h3>

<p>One central question to ask is: What is the purpose of RT (or any) zoning? The initial idea was to allow higher density
than RS, with two stratified properties on one lot. But since the creation of RT the RS zoning has undergone significant
changes and allows, in many cases, for higher FSR and higher unit count, although not stratified. In much of RS three
units are allowed on each lot, the main house, a secondary suite and a laneway house.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=5&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rs_rt_land.png" style="width:50%;float:left;margin-right:10px;"></a>
So how does RT perform in the wild? There seems to be little effect RT vs RS zoning has on land values. The
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=6&amp;mapBase=2">boundaries between RS and RT</a>
can&rsquo;t be discerned from a
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=5&amp;mapBase=2">land value map of all residential properties in RS, RT (and First Shaugnessey) zones</a>.</p>

<p>How good are RT lots at realizing &ldquo;zone capacity&rdquo;, that is how many of the historically SFH get turned over into duplexes,
or in some cases multi-plexes (through the heritage presercation program)?
That depends as the following graph shows.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_sfh" style="height:200px;max-width:640px;" data-url="/data/zone_sfh.json"></div>
</div>


<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/types_rt.png" style="width:50%;float:left;margin-right:10px;"></a>
We can also study this by mapping out
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">all residential lots in RT zones</a>,
and color them depending if they are single family lots, duplexes or multi-plexes.</p>

<p>Some RT areas are essentially indistinguishable from RS areas, they are almost entirely comprised of single family lots.
A good example is the
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-4,residential]&amp;zoom=14&amp;lat=49.2733&amp;lng=-123.0646&amp;layer=20&amp;mapBase=2">RT-4, most of which is in Grandview-Woodlands</a>.
And being in RT rathern than RS they often don&rsquo;t even get the benefits of a laneway house. Coach houses, which are legal
in many RT areas and could be stratified, come with such onerous side setbacks that they are very hard to build on
regular lots.</p>

<p>There is a lot of untapped &ldquo;zoned capacity&rdquo;. Similarly, some of the
newer RM zones show little appetite for realizing &ldquo;zoned capacity&rdquo;, possibly due to the added difficulty of having to
assemble lots to do so.</p>

<p>One can argue about whether this is good or bad. Or one can look at the variation between the different types of RT and RM
zones to see what causes the difference.</p>

<h3>Downzoning</h3>

<p>To understand how downzoning works we want to consider two different types on analysis. One is to look at what happened
after RS zone was changed to reduce site coverage in the 1980 in response to concerns about &lsquo;monster homes&rsquo;. We ran
an analysis using LIDAR data to understand the effect on the physical form of SFH and found that while site coverage
indeed decreased sharply, the <a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">bulk of the building remained unchanged</a>.
and the rule change seems to have done little in easing concerns about &lsquo;monster homes&rsquo;, it simply changed some of the
parameters determining what &lsquo;monster homes&rsquo; look like.</p>

<p>Another way to look at the matter is to compare how re-development happened in difference zones. This is very hard, since
there are many factors other than zoning that determine if a building gets re-developed. To get some idea we compiled two
numbers for each of the RS, RT and RM zones (ignoring some of the delicacies in the zoning code and lumping together all
sub-zones with the same leading number. So for example we lumped RT-4, RT-4A, RT-4N and RT-4AN into one category we simply
label &ldquo;RT-4&rdquo;.</p>

<p>First we check how many residential properties got re-developed since 2000.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_redevelopment" style="height:200px;max-width:640px;" data-url="/data/zone_redevelopment.json"></div>
</div>


<p>Next we take a look what percentage of the existing residential stock is in immediate danger of being torn down, using the
<a href="http://doodles.mountainmath.ca/blog/2016/01/18/redevelopment/">methodology developed earlier</a>.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_teardown" style="height:200px;max-width:640px;" data-url="/data/zone_teardowns.json"></div>
</div>


<p>While there is some correspondence between re-development activity and ratio of teardowns, there are a number of notable
exceptions. RT-1 and RM-9 stand out, but these are
<a href="https://mountainmath.ca/map/assessment?filter=[zoneE_RM-9_RT-1]&amp;zoom=14&amp;lat=49.2146&amp;lng=-123.1282&amp;layer=5&amp;mapBase=2">oddball cases with just a few properties</a>.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/new_types_rt.png" style="width:50%;float:right;margin-left:10px;"></a>
We can also map just <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">residential properties in RT that were re-developed since 2000</a>
and colour them by SFH, Duplex and Multi-plex status. We can clearly see how some RT areas, like RT-7, don&rsquo;t see much
re-development, others, like RT-6 see mostly multi-plexes being developed. Some zones, like RT-10, 11, 12 are too new
to be judged on development happening since 2000. For example, zooming in on
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT-10,residential,years_2009]&amp;zoom=15&amp;lat=49.2485&amp;lng=-123.0734&amp;layer=20&amp;mapBase=2">developments in RT-10 since 2009 paints a very different picture</a>.</p>

<p>There is lots of stuff to explore, but for today I want to look at RT-7 and RT-6 in more detail.</p>

<h4>RT-7</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&zoom=15&lat=49.2617&lng=-123.1654&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-7.png" style="width:50%;float:left;margin-right:10px;"></a>
A much more interesting case is RT-7, with 35% of properties teardowns but only 4.1% of properties re-developed since 2000.
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=4&amp;mapBase=2">Looking at the map</a>
we see that RT-7 is comprised of two pockets on the west side, and the teardown candidates stand out in red and orange.
Filtering further to see what
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential,years_2000]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=20&amp;mapBase=2">has been re-developed since 2000</a>
we see that, considering the size of the two pockets, re-development favours the eastern pocket near 16th and Arbutus. We
can clearly see that that the eastern pocket has an overall more valuable building stock, although it is not clear if that
is due to higher rates of re-development or for other reasons, for example the presence of some slightly larger lots. We
also note that re-development does produce duplex units and even some multi-plex.</p>

<p>So what is going on here? Looking at the <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-7.pdf">RT-7 zoning</a> we
see that the area has been downzoned to 0.4 FSR as was rencently pointed out to me, which can conditionally be upzoned
to 0.6 FSR. Additionally, there are caps on the number of units per hectar to further restrict density.</p>

<h4>RT-6</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&zoom=16&lat=49.2606&lng=-123.1097&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-6.png" style="width:50%;float:right;margin-left:10px;"></a>
Another interesting example is RT-6. RT-6 has seen modest levels of re-develpment and has a <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2606&amp;lng=-123.1097&amp;layer=4&amp;mapBase=2">relatively healthy building
stock</a>.
What&rsquo;s even more interesting is that it contains
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">many multi-plexes</a>.
And more importantly, <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential,years_2000]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">developments since 2000 have mostly produced multi-plexes</a>.</p>

<p>Prime examples of the <em>gentle density</em> that we keep hearing about. I would say that something is working very well here.</p>

<p>So what&rsquo;s the difference? In contrast to RT-7 <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-6.pdf">RT-6 zoning</a> allows for 0.6 FSR
outright, conditionally increased to 0.75. But there are other important differences too. The RT-7 lots are typically
smaller with many at about 340m&sup2; compared to the 580m&sup2; typical RT-6 lots.
(Although RT-7 also contains some 580m&sup2; lots).</p>

<h3>Conclusion</h3>

<p>Does downzoning work? It depends what the goal is. Looking at the RT-7 example, downzoning has slowed re-development compared
to other areas in the city, but it also lead to a deterioration in building stock in RT-7. This is a stop-gap measure,
eventually that lower value building stock will get re-developed.</p>

<p>The combination of larger lots and the heritage retention program in the RT-6 zoning seems to work in producing
gentle density, except that the permitting process takes too long and it is not immediately clear what purpose the
heritage preservation has that allows stripping the building down to the studs and possibly moving it to the front and
then building an infill in the back. There must be a better way to deal with concerns behind
heritage preservation (not much is &ldquo;preserved&rdquo; in this process) and at the same time cut down on the time it
takes to jump through all the permit hoops involved.</p>

<p>It is clear that RS and RT (and RM) zoning would hugely profit from a clearer vision what these zonings should accomplish
and by using data to benchmark how these targets are met.</p>

<div><script>

function bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter,rangeLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d");
    if (!rangeLabelFormatter) rangeLabelFormatter=rangeFormatter;
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;

d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  
  var container=d3.select(div.node().parentNode);
  container.selectAll('.legend.no-margin').remove();
  var legend=container.append('div').attr('class',"legend no-margin");
  legend.append('p').html('<i style="background:'+graphData.color + '"></i>' + graphData.label +  '<span style="float:right;margin-right:10px;" id="' + graphData.class+'_value"></span>');
  
  x.domain(data.map(function(d) { return d.date }));
  y.domain([0, d3.max(data, function(d) { return d.count; })]);
  
  var domainTickValues=[];
  var skip=Math.round(40/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", graphData.class + " bar")
      .style("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.count); })
      .attr("height", function(d) { return height - y(d.count); })
      .on('mouseover',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('click',function(d){
       d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('touch',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('mouseout',function(){d3.select('#'+this.classList[0]+'_value').text('')});

      
});

}



var percentageFormatter=d3.format(".1%");
var textFormatter=function(d){return d};
var teardownLabelFormatter=function(d){return percentageFormatter(d) + " teardowns"};
var sfhLabelFormatter=function(d){return percentageFormatter(d) + " SFH"};
var redeveopmentLabelFormatter=function(d){return percentageFormatter(d) + " built since 2000"};
bar_graph(d3.select("#graph_redevelopment"),false,textFormatter,percentageFormatter,textFormatter,redeveopmentLabelFormatter);
bar_graph(d3.select("#graph_teardown"),false,textFormatter,percentageFormatter,textFormatter,teardownLabelFormatter);
bar_graph(d3.select("#graph_sfh"),false,textFormatter,percentageFormatter,textFormatter,sfhLabelFormatter);
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mixing Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data/"/>
    <updated>2016-07-06T09:19:04-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data</id>
    <content type="html"><![CDATA[<p>Census data is very rich and with <a href="https://censusmapper.ca">CensusMapper</a> we now have about 1 billion data points right at
our fingertips. And we have managed to open up some of our interfaces for everyone to <a href="http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone/">explore data and make their own maps
and freely share them</a>.</p>

<p>Things really get interesting when one mixes custom data with census data. While, at this point, these are not part of
the freely available CensusMapper functionality we still wanted to share what can be done.</p>

<p>At CensusMapper we have developed three basic ways to rapidly mix custom data with census data. So this is really three
blog posts in one.</p>

<!-- more -->


<h3>1. Overlay Mapping</h3>

<p>First up, advanced users can upload custom datasets and map them on top of census data.
<a href="http://doodles.mountainmath.ca/images/restaurants_2.png"><img  src="http://doodles.mountainmath.ca/images/restaurants_2.png" style="width:50%;float:right;margin-left:10px;"></a>
For example, we took a
<a href="http://data.vancouver.ca/datacatalogue/businessLicence.htm">business license dataset</a> from the City of Vancouver open
data catalogue, filtered it by the <em>BusinessType</em> field to only include businesses starting with &ldquo;Restaurant&rdquo; or
&ldquo;Liquor Establishment&rdquo; and uploaded them to CensusMapper to map it on top of census data. We have used a map
for <em>median age</em> that was <a href="https://twitter.com/jofu_/status/750564269796823041">recently created using CensusMapper&rsquo;s free public interface</a>
(have you made <a href="https://censusmapper.ca/maps/new">your own CensusMapper map</a> yet?), we have faded out areas outside of
Vancouver and coloured <em>Liquor Establishments</em> in red and <em>Restaurants</em> in blue.</p>

<p>Giving a visual impression of your own dataset in relation to census data is the first step to location analysis.</p>

<h3>2. Populate Custom Data with Census Data</h3>

<p>Next
up is to populate your own dataset with census data for further analysis. For the restaurants, we may be interested in
attaching population estimates in 5 minute walking distance from each location. We might also be interested in specific
age brackets, or numbers of recent immigrants
from specific countries that we may want to target with a new restaurant, or maybe even     income data.</p>

<p>This can be a time consuming and painful process,
but we have automated this at CensusMapper.</p>

<p>To showcase how this works we will show an example using elementary school catchment areas in the City of Vancouver. The
areas we have (from the <a href="http://data.vancouver.ca/datacatalogue/publicPlaces.htm">Vancouver Open Data Catalogue</a>) are
quite out of date, but for the purpose of this example they work as we will compare them to 2011 census data. We will look at the
<a href="https://censusmapper.ca/maps/419">school aged population</a> in each catchment.</p>

<!--
The general census release data does not fit our task perfectly, the census splits by age in early May 2011 and not by
year born and it does not have fine enough age brackets to estimating accurate school catchment numbers.
[BC Stats](http://www.bcstats.gov.bc.ca/StatisticsBySubject/Demography/PopulationEstimates.aspx) has finer age brackets
computed to school district (not catchment) boundaries, but their estimates are ridiculously far off of census numbers
when using matching age brackets and years that their usefulness is highly questionable. 
-->


<p><a href="http://doodles.mountainmath.ca/images/e-schools.png"><img  src="http://doodles.mountainmath.ca/images/e-schools.png" style="width:50%;float:left;margin-right:10px;"></a>
Using the visual overlay we notice that the catchment areas do fit boundaries of Dissemination Areas shown on the map
reasonably well, with some exceptions. The same cannot be said for Census Tracts, we can be reasonably confident that
Dissemination Area data is fairly accurate.</p>

<p>Next we use the built-in CensusMapper functionality to automatically populate the catchment areas with the census
data we are interested
in. When Dissemination Areas don&rsquo;t line up with the catchment boundaries we go down to Dissemination Blocks to estimate
how many children live on what side of the catchment boundary. We
<a href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/">previously explained this process in more detail</a>, the result is
a spreadsheet with the population data by age for each catchment area.</p>

<div id='schools'></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/colorbrewer.js" charset="utf-8"></script></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/school_bar_graph.js" charset="utf-8"></script></div>


<p>Here we show the results by school, the select element can be used to select any school of interest. The whole process
of populating the school data with census data just required uploading the catchment boundaries and selecting which
variables to attach.</p>

<h3>3. Custom Census Data Mapping</h3>

<p>Sometimes it is not practical to map custom data on CensusMapper. Maybe the custom data is too sensitive to be uploaded
to CensusMapper servers. Or it is quite complex and is better mapped separately. So we created an API to pull in
census data from CensusMapper to easily show census data on custom maps. And dynamically mix in your own data. As an
example we mix census data with data from BCAssessment, again obtained through the
<a href="http://vancouver.ca/your-government/open-data-catalogue.aspx">Vancouver Open Data Catalogue</a> (and enriched with
<a href="http://www.metrovancouver.org/data">open data from Metro Vancouver</a>).
For demonstration purposes take Dissemination Area
geographies and Dwelling Characteristic data from CensusMapper and mash it up with our
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2604&amp;lng=-123.1417&amp;layer=14&amp;mapBase=2">processed assessment data</a>
to explore the <a href="http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use/">differences in how single family properties are classified</a>.</p>

<p><a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=0" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_unit_count.png" style="width:50%;float:right;margin-left:10px;"></a>
For example we can <a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=0">compare BC Assessment single family lot count to Stats Canada unit count</a>
in the dissemination areas
that are exclusively made up of single family lots. This gives an indication of how many suites and laneway houses there
are in those areas. The census is prone to undercount units, but still does a better job at estimating them than other data sources,
like the city or BC Assessment.</p>

<p>One of the reasons why census unit counts come up higher than other methods is that the census also counts illegal units,
which naturally are not part of other official government counts. There are different reasons why a suite may be illegal:
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=5" target="_blank"><img  src="http://doodles.mountainmath.ca/images/illegal_units.png" style="width:50%;float:left;margin-right:10px;"></a>
It could simply be that the owner has not made the effort to register it. Or the suite may not be up to code.
And in some cases, a property may have more than one suite in the main building, which is illegal in the City of Vancouver.
The latter ones we can pick out in census data, since a house with two secondary suites &ndash; so three dwelling units in one building in
total &ndash; is classified as being an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. So, in census dissemination areas that
only have duplex or single family lots as residential land uses based on assessment and land use data, we can look for
how many dwelling units the census places in an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. And
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=5">map them</a>.</p>
]]></content>
  </entry>
  
</feed>
