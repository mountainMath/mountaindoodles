<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vancouver | Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/blog/categories/vancouver/feed.atom" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2016-03-28T23:59:59-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[On Mixed Use]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/28/on-mixed-use/"/>
    <updated>2016-03-28T23:37:16-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/28/on-mixed-use</id>
    <content type="html"><![CDATA[<p>Redeveloping single storey commercial properties into mixed use is taking off in Vancouver right now. It&rsquo;s a little frustrating
to see how pretty much every story I have seen on this get the effect this has on property taxes wrong, including one on the generally quite good
<a href="https://pricetags.wordpress.com/2016/01/25/guest-on-retail-and-an-evolving-environment-with-a-short-historic-note/">Price Tags blog</a>.
Property taxes are an important piece of the puzzle in Vancouver, so I decided to go into a little detail on this.</p>

<p>Long story short, re-developing single story commercial into mixed use lowers the commercial property taxes. Dramatically.</p>

<!-- more -->


<h3>Commercial Property Taxes</h3>

<p>In Vancouver, the commercial property tax rate is five times the residential rate. Toronto also has higher property tax
rates for commercial, 3x in their case, I don&rsquo;t know how this plays out more broadly. Nor do I know when and why these
decisions were made. Generally cities have a hard time to keep space for residential areas in or close to the central
business district, and higher property taxes may help to uphold the zoning restrictions in place and keep residential
properties in close proximity to commercial.</p>

<p>The effect of the unequal tax rates is quite stark
<a href="http://www.mountainmath.ca/assessment_gl/map">when visualizing taxes collected per area</a>. And this keeps residential
property taxes low.</p>

<p>If Vancouver were isolated from everyone else it would not make much of a difference. Stores pass the
higher property taxes on to residents by charging higher prices, and offices pass them on to employees through lower wages.
Things get more complex when Vancouver is seen as part of metro, or Canada or in the world. But that discussion goes into
a different direction.</p>

<p><a href="http://www.mountainmath.ca/assessment_gl/map" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tax_density_mixed_use.png" style="width:50%;float:right;margin-left:10px;"></a>
On the <a href="http://www.mountainmath.ca/assessment_gl/map">interactive 3D tax density map</a> we can clearly see that the some mixed use properties (in darker red) generate lower total property
taxes than comparable pure commercial properties nearby. We will explore this in more detail in the next section.</p>

<p>For Vancouver it is also important to note that commercial leases are generally trip net, in particular the tenant pays
the property taxes. And they are quite substantial. The important number is the gross rent, which is the sum of rent, taxes,
utilities and other costs borne by tenants. That number is determined by the willingness of a tenant to lease the commercial
space, which in turn determines the rent a commercial landlord can charge for the space. In theory at least, in practice
some commercial landlords develop a relationship with their tenants and don&rsquo;t increase rents for old tenants as much as
the market would bear.</p>

<h3>Taxes for Commercial vs Mixed Use</h3>

<p><img  src="http://doodles.mountainmath.ca/images/w_broadway.png" style="width:50%;float:left;margin-right:10px;">
Let&rsquo;s look at and example, the adjacent properties at
3071 and 3063 W Broadway. The first is single story commercial, the latter two story mixed use. They have almost identical
lot sizes and assessed land and building values, with the mixed use property having slightly higher overall assessed value.</p>

<p>How about the property taxes? In 2015, the 2016 taxes aren&rsquo;t out yet, the single story generated $47,797 in taxes, the mixed
use only $32,031. The reason is simple. The single story property
simply pays 5x the residential rate. For mixed use, the value gets divided up between two stories, so half the value pays
5x residential rate, the other half gets taxes at 1x residential rate. So the effective tax rate for the mixed use is 3x
residential rate. Well, the actual effective rate is 3.35x residential, probably because the first floor carries a little
higher value than the second floor.</p>

<p>The net effect is that the mixed use commercial tenant pays just over half of the property taxes as the pure commercial
tenant next door. So the mixed use commercial landlord will charge exactly that much more rent, so that the gross rent
for both commercial tenants is about the same.</p>

<p>Feel free to play with the <a href="http://mountainmath.ca/map/assessment?zoom=14&amp;layer=10">tax density</a> and
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;layer=14">land use</a> map and click into properties to see a more detailed break-down of
taxes. Be warned that the land use dataset is not perfect in identifying every commercial vs mixed use place.</p>

<h3>A Re-Developmet Example</h3>

<p><img  src="http://doodles.mountainmath.ca/images/main1.png" style="width:50%;float:right;margin-left:10px;">
Let&rsquo;s see how this works when a property gets re-developed. To keep things simple, let&rsquo;s look at something that went
from single story commercial to two story mixed use. 6621 Main Street got re-developed around 2009/2010 and now spans
addresses 6615, 6621 and 6623.</p>

<p>Behind the original 6621 are now three stratified residential units, the other two addresses are the front doors for the
two commercial units that replace the two commercial units behind the original 6621 address.</p>

<p><img  src="http://doodles.mountainmath.ca/images/main2.png" style="width:50%;float:left;margin-right:10px;">
So what happened to property taxes from 2009 to 2010? In 2009 the combined tax levy was $22,102,
in 2010 it was $16,859, of which $2,994 was payed by residential stratas and $13,865 by the two commercial.</p>

<p>For comparison,
the commercial property next door saw their property tax climb lightly from $20,754 in 2009 to $20,794 in 2010. So the
decrease in property taxes we see is really due to the re-development to mixed use.</p>

<h3>Bottom Line</h3>

<p>So what&rsquo;s the bottom line for mixed use re-development? Overall it looks pretty good, let&rsquo;s go down the list of all
parties involved.</p>

<h5>City bottom line</h5>

<p>For conversion to two story mixed use, the city collects less
property taxes than before and the overall mill rate goes up a tiny amount. Conversion to three stories or higher and
total tax revenue for the property goes up and the overall mill rate goes down a tiny amount.</p>

<h5>Commercial tenant bottom line</h5>

<p>The property tax rate goes down substantially, but rent will go up as the gross rent is determined by the market. So not
much changed assuming the form factor of the stores stay the same. In theory at least. If the commercial land lord was
giving a long time tenant a break on their rent before re-development, the tenant will have a hard time to find a different
commercial location with comparable gross rent.</p>

<h5>Residential tenant bottom line</h5>

<p>Added supply can only help. In some cases units will get stratified and sold off, in other cases the property owner keeps
the residential units as rental.</p>

<h5>Property owner bottom line</h5>

<p>Especially with the recent change in lending practices that focus on cache flow, mixed use re-development becomes very attractive.
After re-development, landlords can charge higher rents because commercial property taxes go down. And they can rent out
the residential units for added cash flow. That way, when they take that property to the bank to get a loan for their
next project they can show a large cache flow and get a bigger loan. And the re-development cycle keeps going. And with
almost everyone re-financing their properties a couple of years ago at roughly the same time, when interest rates hit rock-bottom, everyone is
now gearing up at the same time to re-develop.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Unoccupied Dwellings]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/08/unoccupied-dwellings/"/>
    <updated>2016-03-08T14:07:47-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/08/unoccupied-dwellings</id>
    <content type="html"><![CDATA[<p>Today the City of Vancouver <a href="http://council.vancouver.ca/20160308/documents/rr1presentation.pdf">released their report</a>
on unoccupied dwelling units in the city. I watched part of the presentation and read through the report, and from all
that I can see the methodology used is very solid.</p>

<p>I have seen some confusion and even some incorrect reporting on this, so I thought it would be worthwhile to look into
the report in detail.</p>

<!-- more -->


<h3>The Data</h3>

<p>Smart meter data can be used to determine very accurately which units
are occupied and which ones are not. In theory at least, in practice this is quite difficult because of the sheer magnitude
of the data. That&rsquo;s why this is best left to companies who specialize in this kind of analysis, which is exactly what the
city has done.</p>

<p>The only problem is that not all units have smart meters. I don&rsquo;t know how far BCHydro has come with their rollout, but
most condo units should have smart meters by now, as do newer single family units. So what to do about the housing that
does not have smart meters? That&rsquo;s where things get tricky. Some studies I have seen use cutoffs for monthly electricity
consumption to determine which are unoccupied. The problem is to find the right cutoff. Typically these studies report
rates computed using several cutoffs to address that uncertainty. The problem is that different cutoffs give very different
results. For example, <a href="http://www.btaworks.com/wp-content/uploads/2009/12/btaworks_condo_study_report_final2.pdf">this study</a>
looked at 75kWh and 100kWh as monthly consumption cutoffs and reported 5.5% and 8.5% unoccupancy rate, respectively. I checked my condo unit
when it was unoccupied for two months one summer, my two fridges pushed me well above the 100kWh threshold. So my unoccupied
unit would have been counted as occupied in this study.</p>

<p>So how did the new study deal with this problem. We did not hear technical details, but during the presentation it was
explained that smart meter data was used to &ldquo;train&rdquo; a model to use dumb meter data. That&rsquo;s exactly the right approach. Going
by the fact that everything was done right I am reasonably comfortable to assume that this part was also done in a way to
give accurate aggregate numbers.</p>

<p>I am hoping that the technical report will still come out so we can be confident that the details were taken care of
properly. In particular I would like to know how the model dealt with different housing types, and how the housing type
was tied to the electricity bill. What ratio of dwellings of each housing type had smart meter data available? And most
importantly, what are the uncertainty estimates on the numbers presented?</p>

<p>Bottom line on data: Solid.</p>

<h3>Results</h3>

<p>The big takeaway is this one graph:</p>

<p><img  src="http://doodles.mountainmath.ca/images/unoccupied-trends.png" style="width:50%;float:left;margin-right:10px;">
It shows that no matter what timeframe is used to define &ldquo;unoccupied&rdquo;, the rate stayed flat over time. In context of
the current affordability discussion this means that this is unlikely a driving factor of Vancouver&rsquo;s skyrocketing
real estate prices. But the absolute numbers are still quite large and there is a lot of untapped potential. While some people
have argued that supply has not been the main part of the cause of the price hike in Vancouver, it is clear that it must
be a big part of any solution. Finding effective ways to get this untapped supply online should be a priority, it is easier
and more efficient than building new housing in NIMBY-zoned Vancouver.</p>

<p>The other takeaway is that unoccupied units are dominated by condos.</p>

<p><img  src="http://doodles.mountainmath.ca/images/unoccupied-apartment.png" style="width:50%;float:right;margin-left:10px;">
The graph shows the rate for apartments, which also includes purpose built rentals. As the report points out, if we
take out the purpose-built rentals, which have vacancy rates well below 1% at any given time and are extremely unlikely
to stay vacant for two or more months, we arrive at a rate of about 12.5% of condos that are unoccupied in the City of
Vancouver. As should be expected, that&rsquo;s significantly higher than what the non-smart meter studies picked up.</p>

<h3>Are rates in Vancouver higher than elsewhere?</h3>

<p>That depends exactly on what the question asks. And this is where, in my opinion, the city report fails to give a good
answer.</p>

<p><img  src="http://doodles.mountainmath.ca/images/unoccupied-apartment-comparison.png" style="width:50%;float:left;margin-right:10px;">
The City implied, <a href="http://www.theglobeandmail.com/news/british-columbia/vancouvers-vacant-homes-in-line-with-other-cities-but-condos-most-likely-empty/article29072573/">and newspapers now report</a>
that Vancouver numbers are &ldquo;in line&rdquo; with other comparable cities. That claim is based on this graphic,
which is included in the report and stems from a <a href="http://www.urbanfutures.com/foreign-unoccupied/">study by Urban Futures</a>.
The study shows that the Metro Vancouver&rsquo;s rate of unoccupied <em>apartments</em> is not much different from other Metro regions.</p>

<p>The problem is that this study is read as giving the <em>overall</em> occupancy rates are similar across metro regions, which is not
the case. This is a fine point and a little technical, let&rsquo;s take a look at the actual rates of unoccupied dwellings in
the larges metro areas.</p>

<div id="unoccupied_cma" class="land_use" style="width:300px;float:right"></div>


<p>We took these numbers from a <a href="http://www.cmhc-schl.gc.ca/odpub/pdf/68323.pdf?lang=en">CMHC report</a> that looked into this
question and used the same data and methodology as Urban Futures, except they based it on all dwelling units instead of
just apartments. This difference is quite stunning, and it can be explained by the fact that e.g. Metro Vancouver&rsquo;s
housing units are to 41% apartments, vs 20% for Metro Calgary. And that various reports showed that the
rate of unoccupied units is much higher in condos, so we can&rsquo;t substitute comparisons for unoccupied apartments for comparisons
of unoccupied dwellings overall.</p>

<p>So what do the numbers look like when comparing the City of Vancouver to other cities in the region and across Canada.
In short, I do not know. Without going into too much details, the number of unoccupied dwelling units is derived by taking the number of
units that are &ldquo;not occupied by usual residents&rdquo;, which is part of the standard release of the census data, and subtracting
the &ldquo;unusual residents&rdquo;, that is foreign or temporary residents. So residents that have a permanent address abroad or
elsewhere in Canada and on Census day occupied in a dwelling unit that is not their primary residents. Think students
in a dorm room. Or someone in his vacation home. Or someone that works far from home and has a second unit close to work.</p>

<p>And to get the number of foreign or temporary residents requires a custom tabulation, which costs some time and money. But
overall not that much compared to the scope of the study the city just undertook, so it is not clear why they did not do this
and settle this question properly.</p>

<h3>Why do I see so many different unoccupancy rates?</h3>

<p>Again, that depends exactly on the question asked. The report offers a variety of different rates, using the definition
of unoccupied for 2 months, 6 months or 12 months. Each one gives a different rate. Then there is also the definitions
used by Stats Canada, the building being unoccupied on census day (and the questionnaire was not returned).
Again resulting in a differnt number. Then we can throw in the &ldquo;unusual residents&rdquo;, getting yet another number. Confused?
You should be! Difficult questions often don&rsquo;t have an easy answer.</p>

<p>The most important thing is to be consistent when comparing these numbers. Has the problem gotten worse? Use numbers that
were derived using the same methodology at different times. Is is worse here than elsewhere? Use numbers derived using
the same methodology across geographies.</p>

<h3>Geographic distribution</h3>

<p><a href="https://censusmapper.ca/maps/104" target="_blank"><img  src="http://doodles.mountainmath.ca/images/unoccupied.png" style="width:50%;float:left;margin-right:10px;"></a>
In absence of the data on the foreign and temporary residents, we can take a closer look at the publicly released census
data on &ldquo;dwellings not occupied by usual residents&rdquo;. The percentage of dwellings occupied by foreign or temporary residents
are quite low, in the 0.4% to 0.2% range for these metro areas we looked at above. They tend to cluster around universities,
but may also accumulate in some other areas. Keeping that in mind we can <a href="http://censusmapper.ca/maps/104">head over to CensusMapper</a>
and zoom, pan around and use the search bar to explore the geographic distribution. The city data has shown that there
was not much change in the number of unoccupied dwellings over time, no matter how the data was sliced. That gives us
some confidence that the geographic distribution has also been somewhat stable over that time frame.</p>

<p>At CensusMapper we are working on adding previous censuses, so this will be a good test case to see how the 2006 and 2001
geographic distribution of unoccupied dwellings stacks up. For City of Vancouver the corresponding numbers are 7.5% and
5.1%, respectively. The 2006 number is nicely in line with Vancouver&rsquo;s 2011 rate of 7.7%. <strike>It is not immediately clear how the significantly
lower 2001 rate squares with the city report showing a flat trendline, but could well be due to shifting definitions from
one census to another.</strike> The 2001 Census used slightly different definitions, it requires more
work to compare these numbers. The devil is in the details.</p>

<h3>Next Steps</h3>

<p>The city study settles an important questions. The rates of unoccupied homes have not gone up. Perceptions often don&rsquo;t
match facts. And there are lots of little things to poke at of course. What about people having a cleaning person stop
by every other week? How about homes awaiting renovation or demolition permits? How about AirBnB?</p>

<p>Now all these are valid questions. But before using this to discount the study do some estimates to see how large of an effect
your porposed hole actually has. How does it compare to the number of units that were found unoccupied and how would it
change that rate? In all these cases it is quite small. Then ask yourself how likely it is that the problem would be growing.</p>

<p>Then you find that AirBnB probably needs more scrutiny. Best current estimates that I have seen
<a href="https://twitter.com/karensawa/status/707288630444699650">peg entire units rented fulltime at AirBnB at 1200 in Vancouver</a>.
Counting those would bring the rates of units taken out of the rental market by being unoccupied for a year or rented out
full time via AirBnB from 4.8% to 5.3%. Noticeable, but doesn&rsquo;t make that much of a difference. Yet. That number is
very likely to grow if left unchecked and should probably be taken seriously and regulated properly right now.</p>

<h3>Update</h3>

<p>A <a href="http://vancouver.ca/files/cov/stability-in-vancouver-housing-unit-occupancy-empty-homes-report.pdf">more detailed report</a>
is now available to give more insight into the methodology. Nothing unexpected there, although the claim that the 12.5%
rate of unoccupied condos is consistent with earlier claims of 5.5% to 8.5% is hard to follow.</p>

<p>Still waiting for the technical report to get an idea of the error estimates (by housing type). Seeing the graphs for
the 2-month and 4-month cutoffs by housing type would be nice too, as well as the respective ones using the 15 day
criterion.</p>

<div><script src="http://doodles.mountainmath.ca/javascripts/unoccupied-graph.js"></script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Physical SFH Form Over Time]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/"/>
    <updated>2016-03-05T22:58:06-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time</id>
    <content type="html"><![CDATA[<p>I was curious how the physical parameters of Single Family Houses changed over time.</p>

<p>Using the <a href="https://mountainmath.ca/map/assessment">assessment dataset</a> merged with the <a href="https://mountainmath.ca/land_use/map">land use dataset</a>
allows to fairly accurately pick out single family houses, and also holds the age of most properies. Together with
the City of Vancouver LIDAR-generated building dataset <a href="https://mountainmath.ca/vancouver_lidar/map">that I have played with before</a>
we can look at physical building parameters.</p>

<!-- more -->


<p>The city dataset is a little coarse, it only contains the main building and does not map things like garages. It&rsquo;s a little
rough and should probably be interpreted cautiously on an individual building level. One could spend the time and derive the
building data directly from the raw LIDAR dataset optimized for this purpose, but for some overview statistics the building
dataset that was derived by the city is just fine. The LIDAR was taken in 2009, so we only consider houses built before that time.</p>

<h3>Site coverage</h3>

<p>One question is how the site coverage of the buildings have changed over time. We simply line up the buildings by the year
they were built, compute the site coverage of the main building relative to the parcel size and graph the quintiles for
each year. For good measure, we throw in the 10 and 90 percentile whiskers.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_coverage" style="height:200px;max-width:640px;" data-url="/data/sfh_coverage.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>What jumps out immediately is that around 1988 there apparently was a change in zoning law that reduced site coverage
of the main building. <strike>I don&rsquo;t know anything about the history of building codes, maybe someone that does could shed some
light onto this.</strike> <a href="https://twitter.com/BrendanDawe/status/706737206484795392">Twitter was fast to provide the answer</a>
it appears that changes in building code were implemented to counteract the growing footprint of houses at the time, details
can be found in <a href="https://open.library.ubc.ca/cIRcle/collections/ubctheses/831/items/1.0086386">Barbara Pettit&rsquo;s Ph.D. thesis</a>.</p>

<h3>Building Height</h3>

<p>The next obvious point of analysis is how building height, in meters, changed over time.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_height" style="height:200px;max-width:640px;" data-url="/data/sfh_height.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>We observe a similar jump in the data around 1988, with building height jumping up as site coverage decreases.</p>

<h3>Building Volumes</h3>

<p>Now let&rsquo;s look at how &ldquo;massive&rdquo; the buildings are, measured by volume in cubic metres.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_volume" style="height:200px;max-width:640px;" data-url="/data/sfh_volume.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>The graph does show that in general houses have gotten more massive starting in the late 80s, but after that have more or less
maintained the same volume. It shows that the combined effect of the regulation change in the late 80s that resulted in
smaller building footprints and taller buildings was that buildings overall got bulkier.</p>

<h3>Roof Type</h3>

<p>Lastly we see how the roof type changes over time, plotting the number of buildings with given roof type for each year.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_roof" style="height:200px;max-width:640px;" data-url="/data/sfh_roof.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>Flat roofs seem to have been quite popular between the mid 60s to mid 80s.</p>

<h3>Length to Width Ratio (Update)</h3>

<p>A question about a regulation change in 1938 <a href="https://twitter.com/GRIDSVancouver/status/706879555550613504">came up on Twitter</a>,
so I thought I should check into the length-to-width ratio to see if anything can be seen there. A ratio of 1
would mean a square footprint, a ratio of 2 means the house is twice as long as wide.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;" class="whiskers">
<div id="sfh_square" style="height:200px;max-width:640px;" data-url="/data/sfh_square.json"></div>
<div class="legend no-margin" style="padding-bottom:2em;">
</div>
</div>


<p>No obvious changes around 1938, but our houses became a lot more square after the late 80s zoning changes.</p>

<h3>Next Steps</h3>

<p>After starting to see what kind of data can be derived from LIDAR data we can start to explore different questions. The
graphs open a small window into the physical parameters of single family homes over time and are only of limited general
interest.</p>

<p>For
more serious analysis we would most likely have to start from the raw LIDAR data, which takes a little bit of effort.</p>

<div><script src="http://doodles.mountainmath.ca/javascripts/box.js"></script></div>




<script>

function stacked_bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d")
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;
var legend=d3.select(div.node().parentNode).select('.legend');


d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  var color = d3.scale.ordinal().domain(graphData.colors.map(function(d,i){return i}))
  .range(graphData.colors);
  var domain=data.map(function(d){return d.date;});
  x.domain(domain);

  function graphValueId(i){
      return graphData.class + '_' + i + '_value'
  }

  graphData.labels.forEach(function(text,i){
    var color=graphData.colors[i];
    var html='<i style="background:' + color + '"></i> ' + text + ' <span style="float:right;margin-right:10px;" id="' + graphValueId(i) + '"></span>'
    legend.append('p').html(html);
  });
  
  data.forEach(function(d) {
      var y0 = 0;
      d.values = color.domain().map(function(i) { return {date: d.date, y0: y0, y1: y0 += +d.count[i]}; });
      d.total = d.values[d.values.length - 1].y1;
  });
  y.domain([0, d3.max(data, function(d) { return d.total; })]);

  var domainTickValues=[];
  var skip=Math.round(40/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

    function updateTooltip(d,i){
       color.domain().forEach(function(j){
             var value=d && i==j ? (domainLabelFormatter(d.date) + ': ' +rangeFormatter(d.y1-d.y0)) : '';
             d3.select('#'+graphValueId(j)).text( value);
       });
    }

  var year=svg.selectAll(".year")
    .data(data)
        .enter().append("g")
          .attr("class", "g");
  year.selectAll(".color-bar")
      .data(function(d) { return d.values; })
    .enter().append("rect")
      .attr("class", graphData.class + " color-bar")
      .attr("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.y1); })
      .attr("height", function(d) { return Math.max(0, y(d.y0) - y(d.y1)); })
      .attr("fill",function(d,i) {return color(i);})
      .on('mouseover',updateTooltip)
      .on('click',updateTooltip)
      .on('touch',updateTooltip) 
      .on('mouseout',function(){updateTooltip(null,i)});

      
});

}

var yearFormatter=d3.format();
stacked_bar_graph(d3.select("#sfh_roof"),true,yearFormatter,null,yearFormatter);
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Property Taxes and Land Use]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/02/property-taxes-and-land-use/"/>
    <updated>2016-03-02T20:42:02-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/02/property-taxes-and-land-use</id>
    <content type="html"><![CDATA[<p>Since I started thinking about <a href="http://doodles.mountainmath.ca/blog/2015/05/31/density-in-vancouver/">tax density</a>,
the amount of property taxes collected per area, I always felt that the data presentation in the map fell short.</p>

<p>Property taxes are somewhat insulated from the ups and downs of the real estate market as they are need-based and the mill
rate changes to flatten out the crazyness of the market. But what they lack in interesting patterns over time they more than
makes up for in interesting patterns in space.</p>

<p>To recognize these spacial patterns, one needs to switch layers in my
<a href="https://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2741&amp;lng=-123.1321&amp;layer=10">assessment maps</a> and that&rsquo;s
a little awkward and most people won&rsquo;t do this.</p>

<p>I can&rsquo;t remember where I first saw some 3D data visualization around something like this, maybe in
<a href="http://www.strongtowns.org/journal/2015/11/18/mapping-the-effects-of-parking-minimums">this excellent Strong Towns post</a> that
explores tax density and parking.
When I was chatting with <a href="https://twitter.com/dnproulx">Darren Proulx</a> about this I realized this is the perfect case
to rev up <a href="https://mapzen.com">Mapzen&rsquo;s awesone 3D map engine</a> for data visualization. Previously I had tried out the 3D
mapping capabilities to map
<a href="https://mountainmath.ca/vancouver_lidar/map">the physical form of Vancouver&rsquo;s buildings obtained from LIDAR data</a>,
now it was time to map abstract data in 3D.</p>

<!-- more -->


<h3>3D Tax Density Maps</h3>

<p><a href="https://mountainmath.ca/assessment_gl/map?zoom=14&lat=49.2814&lng=-123.1312" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tax_density.png" style="width:50%;float:left;margin-right:10px;"></a>
The spacial patterns of tax density are closely related to zoning, so the obvious thing to do is to map both at the same
time. Tax density as the height and the zoning as the colour. But the relation between tax density and zoning is indirect,
it is given through land use. So when I
<a href="http://doodles.mountainmath.ca/blog/2016/01/31/land-use/">folded the Metro Vancouver land use dataset into the asessment data</a>
I added another option to colour the map by land use. And the visualization works pretty well to show the relationship
between the variables.
Check out the <a class='btn' href="https://mountainmath.ca/assessment_gl/map?zoom=14&lat=49.2814&lng=-123.1312" target="_blank">interactive map</a>.</p>

<h3>Some Quick Observations</h3>

<p>When comparing this to the <a href="http://www.strongtowns.org/journal/2015/11/18/mapping-the-effects-of-parking-minimums">Strong Towns post</a>
mentioned above it is interesting to note that the &ldquo;tax contribution of bare pavement&rdquo; is actually quite high relative to
many other commercial properties. For example, the giant parking lot around Safeway on 10th near UBC can&rsquo;t be discerned
from the map. Similarly, Oakridge Mall does not stand out as a low tax area. That&rsquo;s basically because in today&rsquo;s property
market the value of the property is dictated by the land value and few properties, even few commercial properties outside
of downtown, have building values in the same order of magnitude as the land value.</p>

<p>And that keeps the pressure on to redevelop the low building value commercial stock, typically replacing it with mixed use.
One example is the Safeway on Granville and 70th, that went from parking lot to mixed use. The high land values make this
kind of redevelopment attractive. Typically this redevelopment process will raise commercial rents, lower commercial
property taxes, add housing supply and increase tax density.</p>

<p><a href="https://mountainmath.ca/assessment_gl/map?zoom=16&lat=49.2433&lng=-123.151" target="_blank"><img  src="http://doodles.mountainmath.ca/images/triangle.png" style="width:50%;float:right;margin-left:10px;"></a>
Another interesting area is the
<a href="https://mountainmath.ca/assessment_gl/map?zoom=16&lat=49.2433&lng=-123.151" target="_blank">condo/apartment triangle at Arbutus and 33rd</a>.
These condos/apartments abut Quilchena Park, have a grocery store in proximity but otherwise sit in a see of single family housing.
I would like to highlight two alternative development models. One is the single family housing that surrounds this area,
the other is one where one takes the condo/apartment complex and throws in the adjacent Quilchena Park. The park does not
house any people and does not generate tax revenue but provides great recreational value. Overall, the tax density, that is the
amount of taxes collected per area, of those two models are the same. So the condo complex together with the entire park
collects the same amount of taxes per area as single family housing. On the other hand, the condo complex plus park houses
3 to 4 times as many people per (combined) area as the surrounding single family housing.</p>

<p>Presenting these as alternative
development models one can ask how many people would prefer condo (and one dedicated rental building) plus park over
single family housing without park.
Condo values range between $448k to $2.6m with median of $745k. 56% of all units have 2 bedrooms, 9% with 3 bedrooms.
The surrounding single family housing start at
around $2.5m for a teardown. My guess is that there are more people interested in the condo plus park model than the
current Vancouver market offers.</p>

<h3>More Detailed Analysis</h3>

<p>Now let&rsquo;s take the tax density information and measure it against city services rendered. In other words, let&rsquo;s see who
pays their &ldquo;fair share&rdquo; of property taxes. Well, that&rsquo;s where I ran out of juice. There is lots of
work involved to do it right, too much to fit into my evening side project time budget.</p>

<p>Some have done some
<a href="http://mapstoryblog.thenittygritty.org/costofstreets/">really amazing work</a> trying to understand the give and take of
property taxes and services rendered, to the bar is pretty high.</p>

<p>Vancouver&rsquo;s situation, with the commercial property tax 5x the residential rate, has it&rsquo;s own quirks to add to the
complexity.</p>

<p>If someone is interested in spending the time to sieve through the city budget and process the data I would be happy to help out
with graphing and mapping. As long as the data is clean enough that it stays under my &ldquo;one evening side project time budget&rdquo;. :-)</p>

<h3>Looking Forward</h3>

<p>General public awareness about taxes, zoning and fairness seem to be rising. Recently a
<a href="http://www.capitalnewyork.com/article/city-hall/2014/02/8540903/lawsuit-claims-discrimination-real-estate-taxes">class action alleging discrimination in New York&rsquo;s property tax code</a>
was launched. An interesting precedent, and it will be interesting to watch the outcome.
And to see how this could apply to the tax and services balance
of low density vs high density. Or exclusionary zoning policies as the motor of unequal tax density.
Or minimum parking requirements which <a href="https://www.washingtonpost.com/news/in-theory/wp/2016/03/03/how-parking-requirements-hurt-the-poor/">disproportionally hurt poor people</a>.</p>

<p>As this kind of data becomes more publicly accessible and better visualizations make this complex issue more
accessible I expect these kind of questions to gain more traction.</p>

<hr>


<h5>I can&rsquo;t view the 3D map!</h5>

<p>Sorry. Welcome to the world of modern web technology. (WebGL in this case.) If you try to look at the interactive map and don&rsquo;t see anything like the image above, then that&rsquo;s probably because
you either have and old (windows?) computer and/or an old (Internet Explorer) browser. If switching to Chrome or Firefox does
not fix this for you your best option is to cramp that map into your phone screen. Your phone is probably newer and supports
modern web technology much better than your computer. Or you can always view the 2D maps linked above.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Land Use, Roads (and Parking)]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/02/29/land-use/"/>
    <updated>2016-02-29T21:10:05-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/02/29/land-use</id>
    <content type="html"><![CDATA[<p>The other day at the <a href="https://www.sfu.ca/publicsquare/upcoming-events/city-conversations/2016/Feb-18-2016.html">SFU&rsquo;s City Conversations</a>
someone asked a question about space dedicated to roads, and how that could be unlocked
to aid housing. He mentioned what percentage of space is currently dedicated to roads. I forgot the number,
but I thought to myself that I should look that up for all Metro Vancouver communities. So here we go.</p>

<!-- more -->


<p>Actually, it would be interesting to compare how land is allocated to all kinds of land uses across Metro Vancouver, not just roads.
And with their excellent
<a href="http://doodles.mountainmath.ca/blog/2016/01/31/land-use/">land use dataset</a> it&rsquo;s easy enough to do, justifying spending
two hours on this. <a href="https://mountainmath.ca/land_use/map">Looking at the land use map</a>
one can see that there are some issues with using the dataset for
that purpose, for example the roads within
Stanly Park are missing, as parking lots in Vancouver parks. So this slightly overestimates the green space. But when
added up this won&rsquo;t do much to change the overall area of each land use.</p>

<h3>Land Use Breakdown</h3>

<p>Let&rsquo;s start with a simple chart summing up the land use in each of Metro Vancouver&rsquo;s Municipalities. Just select the one
you are interested in from the dropdown.</p>

<div id="land_use_breakdown" class="land_use"></div>


<p>City of Vancouver stands out as the municipality with the largest proportion of area dedicated to roads right of way.
The right of way includes nature strips, sidewalks, and of course on-street parking.</p>

<h3>Built Area Land Use</h3>

<p>For some of the municipalities large &ldquo;Natural Areas&rdquo; and &ldquo;Undeveloped Area&rdquo; make it difficult to discern the makeup of
the built up areas. So here comes the same graph with some of the large space-cosuming categories taken out.</p>

<div id="land_use_breakdown2" class="land_use"></div>


<p>What&rsquo;s remarkable is that City of Vancouver still is the clear winner in terms of space taken up by roads right of way.</p>

<h3>Roads right of way</h3>

<p>It might be interesting to compute more precisely how the roads right of way is used. But that requires a lot more work.
The City of Vancouver has a dataset with road widths, which would help separate area taken by roads from area taken by
sidewalks and nature strips. One could use google maps to estimate to estimate the amount of space taking up by on-street
parking by sampling a couple of roads and scaling this according to road area. Too much work for me right now, maybe one day I will
have a good enough reason to dedicate some time to this.</p>

<h3>Parking</h3>

<p>Parking in particular is a land use that is artificially inflated. We pay lots of money to buy private property to live
on, and then continue to pay property taxes for that privilege. But we pay nothing to store our vehicles on public roads.</p>

<p>At current land values in Vancouver it just does not make any sense to socialize the cost of parking. A 12m&sup2; on-street
parking space at a low-balled $3000/m&sup2; value is worth $36,000. If we were to price parking at value, rather than
socializing the cost we could have a discussion about using that space more effectively. Killing the parking subsidy
would have a substantial impact on demand (and car ownership), freeing up space to be re-allocated for other uses. For
example for housing by increasing lot sizes and making multi-unit structures more feasible, especally on corner lots.</p>

<hr>


<h3>Update</h3>

<p>Saw a <a href="https://twitter.com/d3visualization/status/705421356222029824">great little data visualization fly by today</a> that
is just the missing link in the above visualizations. A simple way to visualize where all the municipalities stand in
relation to one another. Thought I would throw that in real quick.</p>

<div>
 <div id="radviz" class="radviz"></div>
<div class="radviz-list-container">
        <div class="muni"></div>
        <div class="list"></div>
</div>
<div style="clear:both;"></div>
</div>




<div><script src="http://doodles.mountainmath.ca/javascripts/land_use_breakdown.js"></div>

]]></content>
  </entry>
  
</feed>
