<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: mapping | Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/blog/categories/mapping/feed.atom" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2016-05-25T14:17:13-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[My Global Bike Map]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/16/my-global-bike-map/"/>
    <updated>2016-05-16T21:39:07-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/16/my-global-bike-map</id>
    <content type="html"><![CDATA[<p><a href="http://doodles.mountainmath.ca/bike_global.html#14/49.2775/-123.1292" target="_blank"><img  src="http://doodles.mountainmath.ca/images/vancouver_bike.png"  style="width:50%;float:right;margin-left:10px;"></a>
Last week Mapzen <a href="https://twitter.com/mapzen/status/730782107685912576">announced</a> that they included bike data in their OSM vector tiles. That&rsquo;s just what the doctor ordered
to continue on my path towards the perfect bike map that I <a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">started on</a>,
<a href="http://doodles.mountainmath.ca/blog/2015/12/14/routing/">explored routing</a> and <a href="http://doodles.mountainmath.ca/blog/2015/12/15/bike-data/">looked at improving OSM bike data</a>.
Now that I don&rsquo;t need to extract bike data myself any more it is time to take these maps global. And maybe add some minor
improvements.</p>

<!-- more -->


<p>To make the bike map boils down to deciding what OSM roads, paths, etc to map and how to map them. And what contextual
information to display. The only choices we have to make is how to organize the bike related data that exists in open street maps. Let&rsquo;s be a little
radical! Our emphasis will be on safety and cycling comfort for the casual rider.</p>

<p>We will emphasise separated cycletracks by making them brightest and thickest. Shared pedestrian/bike infrastructure will
get a separate colour and be a little bit thinner. Next we layer on designated bike infrastructure by prioritizing lanes
on residential roads, then &ldquo;shared&rdquo; residential roads, then residential roads, then lanes and &ldquo;shared&rdquo; designations on
increasingly busy roads. Lastly we add residential and larger roads. And we only label roads that we are actually interested in.</p>

<p>We allow some customization by emphasizing or de-emphasizing certain types of infrastructure. By default, roads without
special bike designation are de-emphasized.</p>

<p>For good measure we added basic land use categories to highlight possible destinations, and we add building footprints
for reference as available.</p>

<p>This scheme is geared toward the safety conscious and motor-traffic-adverse cyclist in North America. In Europe other
designations exist that might call for a different priority. MAMILs might want a different colour scheme altogether.</p>

<iframe src="http://doodles.mountainmath.ca/bike_global.html#14/49.2775/-123.1292" width="80%" height="450" style="margin: 5px 10%;"></iframe>


<p>To get a better view you can also
<a href="http://doodles.mountainmath.ca/bike_global.html" target="_blank" class='btn btn-default'>take the map full-screen</a>.</p>

<h3>Data Quality</h3>

<p>The data for the map comes right out of Open Streets Map. That means that if something is missing or not right you can
just go and fix it! To make things a little easier when you are on a desktop computer, just &ldquo;shift-click&rdquo; where the problem
is and it will bring the open street map editor up for that position. You might have to log in first or create a free
account before you can help improve the bike map.</p>

<p>There is a bit of a lag between changes being made in open street map and them filtering down to the mapzen tiles so that
they will show up on the map on the map, so don&rsquo;t fret if things aren&rsquo;t up to date immediately.</p>

<h3>Global</h3>

<p><a href="http://doodles.mountainmath.ca/bike_global.html#13/52.3617/4.9051" target="_blank"><img  src="http://doodles.mountainmath.ca/images/amsterdam_bike.png"  style="width:50%;float:left;margin-right:10px;"></a>
And this bike map is global. The quality of the map depends on the quality of OSM data, in the case of Amsterdam it makes
it abundantly clear why casual cyclists keep dreaming about the infrastructure in this city.</p>

<p>The choice of emphasis for the
maps are based on North America, or more narrowly Vancouver, where I live. So this might need adjusting for local context
to better fit local OSM conventions. Use the search bar and explore your region.</p>

<h3>The Real Deal</h3>

<p><a href="https://ride.report" target="_blank"><img  src="http://doodles.mountainmath.ca/images/ride_report.png"  style="width:50%;float:right;margin-left:10px;"></a>
Sadly, all of this effort is really coming at things from the wrong angle. The best way to do this,
<a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">as we outlined earlier</a>, is to base a bike map
on how cyclists actually use the roads and pathways, instead of how they got classified in Open Street Map or what
municipalities think they should be classified. The problem is that we don&rsquo;t have that data. At least not yet. But
there are really cool efforts out there to get that data and make it available.</p>

<p>I really like the approach that <a href="https://ride.report" target="_blank">Ride Report</a> has taken. Strava works
reasonably well for recreational cyclists, but it does a terrible job at capturing where transportation cyclists go and
makes no effort in understanding their comfort level. Ride Report takes a different approach by automagically figuring
out what you are doing and recording your cycling trips. All without you ever having to press a &ldquo;start&rdquo; or &ldquo;stop&rdquo; button,
which is key if you want to understand where transportation cyclists go. On top of that it prompts you to simply rate your
bike trip once you are done, and you can do this easily from your lock screen. Then Ride Report aggregates the data
to produce stress maps, and possibly other important data that can guide infrastructure improvements.</p>

<p>In this day and age of data driven decision making I would really like more municipalities to support efforts like Ride Report
that generate real meaningful data on transportation cycling. And as a by-product one could take cycling maps to the
next level and add actual cycling usage and comfort.</p>

<h3>Issues</h3>

<p>There are still some issues. Some bike infrastructure, for example OSM paths, only become visible at zoom level 13 or higher.
That&rsquo;s just the way the vector tile service works. Secondary roads are only visible at zoom level 12 or higher, and this
includes &ldquo;bike boulevards&rdquo;. Cyclepaths are only visible at zoom level 11 or higher. If one wants to have high-level bike
maps one probably needs a dedicated vector tile service for bike infrastructure.</p>

<h3>Apologies</h3>

<p>Since this is just a blog post I have not gone out of my way to make sure this map works on every computer and browser.
Basically, I am leaveraging off of <a href="https://mapzen.com">Mapzen&rsquo;s</a> awesome <a href="https://mapzen.com/projects/tangram/">Tangram</a>
mapping engine to keep things simple on my end, but that means the maps will only show on modern computers
(and modern browsers, so no IE). If your computer is having trouble displaying the map just pull out your phone, chances
are it it is much better equipped to handle modern web technology.</p>

<p>Also, I made a bunch of choices how to display bike infrastructure. These are just a function of my personal preferences
and what OSM data has to offer. If you notice issues with the OSM data, you can fix it in OSM and it will show on the map
once the changes have filtered through to Mapzen&rsquo;s tile service. If you don&rsquo;t like my personal prefernces, just grab the
html for the map and the scene file and change it at your heart&rsquo;s content. You don&rsquo;t need any special server to host these
files, I dumped them on my static blog. Even a public dropbox folder can host these maps.</p>

<p>So grab the code and customize it at your heart&rsquo;s content. Take full control on how to display bike infrastructure and
roads, and what amenities to show and how to style them.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Canvas vs SVG]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2015/12/27/canvas-vs-svg/"/>
    <updated>2015-12-27T15:53:02-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2015/12/27/canvas-vs-svg</id>
    <content type="html"><![CDATA[<h4>CensusMapper Behind the Scenes</h4>

<p>The idea behind <a href="https://censusmapper.ca">CensusMapper</a> is that it takes away all the technical barriers to dealing with census data. So how does
CensusMapper work behind the scenes?</p>

<h4>CensusMapper Data Workflow</h4>

<!-- more -->


<p>The general setup is quite simple. We use the lean javascript open mapping platform <a href="http://leafletjs.com">leaflet</a>
as the base for mapping information. Leaflet handles the logic of dealing with zoom and pan and keeping track of the
geographic boundaries that should be mapped. That information gets then passed on to the CensusMapper servers.</p>

<p>CensusMapper will then send the appropriate census geographic polygons to the browser for leaflet to display. Once the
geographic data is available for mapping, some custom code checks what kind of information the user wants to display and
requests the census data required to make the map. The census information is then assembled on the server, sent down
and attached to the polygons and drawn
on the browser window within leaflet. This two-tier process allows the highly dynamic mapping in CensusMapper where the
data-heavy geographic polygons are kept separately thus can be cached and re-used.</p>

<h4>Drawing Census Data</h4>

<p>There are a number of ways how we can display census data in the browser. At CensusMapper we have played with three
different technologies to map data that vary in performance and browser support. They all have in common that they
won&rsquo;t run on Internet Explorer 8 or earlier, but we have just about reached the point in time where it is acceptable to
ignore IE8- in products meant for the &ldquo;general internet audience&rdquo;.</p>

<h5>SVG</h5>

<p><a href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics">SVG</a> is what our maps have been using so far. SVGs are fairly high level, which means it&rsquo;s very little work
to implement and map information. One simply passes a polygon to the browser, tells it how to color it, and the browser
takes care of the rest. SVG elements can easily be styled via CSS, so there is essentially no work involved to deal with
highlight on hover, scaling for retina displays, patterns for census data quality flags, etc. We use
<a href="https://github.com/mbostock/d3">d3.js</a> to attach the geographic and census data right to the SVG elements for easy
manipulation.</p>

<p>While mapping data this way is very easy, for CensusMapper there are two problems.</p>

<ol>
<li>We are restricted in how we can display information by the capabilities of SVG.</li>
<li>SVG rendering is done by the browser, and not all browsers are equal. Most importantly, SVG rendering in Internet
Explorer is excruciatingly slow. So slow, that CensusMapper becomes essentially useless within Internet Explorer. We
felt compelled to add a warning messeage that displayed when people opened CensusMapper with Internet Explorer. And
when you do that, that&rsquo;s a sure sign that your app has a serious problem.
<img src="/images/chrome.png" alt="Browser Warning" />
So how to get around those issues? Enter Canvas.</li>
</ol>


<h5>Canvas</h5>

<p><a href="https://en.wikipedia.org/wiki/Canvas_element">Canvas</a> offers a way to draw images in a browser. Unlike SVG, the drawing has to be done &ldquo;by hand&rdquo;. And the result is just
an image, with no clear way to tell where it came from. There is no way to attach any information to individual
structures drawn on a canvas. All the logic for highlight on hover, figuring out what data is associated with the mouse
position, dealing with retina displays, etc. needs to be added by hand.</p>

<p>On the upside, a good canvas implementation is a lot faster than SVG. And it opens the door to changes in how the data
is handled that bring additional performance improvements. In particular, we can now chop up census polygons and render
the pieces separately, greatly cutting down on the size of the downloaded data, as well as the complexity of the
polygons that get rendered. And the performance improvements are noticeable across all browsers and platforms.</p>

<p>At the end of the day it is actually not that much work and we flipped the switch on this just before the Christmas
break. CensusMapper is now running using canvas instead SVG for
the main maps. We
kept the look and feel the same, so unless you dig into the code you won&rsquo;t notice the difference.
Some parts of CensusMapper still utilized SVGs, like the d3-based
<a href="http://doodles.mountainmath.ca/blog/2015/10/24/census-drilldown/">Census Wheel</a>.</p>

<h5>WebGL</h5>

<p><a href="https://en.wikipedia.org/wiki/WebGL">WebGL</a> also draws on a canvas element, but the work is offloaded onto the GPU (graphics processor) giving enormous
speed improvements. Regular canvas rendering is fast enough for our purposes, but with WebGL we can do more complex
renderings that previously we could not even dream of: <a href="https://en.wikipedia.org/wiki/OpenGL_Shading_Language">Shaders</a>
and Interactive 3D data maps. We had previously
<a href="https://mountainmath.ca/census3">toyed with 3D data visualization</a> to explore Vancouver&rsquo;s household density in 3D using Three.js,
but did not pursue this further because of the complexities of writing code for navigating a Canada-wide map. Then we came
across the super-customizable 3D open mapping platform built by <a href="https://mapzen.com/projects/tangram/">Mapzen</a>, and that
suddenly made it extremely easy to do interactive 3D data mapping live in the browser. A quick test
<a href="https://mountainmath.ca/vancouver_lidar/map">using Vancouver&rsquo;s open LIDAR generated building height data</a> showed how easy Mapzen&rsquo;s
tangram engine is to use.</p>

<p>After digging deeper into tangram, and with help from the friendly people at Mapzen, we figured out a way to fit
CensusMapper&rsquo;s two-stage data workflow into tangram&rsquo;s mapping engine. The result are real-time 3D maps where height
and color of each geographic area can be independently (and dynamically) controlled. Here is an example where mouseover
trigged the area west of Coal Harbor to &lsquo;pop up&rsquo;.
<img src="/images/webGL.jpg" alt="webGL" /></p>

<p>At the same time we gain the ability to easily pull in all kinds of other data and map it. On our canvas or svg maps we
added regular image tiles, either a road and label&rsquo;s overlay or a base map (which then requires opacity to be added to
the census data that is mapped on top of that) as orientation aid. Short of baking our own image tiles we have very
little control over the look and feel of this. With Mapzen&rsquo;s tangram we can very easily pick and style individual
geographic objects from Mapzen&rsquo;s OSM vector tile server, resulting in crisp and clear maps. In the above example we
decide dynamically what level of roads to render, how to style them, what labels to display and we also added bodies of
water, where we filter by size depending on the zoom level.</p>

<p>At this stage it is still an ongoing project to get this production-ready. One obvious obstacle is that WebGL browser
support is still lagging. And on top of that it also requires updated graphics card drivers, which is a big problem on
windows machines that are already a couple of years old. So for now we still need to have a plain canvas or svg fallback.</p>

<p>And then there are the details that need to get worked out. 3D maps sounds great, but it will take us some time to figure
out how to best utilize this in thematic maps. But even without utilizing 3D capabilities, the dynamic shaders and increased
rendering performance are already pushing the boundary of what&rsquo;s possible in web maps.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bike Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2015/12/15/bike-data/"/>
    <updated>2015-12-15T15:16:48-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2015/12/15/bike-data</id>
    <content type="html"><![CDATA[<p><a href="/bike_map2.html"><img  src="http://doodles.mountainmath.ca/images/bike-routes2.png" style="width:25%;float:right"></a>Maps live and die with the quality
of the underlying data. So I decided to dive a little deeper down the OSM bike data rabbit hole. Task number one was
to expand display data for a wider region. My primitive workflow to pull data out of OSM only allows for extracting a quarter
of a degree at a time. For playing around with all of Vancouver&rsquo;s data I again turned to Mapzen for their
<a href="https://mapzen.com/data/metro-extracts">metro extracts</a> as a convenient shortcut for OSM data. For the case of Vancouver
the word &ldquo;metro&rdquo; is a bit of an exaggeration, it just covers the City of Vancouver. But good enough for some more testing.</p>

<h4>More data</h4>

<!-- more -->


<p>More data means a a larger variety of <a href="http://wiki.openstreetmap.org/wiki/Key:cycleway">bike infrastructure types</a>.
At first glance tagging seems to be reasonably accurate, but on closer inspection one quickly spots lots of issues.
First off, the <a href="https://twitter.com/alexwarrior/status/675820327331479552">edits Alex made earlier</a> are <strike>not
showing up, that&rsquo;s because the metro extracts are only done weekly. Just a matter of time.</strike> showing up now after
updating with new OSM data.</p>

<p>And then there are lots of little issues. Off street paths
don&rsquo;t connect to roads (or anything for that matter), making the useless for routing. Some changes in the bike network
are tagged differently, take Point Grey Road as an example. Some paths are labeled to be ok for bikes, but bikes aren&rsquo;t
allowed there. Some tags seem off.</p>

<p>And I don&rsquo;t seem to have captured all relevant bike infrastructure, will have to spend some time one of these days to check
through all the different taggings in OSM to make sure I pull out all the correct ones.</p>

<p>So to make more sense out of the network I made a new map, added some more categories for optionally fading them out when
displayed. And on hover I display the tags, just for interest.</p>

<h4>Improving data</h4>

<p>This gets us to task number two. The folks at Mapzen gave me some friendly pointers to allow easy editing of features.
So I pasted a couple of lines of code in so if you hold down the shift key and
click on a feature, it will take you automatically to OSM to edit the feature. You may have to sign in the first time
you do this. If you hold the shift key while clicking anywhere else it also takes you to the OSM editor for that spot,
in case you want to add something there. It takes a lot of the pain out of editing bike infrastructure, I just fixed a
whole bunch of things in short time.</p>

<iframe src="http://doodles.mountainmath.ca/bike_map2.html" width="100%" height="550"></iframe>


<p>Go for it and fix some problems that you see, either by shift-clicking on the embedded map or by
<a href="/bike_map2.html">taking the map full-screen first</a>. Remember that some of the issues may be fixed already, the bike map will not reflect
updates until a week later or so.</p>

<h4>Where to go from here?</h4>

<p>It looks like making a decent bike map with OSM data is feasible. The hard work will be to collaboratively do all the
OSM edits required to get the data into good shape.</p>

<p>One problem is that edits won&rsquo;t show up on the bike map for up to a week, that&rsquo;s the frequency at which the metro extracts
are updated. And then I have to update the file for displaying the bike data. A minor inconvenience, in theory there
are ways to seed this up if one wants to be serious about this. But then again, once the OSM bike data is fixed up in a
given region, it won&rsquo;t need updating very frequently.</p>

<p>I guess I will have to mull this over and decide how deep down this rabbit hole I would like to go. Looking back at my
<a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">rant on what&rsquo;s wrong with most bike maps</a> I am
asking myself how much the current map has accomplished.</p>

<ol>
<li>The accuracy of the infrastructure mapped is in the hands of the OSM community. With easy access to the OSM editing
functionality from the map (desktop only) it&rsquo;s in the hands of the people that know best: cyclists.</li>
<li>Still coming up blank when it comes to showing comfort level. Will have to think more how to best do this, it might
have to go into a separate database. Which is doable, but requires work to get it right and is probably a little too
involved to do it off the side.</li>
<li>Click and zoom is not an issue, but now I am in the opposite corner where it might be nice sometimes to actually have
a glossy big paper map. And it&rsquo;s really easy to save the map as an image. Some tinkering should be able to produce a nice
high-resolution one covering a large area.</li>
<li>The map already adapts to user preferences quite well, different types of infrastructure will fade out if deselected.</li>
<li>Not on the original list, but routing should be part of this. Routing works reasonably well to get this off the ground,
but work is still required to make it work properly with user preferences. This may well require running a custom router,
again a little more than I bargained for.</li>
</ol>


<p>So is this really worth the trouble to make yet another bike map? I am not sure. It&rsquo;s always easy to through up a quick
proof of concept, but to do it really well requires quite a bit more work. For now I could just build one focused on
Vancouver and see how it goes. And it would be great if the comfort level rating could somehow be automated.</p>

<p><img  src="http://doodles.mountainmath.ca/images/cycletrack.PNG" style="width:50%;float:right">Which brings to another one of pet projects that
I never took beyond the testing realm. My CycleTrack App that records
all bike trips in the background (as long as you carry your phone with you). No pressing of &ldquo;start&rdquo; or &ldquo;stop&rdquo; buttons,
the app notices when you are moving and will take gyroscope and accelerometer readings to figure out if you are cycling,
running, walking, driving or taking a train. Then it stores your cycling trips and computes aggregate data. It avoids
using GPS so not to drain your battery too much, on a typical day it will consume about 3% of battery power. The downside
is that the accuracy and frequency of the location updates is not as high, so things get a little messy. But not too bad.</p>

<p>How does this fit into the bike map project? Simple. If one can collect regular cycling data from normal people
cycling (not just
the lycra crowd that presses start cycles in circles and presses stop again and recharges their phone while taking a shower),
once can infer a lot about comfort levels just by looking at the data. And to collect data from regular &ldquo;citizen cyclist&rdquo;
one cannot expect them to press &ldquo;start&rdquo; and &ldquo;stop&rdquo; to delineate their bike trips, and one cannot have an app that will
require them to recharge their phone after every trip.</p>

<p>But then the project gets even bigger&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bike Routing]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2015/12/14/routing/"/>
    <updated>2015-12-14T20:10:16-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2015/12/14/routing</id>
    <content type="html"><![CDATA[<p><a href="/bike_routing.html"><img  src="http://doodles.mountainmath.ca/images/routing.png" style="width:25%;float:right"></a>Routing is a hard problem. Routing for drivers is pretty good at this point, mostly because we have been very good at
designing for cars and creating predicable infrastructure. Routing for bikes is a whole other story, data quality is
poor and the physical infrastructure is, at least in North America, not strongly predictive of cycling comfort/safety.
And cycling comfort/safety is the top priority for the
<a href="http://usa.streetsblog.org/2015/03/13/the-first-ever-nationwide-survey-of-interested-but-concerned-bikers-is-here/">vast majority of (potential) cyclists</a>.</p>

<p>And it&rsquo;s the ones that don&rsquo;t cycle frequently, often out of concern for safety, that would benefit most from effective
bike routing.</p>

<p>Read on or <a href="/bike_routing.html">go directly to the routing demo</a>.</p>

<!-- more -->


<p>Google does a decent job directing a relatively experienced cyclist from A to B, but it has a hard time to learn about
places where cyclists can go but cars can&rsquo;t. And it won&rsquo;t be able to answer my fundamental question: <em>Can I bring my 6
year old along?</em>. And Apple doesn&rsquo;t even try and offer bike routing.</p>

<h4>Routing test</h4>

<p>So what&rsquo;s really needed apart from <a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">better bike maps</a>
is better bike routing. So building on yesterday&rsquo;s post, I decided to take a quick look at routing. Time to try out
<a href="https://mapzen.com/projects/valhalla">Mapzen&rsquo;s routing engine</a> which, as expected, was really easy to set up:</p>

<p>Feel free to drag the endpoints to test your favorite routes.</p>

<iframe src="http://doodles.mountainmath.ca/bike_routing.html" width="100%" height="550"></iframe>


<p><a href="/bike_routing.html">Full screen view</a></p>

<p>Initial testing seems to indicate that this works reasonably well. And while the engine allows for some customization
on rider needs, right now there is no way to get the &ldquo;dad&rsquo;s routing&rdquo; that I would like to have.</p>

<p>Part of the problem is of course that I still don&rsquo;t have enough information in OSM to even make a &ldquo;dad&rsquo;s map&rdquo;
<a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">as I lamented earlier</a>. But at least OSM gets
me half-way there by giving me a finer control over distinguishing infrastructure that I may deem as generally more
suitable so that I can fade selected bike infrastructure out by checking the appropriate boxes in the map.</p>

<h4>Route costing options</h4>

<p>The bike routing options in Mapzen&rsquo;s routing engine allow for some level of control on wheter gravel should be avoided
(great feature for the lycra cowed but useless for dads), whether hill should be avoided (helpful) and whether to avoid
roads without bike infrastructure. But when I cycle with my 6 year old a bike lane between parked cars and 50 traffic
is as good as no bike infrastructure at all. And there is currently no way to cost different types of bike
infrastructure, so they can&rsquo;t be used as a proxy for cycling comfort.</p>

<h4>Where to go from here</h4>

<p>Next steps are to <a href="https://github.com/valhalla/thor">look deeper into Mapzen&rsquo;s routing engine</a> and see how hard it would
be to hack some of these more advanced costing options into their routing engine and open up a feature request.</p>

<p>Wrapping up the three-night trials in bike mapping is the
<a href="http://doodles.mountainmath.ca/blog/2015/12/15/bike-data/">post on data</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to make a bike map]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/"/>
    <updated>2015-12-13T12:04:25-08:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map</id>
    <content type="html"><![CDATA[<p><a href="/bike_map.html"><img  src="http://doodles.mountainmath.ca/images/bike-map.png" style="width:25%;float:right"></a>Here come some general thoughts on bike maps. Not throught through yet, just jotting down some ideas so that I don&rsquo;t
forget and maybe to start a discussion.</p>

<p>Bike enthusiasts, OSM folks and mapping technology wonks read on!</p>

<!-- more -->


<h4>Why make a new bike map?</h4>

<p>Plainly put, I don&rsquo;t like a lot of the bike maps out there. Time for my little bike map rant:</p>

<ol>
<li>Lots of maps don&rsquo;t accomplish their core mission:
accurately map bike infrastructure. For example, when in real life a bike lane vanishes 100m in front of an intersection
and reappears 100m after the intersection, leaving cyclists exposed right where protection is needed the most, most
bike maps will mark the entire section as having a bike lane.</li>
<li>Most bike maps focus on the wrong issue. They focus on physical infrastructure, as a cyclist I am interested in
cycling comfort level. Can I take my 6 year old along that route? Can I cycle leisurely or will I feel hastened by a
car breathing down my neck? Will I arrive at my destination relaxed or will I be riled up by 3 near misses and 5 drivers
swearing at me? Some of these questions can be answered by mapping infrastructure. A physically separated bike path will
give me the comfort I need to bing my 6 year old and enjoy my ride. But when it comes to &ldquo;bike lane&rdquo; or &ldquo;shared road&rdquo;
designations, I have no idea what it will feel like until I get there.</li>
<li>Most bike maps have not yet made the transition from paper/PDF based maps to clickable and zoomable maps that can be
easily consumed on the go.</li>
<li>Most maps are static, they don&rsquo;t adapt to the needs of the user. Why do I have to deal with 5 different colors and
3 types of shading when reading a bike map, when all I want to know is if I can bring my 6 year old along for the ride.
I want an &ldquo;AAA&rdquo; button that fades out all routes that are not suitable for all ages and abilities. For that purpose I
don&rsquo;t care if a road has infrastructure like a bike lane wedged between parked cars and 50km/h traffic. If we absolutely
have to ride that way it will be on the sidewalk.</li>
</ol>


<h4>How to make a new bike map?</h4>

<p>First let&rsquo;s start with examples of how other have tried to solve these problems. Probably one of the best maps out there
is the <a href="https://www.crd.bc.ca/docs/default-source/crd-document-library/maps/transportation/bikemap2014-frontback-web.pdf?sfvrsn=8">Capital Regional District Bike Map</a>.
I chatted with <a href="https://twitter.com/Burgundavia">Corey</a> who worked for CRD on these maps on how it was done. They collected all the bike infrastructure
in the region by contacting all the municipalities. <img  src="http://doodles.mountainmath.ca/images/victoria.png" style="width:50%;float:left"> Then they meticulously
checked that what the municipalities reported actually existed on the ground.  Consider Fort road on their bike map where they accurately show the bike lane
cutting out. And they added in shortcuts and connections
that the municipalities did not report on, like a short section of footway that may technically require walking the bike
but shortcuts out of a suburban cul-de-sac maze.</p>

<p>Next the CRD map does not only map infrastructure, but color-codes it to show cycling comfort. <img  src="http://doodles.mountainmath.ca/images/victoria-legend.png" style="width:50%;float:right">
This gives me a good idea how comfortable the rider will feel. Unfortunately all that complexity starts to make it difficult to
read the bike map.</p>

<p>That&rsquo;s where technology could come to the rescure. The CRD map is a PDF map and suffers the usual limitations that come
with it. The map cannot adapt to the needs of the reader. So how about moving the map online and letting the user decide
how to display it?</p>

<h4>Bike maps that adapt to the user</h4>

<p>The <a href="http://www.washingtonpost.com/blogs/wonkblog/wp/2015/04/01/bleak-maps-of-how-cities-look-using-only-their-bike-lanes/">Washington Post Wonkblog</a>
had an excellent feature mapping only the bike infrastructure, nothing else. And for good measure, they removed the
shared streets bike infrastructure. The rational was that in most cases, comfort level on shared street bike routes is really no different from
cycling on a parallel road. Inspired by that I decided <a href="/blog/2015/04/01/bike-paths/">map Vancouver and a couple of other cities</a>
and I added in some button to allow selectively turning on or off typed of infrastructure.</p>

<iframe src="http://doodles.mountainmath.ca/bike_paths.html?fh=50&nh=true" width="50%" height="300" style="float:left;"></iframe>


<p>That&rsquo;s getting one step closer to adaptable bike maps, but it is still missing the main point that as a cyclist I am
most interested in comfort level, and infrastructure type is only a proxy for that. And a poor one in many cases.</p>

<h4>Inspiration</h4>

<p>Not convinced we need a new bike map? Let&rsquo;s draw on some local (for me) maps that inspired this effort.</p>

<p>UBC Campus Planning <a href="https://twitter.com/ubc_candcp/status/662027568204357633">keeps tweeting out a bike map</a>
that lists several dangerous roads as &ldquo;designated on street cycling routes&rdquo;, including an unlit divided 4 lane highway
with a posted speed limit of 60km/h and typical traffic speeds significantly exceeding that. And all of that apparently
aimed at people that don&rsquo;t cycle to campus yet but are considering doing so.</p>

<p>TransLink just <a href="http://www.translink.ca/-/media/Documents/cycling/cycling_routes/full_maps/TransLink%20Regional%20Cycling%20Map%20West.pdf">updated their bike map</a>
and marks said highway as &ldquo;recommended by cyclists&rdquo;. The do acknowlege that the road &ldquo;does not have special treatment
for cyclists&rdquo;. So why include it on the map? Filling in the the gaps in the cycling network should happen in real life,
not just on the map.</p>

<p>Even HUB keeps <a href="https://bikehub.ca/about-us/our-positions/ungapthemap">marking Wesbrook Mall north of Agronomy as &ldquo;existing cycling route&rdquo;</a>
when in real life it is everything but that.</p>

<h4>How to make a bike map</h4>

<p>So how should we make a bike map? I was always thinking about setting up my own database and somehow adding and rating
infrastructure. Then <a href="https://twitter.com/alexwarrior">Alex</a> decided to start making a bike
map for the UBC area. And he chose the most straight-forward path: Editing Open Street Map data. That way the edits are
immediately (better: after their map tile refresh cycle) available online, for example on
<a href="http://www.opencyclemap.org/">OpenCycleMaps</a>. The map is easily accessible
on the go, it zooms and scrolls. It is missing a &lsquo;locate me&rsquo; button (which is easy to fix). The look and feel is a little
dated. But most importantly, it does not adapt to the user&rsquo;s needs. I can&rsquo;t ask it to display the &ldquo;dad&rsquo;s version&rdquo; of the
cycle network, showing me only pieces that I will be comfortable cycling with my 6 year old.</p>

<p>Technology has moved along since that map was built. A very easy way to solve these issues is to
utilized the awesome tools built by the folks at <a href="https://mapzen.com">Mapzen</a>. Their
<a href="https://mapzen.com/projects/tangram">tangram mapping engine</a> taps into their
<a href="https://mapzen.com/projects/vector-tiles">OSM vector tile service</a> to make flexible mapping of bike data a breeze. And
to top things off, they offer very easy to use and extremely powerful ways to style the map. Only problem: Mapzen&rsquo;s
OSM extracts don&rsquo;t have cycling information. Not a big problem though, we can just pull them out separately and add
them on by hand. Here is an example where only the bike routes near UBC are added.</p>

<iframe src="http://doodles.mountainmath.ca/bike_map.html" width="100%" height="550"></iframe>


<p><a href="/bike_map.html">Full screen view</a></p>

<p>One small drawback is that WebGL, the technology Tangram is based on, is not available for much of the windows world.
WebGL requires modern browsers (IE9 does not count) and also modern hardware/graphics card drivers. A couple of years
old windows machine will likely not be able to render WebGL no matter what browser you use. But the main target is
mobile, and iOS and most android won&rsquo;t have a problem with WebGL. If really needed, could add a fallback or use older
and web technology to make the map, but Mapzen&rsquo;s Tangram makes it so ridiculously easy to make and style nice maps&hellip;</p>

<h4>The main problem left to solve</h4>

<p>One major problem left. OSM does not have and &ldquo;cycling comfort&rdquo; tags right now. There are tags for physical infrastructure,
and in some cases the comfort level can be correctly inferred from those. But in many cases it can&rsquo;t.</p>

<p>There are two ways around that. One could
keep those tags in a separate file, but that becomes difficult to maintain when OSM features change. Or one can add the
tag to the OSM data. That way better bike maps can scale easily, and the information can also be used in OSM-based
routing services where their real value lies.</p>

<p>Not sure which is the way to go here, a similar tag
<a href="http://wiki.openstreetmap.org/wiki/Proposed_features/bike_safety">has been proposed before</a> but apparently did not
go anywhere. Looking at the <a href="http://wiki.openstreetmap.org/wiki/Any_tags_you_like">tag guidelines</a> the fact they these
new tags are very useful for routing seems to speak for adding them to OSM, but the fact that they are measuring
something explicitly non-geographic by going beyond the already existing physical infrastructure markers might mean
they are better kept in an external database. Will have to think this over, feedback appreciated.</p>

<h4>Where to go from here.</h4>

<p>The logical next step is to add routing. Again, Mapzen&rsquo;s <a href="https://mapzen.com/projects/valhalla/">flexible routing service</a>
seems to be a natural match. Also, adding editing capabilities right onto the map would be quite useful. The bike map is
where data issues are best seen, and saving the step to head over to OSM to fix it (after creating an account) and then
waiting for the data to update on the map seems like a workflow that will discourage wide participation.</p>

<p>We follow up by <a href="http://doodles.mountainmath.ca/blog/2015/12/14/routing/">exploring routing</a>
and <a href="http://doodles.mountainmath.ca/blog/2015/12/15/bike-data/">data quality</a>.</p>
]]></content>
  </entry>
  
</feed>
