
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>dot-density - Mountain Doodles</title>
  <meta name="author" content="MountainMath">

  
  <meta name="description" content="Dot-density maps are hard.">
  <meta name="keywords" content="censusmapper, r stats, dot-density, mapping, census, open data">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://doodles.mountainmath.ca/blog/2017/08/24/dot-density/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/feed.atom" rel="alternate" title="Mountain Doodles" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54516567-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Mountain Doodles</a></h1>
  
    <h2>spare time data, analysis, visualization</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed.atom" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="site:doodles.mountainmath.ca" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">Blog</a></li>
    <li><a href="/about/">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Dot-density</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-24T22:28:40-07:00" pubdate data-updated="true"></time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I started writing this blog post in December 2015, when CensusMapper quite a bit younger and
I hacked together some basic dot-density maps. I never much liked the results and have been
slowly improving and thinking about them. I am still not entirely happy with the current
implementation, but it is slowly getting there. The final impulse to finsish this post was
the work on <code>cancensus</code>, and R wrapper for the CensusMapper API my explorations in multi-category
dot density maps in R, now tied up into the new <code>dotdensity</code> package.</p>

<h4>One person at a time</h4>

<p><img  src="/images/recent_immigrants_cropped.png" style="width:50%;float:right;margin-left:10px;">
Dot-density maps look pretty cool.
They have been <a href="https://www.google.com/search?q=dot-density+map+images&amp;client=safari&amp;rls=en&amp;tbm=isch&amp;tbo=u&amp;source=univ&amp;sa=X&amp;ved=0ahUKEwjuy9Ch6PjJAhUivXIKHWcvDb4QsAQIHA&amp;biw=1253&amp;bih=812">flying around the itnernet</a>
lately, so we have been thinking about how to offer them in CensusMapper.</p>

<p>So what&rsquo;s so great about dot-density maps? Essentially two things:</p>

<ol>
<li>They are very simple to interpret. One dot = one person is something everyone understands immediately.</li>
<li>They can show several variables at once, for example mapping recent immigrants by region of origin like above or
<a href="http://www.nytimes.com/interactive/2015/07/08/us/census-race-map.html">mapping ethnic segregation</a>.</li>
</ol>


<p>But once one looks closer there are lots of issues that need to be dealt with.</p>

<!-- more -->


<h4>The devil is in the details</h4>

<p>As simple as the the basic dot-density promise of <em>one dot = one person</em> is, it must fundamentally remain a lie for
census maps. We simply don&rsquo;t have the level of detail that the maps suggest. We don&rsquo;t know the location of people with
the accuracy depicted in the maps, and we certainly don&rsquo;t know the categories that give the color with the accuracy
suggested in the maps.</p>

<p>That&rsquo;s the most serious drawback of dot-density maps, they often suggest a level of detail that simply isn&rsquo;t there. Does
that outweigh the advantages? For that it is useful to take a quick look at the alternative that we have been using
at CensusMapper</p>

<h4>Choropleth Maps</h4>

<p>Choropleth maps are the staple of census maps. Every census region gets colored depending on a value of a census
variable (or function derived from census variables). While this is also quite simple, in practive there are a number of
problems with that:</p>

<ol>
<li><p>Low population bias. Let&rsquo;s look at an example to see how this works. Take a
<a href="http://censusmapper.ca/maps/132?zoom=12&amp;lat=49.2462&amp;lng=-123.0761">map of the percentage of children living in poverty</a>.
We immediately see where the percentage of child poverty is high. And child poverty is a problem. But what we don&rsquo;t see
is how many poor children live in each area. So while we see the relative magnitude, we don&rsquo;t see the absolute magnitude
of the problem. So for example the <a href="http://censusmapper.ca/maps/132?zoom=17&amp;lat=49.2647&amp;lng=-123.1429">DA north-west of Broadway and Fir</a>
sports 66.7% of children living in poverty, but there are only 30 children in the area, and the expected error due to statistical
rounding is 10%, let alone errors introduced by non-return bias or simple sampling error. The
<a href="http://censusmapper.ca/maps/132?zoom=17&amp;lat=49.2435&amp;lng=-123.1516">DA north-east of Arbutus and 33rd</a> has a similar rate
of 69.1%, but there are 345 children in that area. So when trying to understand child poverty in the west side of Vancouver
one should focus on the latter not the former, but on the map they appear identical. Dot-density maps do a much better
job at representing this properly as they would simply draw a dot for each child in poverty, contrasted by a dot for
each child not in poverty as <a href="http://censusmapper.ca/maps/216?zoom=13&amp;lat=49.2465&amp;lng=-123.1425">you can see here</a>. Another
way to deal with this issue is via <a href="http://doodles.mountainmath.ca/blog/2017/04/10/surprise/">a surprise map</a> which
we have explained <a href="http://doodles.mountainmath.ca/blog/2017/04/10/surprise/">in a previous post</a>.</p></li>
<li><p>Choropleth maps are difficult to understand. If you read this far you probably have dealt with a fair share of maps
and won&rsquo;t appreciate how some people struggle understanding these. But the amount of time I have spent explaining to
journalists what they see in the <a href="http://censusmapper.ca/maps/137">halloween map of trick or treat density</a> is (torturous)
testament of the difficulties people have with these kind of maps. I don&rsquo;t think I would have gotten any questions if I
had simply use <a href="https://censusmapper.ca/maps/804">the dot-density version</a> instead. However, this only works for the
trick-or-treat density map, not the trick-or-treat onslaught map.</p></li>
<li><p>One can only show one variable at a time. There are ways to stretch this a little, for example
<a href="http://andywoodruff.com/blog/value-by-alpha-maps/">value by alpha maps</a> are one way around this that tackle the population
bias. Another way is the <a href="http://censusmapper.ca/maps/162">RGB maps CensusMapper has</a>. But this does not exactly make it
easier to interpret. Dot-density versions of this is certainly <a href="http://censusmapper.ca/maps/202">easier to interpret</a>
plus one is not limited by the three categories of the RGB maps. We can even <a href="https://censusmapper.ca/maps/678">combine the CensusMapper 3 color mixing with
value-by-alpha</a> to also show density.</p></li>
</ol>


<h4>Dot-Density Maps</h4>

<p>One other big challenge with dot-density maps is that they are surprisingly hard to make. Right now we at CensusMapper
just have the bare minimum in place to produce these kind of maps: A way to randomly place the required number of dots
into each geographic region colored by the given categories. Just when I was about to try myself at dot-density maps I
saw a <a href="https://twitter.com/pwramsey/status/677502052210085888">helpful tweet</a> telling me exactly what to pay attention
to, so the implementation was quick and painless. &ndash; Well, not quite, I still had to deal with issues due to polygons
clipped server side and the fact that census areas are often multi-polygons. And one needs to be careful to employ random
rounding when scaling to more than one person per dot, standard rounding may introduce systematic errors.</p>

<h4>CensusMapper Dot-Density Issues</h4>

<p><a href="https://censusmapper.ca/maps/797#12/49.2430/-123.0103"><img  src="/images/recent_immigrants_da.png" style="width:50%;float:right;margin-left:10px;"></a>
1. Clipping. There are still some minor issues due to clipping that can lead to the number of dots being off by a small
proportion. I won&rsquo;t bore you with the technical details, but the good news is that it can be worked out at the expense
of adding some more custom code on the client.
2. Dynamic dot-value scaling. CensusMapper maps allow for zooming from country-level down to street level. The one dot
= one person paradigm does not work very well on all scales. Visually as well as computationally. The smallest unit to
draw is one pixel (or 1 quarter of a pixel on 2x retina displays), and at some point (at the
latest when having to draw 33 million dots randomly within different regions in Canada) your browser performance will
tank. To fix this we need to dynamically adjust the value of each dot. Instead of 1 dot = 1 person it will be 1 dot =
10 people at lower zoom levels. And at higher zoom levels at some point one dot will have to start to get larger to be
more visible. Dynamically changing scales can be confusing though. As we zoom we keep the size of each dot relative to
the map constant, but if we re-scale we change the size of each dot relative to the map scale to make it clearer to the user that
wer are rescaling.
<a href="https://censusmapper.ca/maps/797#10/49.2430/-123.0103"><img  src="/images/recent_immigrants_ct.png" style="width:50%;float:left;margin-right:10px;"></a>
3. Non-uniform distribution of population. The current code has the problem of placing the dots randomly in each census
geography regardles of where people actually live. This goes back to the fundamental issues that dot-density maps suggest
a level of precision that simply is not there. But it definitely is odd to see dots in the Pacific Spirit Park or
<a href="https://twitter.com/mikeklassen/status/684981658013990913">camping out on Burnaby Mountain</a>.
The good news is that there is a partial fix to this. We have population counts at a finer census geometry:
Census Blocks. And at the Census
Block level we see that nobody lives in the Pacific Spirit Park, or on most of Burnaby Mountain. So to fix this we
simply need to shift the way we decide what census geography to display. This is quite difficult to fix within the
CensusMapper paradigm of highly dynamic maps where nothing is pre-computed.
4. Visual feedback on hover / select. For choropleth maps we highlight regions on hover so that the user knows what geographic
area the variables in the legend and in the popup are for. This is something that is not too difficult to add, but we
will have to wait for the next bigger CensusMapper map refresh.</p>

<h4>Static dot-density maps</h4>

<p>Statis maps is one way where the above issues don&rsquo;t appear. And most importantly, we can fix issue 3. completely by
taking the time to weight the placement of dots by census block level data. The new
<a href="https://github.com/mountainMath/cancensus"><code>cancensus</code> R package</a> now makes it
super easy to import cenusus data into R, and we wrote a <a href="https://github.com/mountainMath/dotdensity"><code>dotdensity</code> R package</a>
to implement common functions that deal
with the usual pitfalls of multi-category dot-density maps. By moving from CensusMapper to R we trade the dynamic nature
of CensusMapper for crisper images and improved processing and dot-placement. Often we aren&rsquo;t interested in Canada-wide
maps that are the staple of CensusMapper, but only want to focus on one particular region. Or maybe a couple of regions,
and the <code>cancensus</code> and <code>dotdensity</code> packages still make it very easy to change the region and make the same map for a
different geographic region. Or make changes to the variables we want to map. In particular in conjunction with the
<a href="">CensusMapper API helper</a> that reduces the selection of geographies and variables to a couple of mouse clicks and
let&rsquo;s you copy and paste the R code to import the data through <code>cancensus</code>.</p>

<p>The dot-density package has two main functions that we use</p>

<p><code>dot_density.compute_dots</code> takes care of converting geographic shapes with counts for each category into dots. This
is fairly straight-forward, but we need to pay attention to two potential pitfalls.</p>

<ul>
<li>The order of the dots need to be
randomized so we don&rsquo;t draw all items of one particular category (colour) last, so that these end up on top and appear
more prominent than others.</li>
<li>When we scale so that 1 dot represents more than 1 unit in our category count, we need to employ statistical rounding,
not just regular rounding, otherwise the overall count of the dots may not represent the overall averages. To see this,
suppose we want to map German speakers, and we scale so that 1 dot corresponds to 50 German speakers. If German speakers
are uniformly distributed in each area so that there are 20 German speakers in each area, regular rounding will produce a
map without any German speakers at all. Statistical rounding will properly reflect the total number of German speakers,
but they will be randomly placed in each area. Not ideal, we probably should adjust our scale. But better than random
rounding. And adjusting the scale is not always an option, for example there might be one cluster of German speakers and a uniform
distribution everywhere else.</li>
</ul>


<p>The <code>dot_density.compute_dots</code> takes care of these issues under the hood. (And so does CensusMapper.)</p>

<p><code>dot_density.proportional_re_aggregate</code> takes two nested geographies, for example census subdivisions and census tracts. It will
compare counts across the geographic levels and adjust the lower-level geography counts with the more accurate higher-level data.
If lower level geographic data has been suppressed due to quality or privacy concerns the overall counts at that aggregation level
won&rsquo;t accurately reflect the overall data. The <code>dot_density.proportional_re_aggregate</code> will re-distribute the missing counts
proportionately among the lower level geographies, weighted appropriately.</p>

<p>The same function can also be used to weight the dots we want to draw by block level data, so this will produce maps that avoid
placing dots in parks or other unpopulated areas, spacing them according to population density at the block level.</p>

<h4>Examples</h4>

<p>When the data is easily accessible and well-organized, it is incredibly easy to run analysis or visualize it. In CensusMapper,
we can make dot-density maps within a matter of minutes, and with the <code>cancensus</code> and <code>dotdensity</code> packages it&rsquo;s no different in R.</p>

<p>Hear are a couple of examples, first from CensusMapper with links to the live maps, and then from the vignettes embedded into the R package.</p>

<h5>CensusMapper</h5>

<p>Occupied dwelling units by type
<a href="https://censusmapper.ca/maps/727#12/49.2719/-123.0967"><img  src="/images/dwellings-dot-density.png"></a></p>

<h5>R</h5>

<p>Language Spoken at Home
<img src="https://github.com/mountainMath/dotdensity/raw/master/images/vancouver-languages.png" alt="Languages" /></p>

<p>Household Size
<img src="https://github.com/mountainMath/dotdensity/raw/master/images/toronto-hh-size.png" alt="Household Size" /></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jens von Bergmann</span></span>

      








  


<time datetime="2017-08-24T22:28:40-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/canada/'>canada</a>, <a class='category' href='/blog/categories/census-data/'>census data</a>, <a class='category' href='/blog/categories/censusmapper/'>censusmapper</a>, <a class='category' href='/blog/categories/d3/'>d3</a>, <a class='category' href='/blog/categories/dot-density/'>dot-density</a>, <a class='category' href='/blog/categories/mapping/'>mapping</a>, <a class='category' href='/blog/categories/open-data/'>open data</a>, <a class='category' href='/blog/categories/r/'>r</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://doodles.mountainmath.ca/blog/2017/08/24/dot-density/" data-via="vb_jens" data-counturl="http://doodles.mountainmath.ca/blog/2017/08/24/dot-density/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/08/23/density/" title="Previous Post: Density">&laquo; Density</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/08/24/dot-density/">dot-density</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/08/23/density/">Density</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/08/06/millennials-redux/">Millennials Redux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/05/16/lifeblood/">Lifeblood</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/10/surprise/">Surprise Maps</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/04/03/joyce-collingwood/">Marine Gateway and Joyce-Collingwood</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/22/comparing-censuses/">Comparing Censuses</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/06/rs-population-change/">RS Population Change</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/01/transit-explorer/">Transit Explorer</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/21/more-on-teardowns/">More on Teardowns</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  
  <a class="twitter-timeline" href="https://twitter.com/vb_jens" data-widget-id="680989637721063424">Tweets by @vb_jens</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - MountainMath -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'doodlesmountainmathca';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://doodles.mountainmath.ca/blog/2017/08/24/dot-density/';
        var disqus_url = 'http://doodles.mountainmath.ca/blog/2017/08/24/dot-density/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
