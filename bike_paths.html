<!DOCTYPE html>
<head>
<meta charset="utf-8">
<style>
    path {
        stroke: black;
        stroke-width: 1px;
        fill: none;
    }
    path:hover {
        stroke-width: 3px;
    }
    path.local_street {
    }
    path.painted_lanes{
    }
    path.separated_lanes{
    }
    path.shared_lanes{
    }
    path.unknown {
        display: none;
    }
    #buttons {
    }
    #map {
        border:solid darkgray 1px;
        border-radius: 5px;
//        width:100%;
//        height:100%;
    }
    #legend {
        text-align: right;
        font-size: large;
        width:100px;
    }
    #title{
        font-size: 40px;
        font-family:"sans-serif";
    }

</style>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>
<div id="map"></div>
<div id="buttons"></div>
<script>
    var height=window.innerHeight-20;
    var width=window.innerWidth-20;

    var mapHeight=height-40;

    var projection = d3.geo.mercator()
            .center([-122.943 ,49.2])
            .scale(150000);
    var path = d3.geo.path()
            .projection(projection);

    var footer;
    var legend;
    var g;
    var svg;

    svg = d3.select("#map").append("svg").attr("width", width)
            .attr("height", height);
    g = svg.append("g").attr("width", width)
            .attr("height", height);
    svg.append('text')
            .attr('x',10)
            .attr('y',40)
            .attr('id','title')
            .text('Vancouver');
    legend=svg.append('text')
            .attr('y',40)
            .attr('id','legend');
    footer=svg.append("svg:foreignObject")
            .attr('x',10)
            .attr("height",40);

    var options=footer.append("xhtml:body")
            .attr('id','buttons');



    // load and display the World
    d3.json("data/bikeways.geojson", function(error, collection) {
        var infrastructure_types={};
        g.selectAll("path")
                .data(collection.features)
                .enter()
                .append("path")
                .attr('class',function(d){
                    var lane_type=d.properties.TYPE;
                    if (! lane_type) lane_type='unknown'; else {
                        infrastructure_types[lane_type] = (infrastructure_types[lane_type]) ? infrastructure_types[lane_type] + 1 : 1;
                        lane_type=lane_type.split(' ').join('_').toLowerCase();
                    }
                    return lane_type;
                })
                .attr("d", path)
                .on('mouseover',function(d){legend.text(d.properties.NAME);})
                .on('mouseout',function(d){legend.text(' ');});
        console.log(infrastructure_types);
        var buttons='';
        Object.keys(infrastructure_types).map(function(i){buttons+='<label><input type="checkbox" name="'+ i.split(' ').join('_').toLowerCase()+ '" checked ></input>'+ i +'</label>'});
        options.html(buttons);
        d3.selectAll("#buttons input").on('click',function(d){
            var display=(this.checked) ? 'inherit' : 'none';
            d3.selectAll('path.'+this.name).attr('display',display);
        });

        function resize() {
            height=window.innerHeight-30;
            width=window.innerWidth-20;
            mapHeight=height-40;
            svg.attr("width", width)
                    .attr("height", height);
            var scale=Math.min(width/560,1);
            g.attr("width", width)
                    .attr("height", height)
                    .attr('transform', 'translate('+width/2+','+mapHeight/2+')scale('+scale+')');
            footer.attr('y',mapHeight+10)
                    .attr("width", width-20);
            legend.attr('x',width-100);
        }

        resize();
//        window.onresize=function(){resize();};
        window.onresize=resize;
    });
/*
    var zoom = d3.behavior.zoom()
            .on("zoom",function() {
                g.attr("transform","translate("+
                d3.event.translate.join(",")+")scale("+d3.event.scale+")");
                g.selectAll("path")
                        .attr("d", path);
            });

    svg.call(zoom)
*/
</script>
</body>
</html>