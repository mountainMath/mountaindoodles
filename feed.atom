<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Mountain Doodles]]></title>
  <link href="http://doodles.mountainmath.ca/feed.xml" rel="self"/>
  <link href="http://doodles.mountainmath.ca/"/>
  <updated>2016-10-22T00:33:33-07:00</updated>
  <id>http://doodles.mountainmath.ca/</id>
  <author>
    <name><![CDATA[MountainMath]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Trick-or-Treat 2016]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/10/21/trick-or-treat-2016/"/>
    <updated>2016-10-21T20:38:14-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/10/21/trick-or-treat-2016</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/529" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tot_density.png" style="width:50%;float:right;margin-left:10px;"></a>
A year ago, as were were just getting CensusMapper up and running, we put out three Halloween-themed census maps. Those
maps almost broke our servers when they went viral. At least as viral as census data goes. They were viewed by over
150,000 Canadians over the course of three days. And many of those came back to view the maps more than once.</p>

<p>Lots of things have happened at CensusMapper since last year, and we heeded the call and put some of CensusMapper&rsquo;s prowess
to use to make some important improvements for this Halloween.</p>

<!-- more -->


<p>We are stuck in a weired place this year. We just completed the
<a href="https://twitter.com/NavdeepSBains/status/770281404848566273">most successful census in the Canadian history</a> this May,
but the results are still undergoing quality control and will only get released starting this coming spring. The 2011
census, that last year&rsquo;s maps are based on, is now 5 years old. Some children that were of prime trick-or-treating age
(which we take as 5 to 14 years old) in 2011 are now in College. And some that weren&rsquo;t even borne in 2011 will be out
knocking on doors this Halloween.</p>

<p>As people move around, the composition of neighbourhoods does not change all that much over time. Young kids grow up to take
the place of the older kids in the neighbourhood. That was our take last year, as we were still mapping 2011 data to
give people an idea how many kids would show up on their door or where to expect the most foot traffic.</p>

<h3>The maps</h3>

<p>Last year we made three maps, the
<a href="https://censusmapper.ca/maps/137">Trick-or-Treat Density map</a> that visualized the expected trick-or-treat foot traffic,
the <a href="https://censusmapper.ca/maps/136">Trick-or-Treat Onslaught Map</a> that visualized how many kids to expect at your
door and the <a href="https://censusmapper.ca/maps/138">Haunted House Map</a>
that&rsquo;s mapping ghosts and other &ldquo;unusual residents&rdquo;.</p>

<p>This year we improved on those maps by building a dynamic estimator that estimates conditions on the ground this Halloween. We
have:</p>

<table>
<tr>
<td style="width:25%;padding:3%">
<a href="https://censusmapper.ca/maps/529" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tot_density.png" style="width:100%"></a>
</td>
<td style="width:25%;padding:3%">
<a href="https://censusmapper.ca/maps/528" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tot_onslaught.png" style="width:100%"></a>
</td>
<td style="width:25%;padding:3%">
<a href="https://censusmapper.ca/maps/138" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tot_haunted_houses.png" style="width:100%"></a>
</td>
<tr> 
</table>


<ul>
<li><p><a class='btn btn-success' href="https://censusmapper.ca/maps/529" target="_blank">Trick-or-Treat Density Estimator</a>
that estimates the number of children of prime trick-or-treat age per area, so the expected trick-or-treat foot traffic
in each area. Use this map if you plan on taking your kids out trick-or-treating and want to make sure you find the area
in your neighbourhood with the most kids out on the street.</p></li>
<li><p><a class='btn btn-success' href="https://censusmapper.ca/maps/528" target="_blank">Trick-or-Treat Onslaught Estimator</a>
that estimates the number of children of prime trick-or-treat age per doorbell. Use this map if you are guarding the door
and want to know how much candy you should have ready.</p></li>
<li><p><a class='btn btn-success' href="https://censusmapper.ca/maps/528" target="_blank">Haunted Houses Map</a> that shows
the houses that were occupied only by ghosts or <em>unusual residents</em> in May 2011. As ghosts and <em>unusual residents</em> tend
to be restless we were not comfortable making estimates where they may be now,
even with all of CensusMapper&rsquo;s power behind it. So we only have the 2011 map to give some inspiration where the best
chances might be to run into ghosts or cross paths with <em>unusual residents</em>.</p></li>
</ul>


<h3>How did we estimate things for 2016 Halloween?</h3>

<p>An skillful estimator strikes a balance between simplicity and effectiveness. We decided to make use of the
following data:</p>

<ul>
<li>The number of children in the age brackets 0-4, 5-9 and 10-14 in each area in 2011.</li>
<li>The number of children in the age brackets 0-4, 5-9 and 10-14 in each area in 2006.</li>
<li>The percentage of the population in each area in 2011 that did not move between 2006 and 2011.</li>
</ul>


<p>Based on this, we split the estimate of the number of children in each area in 2016 into two groups. Children that
already lived in the are in 2011 and still live there in 2016, and children that moved into the area between 2011 and 2016.
We estimate the proportion by using the proportion of people that did not move between 2006 and 2011 as a proxy.</p>

<p>Then estimating the number of children that did not move is easy, we simply age the children we saw in 2011 forward by
five years and weight them by the proportion of non-movers.</p>

<p>To estimate the number of children moving into the area take into account at the trends from 2006 to 2011 in each area
and extrapolate from there to 2016. And weight the number by the proportion of the population that did move and also
allow for some population growth according to the 2006 to 2011 trend.</p>

<p>I will spare you the exact formula. It is possible that refining the model and adding in more variables could make some
improvements to the estimates, but overcomplicating the model also leads to risks of exaggeratig biases. We feel that
our simplistic model strikes a good balance between simplicity and effectiveness. It will be interesting to see how we
did when 2016 data comes in.</p>

<h3>The Super Nerdy Details</h3>

<p>For the data nerds still reading, the CensusMapper servers actually don&rsquo;t do any of that work. They just server straight-up
census data. All the computations and drawings are then done locally on each user&rsquo;s browser. That&rsquo;s what keeps our servers
lean, responsive, and most importantly maintains maximum flexibility. With the same process we can easily map any function
built from census variables. Canada-wide and across all the entire geographical census hierarchy, from all of Canada down
to Dissemination Areas and, for some data, even Dissemination Blocks. Bwetween the 2006 and 2011 census
variables and all the different geographic regions we have about 1 billion fields in our database that we can map
dynamically. Still a far cry from &ldquo;big data&rdquo;, but enough to require some careful architecture choices.</p>

<h3>Census Mapping for Everyone</h3>

<p>Census data can be very complex and mixing various variables is powerful yet prone to produce meaningless maps due to
misinterpretation of the census variables. Since last Halloween and now we are proud to have been able to open up some
of CensusMapper&rsquo;s capabilities to the general public. Everyone can now make Canada-wide interactive maps based on single
2011 census variables via a couple of mouse clicks and share the freely. You can read more about this
<a href="http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone/">in a previous blog post</a> or
<a href="https://censusmapper.ca/maps/new">jump right in and make your own map</a>.</p>

<h3>FAQ</h3>

<p>Here are some of the questions we got most last year:</p>

<h5>Are the maps only for Vancouver?</h5>

<p>No. All CensusMapper maps are fully interactive and by default Canada-wide. Use the search function or geo-location
button to switch to any place in Canada that tickles your interest. Pan and zoom around to explore. You can always share
the current view of the map with your friends by grabbing the URL in your browser address bar or using the build in share buttons.</p>

<h5>What&rsquo;s the difference between the Trick-or-Treat Density and the Trick-or-Treat Onslaught map?</h5>

<p>The maps are related, both map the number of children of prime trick-or-treat age, but they are normalized differently.
The Density map considers the number of children per area. This estimates how many you will see out on the street in the area.
The Onslaught map considers the number of children per door, so you can estimate how many will come knocking.
The difference can be seen in high density areas like Yaletown in Vancouver. There are a lot of kids living in Yaletown
in a fairly small area, so the expected foot traffic is high. But these kids distribute over the units in the highrises
there and on a per household (or per door) basis, the number of kids per household does not stand out.</p>

<h5>How accurate are the predictions?</h5>

<p>Accuracy of predictions vary. Some parents will drive their kids halfway across town to find the best area for
trick-or-treating. Some areas change too fast for our estimator to catch on. And some neighbourhoods have traditions and
local areas where kids congregate that we don&rsquo;t have data for. So these maps are best use in conjunction with local data.</p>

<h5>Won&rsquo;t your maps lead to more people trick-or-treating outside of their neighbourhood?</h5>

<p>While our maps can be used to facilitate driving kids across town to trick-or-treat, we encourage everyone to also
use the map to find areas near
where they live, and where the kids can walk to. We believe an important part of the Halloween experience is for everyone
to get to know their own neighbourhood better, see things in a new light and experience the
joys of running into friends and acquaintances, and making new friends, along the way.</p>

<h5>I am running out of candy / I got way too much candy!</h5>

<p>The Onslaught map just estimates the average number of children that knock on doors in each area. Some doors will see a
lot more kids than others. Take the Yaletown example from above. Most
of the action happens on the street. So while on average people can only expect a moderate number of trick-or-treaters
at their door, the ones at ground level will be <em>very</em> busy, while the ones higher up will likely just see one or two
neighbour kids from the same floor.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Secondary Suites and Taxes]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/10/04/secondary-suites-and-taxes/"/>
    <updated>2016-10-04T14:59:20-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/10/04/secondary-suites-and-taxes</id>
    <content type="html"><![CDATA[<p><a href="https://censusmapper.ca/maps/519#12/49.2597/-123.1243" target="_blank"><img  src="http://doodles.mountainmath.ca/images/secondary_suites.png" style="width:50%;float:right;margin-left:10px;"></a>
A couple of weeks ago I started thinking about secondary suites, laneway houses and taxes in the City of Vancouver. The number
of secondary suites and laneway houses has been continuously growing. Rental income
is probably one of the main reasons people choose to activate a secondary suite. What are the tax implications?</p>

<!-- more -->


<h2>Secondary Suites</h2>

<p>How many secondary suites are out there? Nobody really knows, but we have some estimates. Comparing single family properties
from the assessment roll to census counts provides one estimate. This is likely a lower bound as the census is prone to
undercount suites. Using this method, we arrive at a lower bound of 30,000 single family properties with a suite in 2011,
up from about 27000 in 2006. The <a href="https://censusmapper.ca/maps/519#12/49.2597/-123.1243">above map</a> gives a rough idea
of their location, although it also includes the roughly 2000 stratified duplex properties.</p>

<p>Of these we estimate that 7,000 had more than one suite in 2011, with a similar number in 2006. The number of laneway houses was
quite small in 2011, likely less than 400. But by now the number has grown to over 2,000.</p>

<p>In total that adds up to an estimated around 37,000 suites in the city of Vancouver in 2011. Probably more in the
recent 5 years, maybe fewer in the years between 2006 and 2011. Most of these will be operated as suites, with the main
unit serving as a principal residence of the property owner. But this also includes investment properties where each
unit, including the main unit in the house, are rented out.</p>

<p>For this post we will focus entirely on the suites. We might expand on this analysis at some later point and separate
out owner-occupied homes from investment properties. Moreover we will use the more conservative estimate of 30,000
suites. Feel free to adjust that estimate in the interactive at the bottom see how this effects the estimates we make.</p>

<h2>Income Tax</h2>

<p>Secondary suite rental income needs to be recorded on
<a href="http://www.cra-arc.gc.ca/E/pbg/tf/t776/t776-15e.pdf">CRA form T776</a> and, after claiming deductions, taxed.</p>

<p>Estimating the average suite rental income at $1,000, claiming $200 in deductions leaves us with $800 or $9,600 in
monthly taxable income. With single family homeowners generally above the median income we use a marginal tax rate of 35%
to estimate $3,360 of taxes per secondary suite, so cumulative $100,800,000 in income taxes payed on secondary suite
rental income in the City of Vancouver.</p>

<h2>Capital Gains Tax</h2>

<p>Assessing the capital gains implications is more complex. The capital gains exemption applies to a <em>housing unit</em>. If a
property with several housing units is sold, only the capital gains attributed to the unit used as principal residence
is exempt from taxation. Typically the portion of taxable gains is determined by the relative areas of the rented and
principal residence parts of the home.</p>

<p>So the question whether the portion of a house taken up by a secondary suites is exempt from capital gains essentially
boils down to the question whether or not the secondary suite counts as a &ldquo;self–contained domestic establishment
for earning rental income&rdquo; or as &ldquo;one or more rooms in the home&rdquo;. I have asked the CRA to clarify how this would apply
to someone converting a portion to a house to secondary suite or building a laneway house, to which I got the following
response.</p>

<blockquote><p>The conversion of a portion of a house that otherwise is the taxpayer’s principal residence for the purpose of earning income or the creation of a separate building or structure on land that forms part of the taxpayer’s principal residence for the purpose of earning income are examples of structural changes that would result in a deemed disposition and reacquisition of a portion of the property.</p></blockquote>

<p>Similarly, when a homeowner deactivate a suite and absorbes it into their main residence that would trigger another
<a href="http://www.cra-arc.gc.ca/tx/tchncl/ncmtx/fls/s1/f3/s1-f3-c2-eng.html#N10BCD">&ldquo;deemed disposition (and reacquisition) thereof at fair market value&rdquo;</a>.
Which then would trigger a &ldquo;taxable capital
gain attributable to the period of use of such portion of the property for income–producing purposes&rdquo;, just like it
would at a sale of the property.</p>

<p>In the case when the homeowner rents out their entire home and later moves back in again, the homeowner can, under
certain circumstances, make an election that he can maintain the primary residence status for most recent 4 years during
which the home was rented out. I have asked the CRA to clarify if a similar election could be made for a secondary suite,
when for example after four years of renting the suite is deactivated and again absorbed in the main house and the response
was that &ldquo;such an election cannot be made where there is only a partial change in use of the property.&rdquo;</p>

<p>Based on this I am fairly convinced that the portion of a home used as a secondary suite or laneway house is not exempt
from capital gains tax. Despite my best efforts I might still be reading this wrong, in which case I would love to have
an expert weight in on this.</p>

<h3>Estimating Capital Gains Generated by Suites</h3>

<p>To estimate the amount of capital gains tax based on secondary suites expected to accrue annually in the City of Vancouver
we use the inflation-adjusted land value gain of a home as a
proxy for the portion of the appreciation of the property that is not due to improvements the owner made to the home, i.e.
the portion that would be subject to capital gains tax if this wasn&rsquo;t a primary residence.</p>

<p>To compute the taxable gains for an individual property we take the difference between the current land value and the
(inflation-adjusted) present land value at the time the property was bought. To simplify things a little we will consider the
current average (over SFH with suite) land value, the average holding period (years between buy and sell), and the
average inflation-adjusted land value gains. This can be refined, but should suffice for our purposes.</p>

<p>Going back to our estimate, the current (July 2015) average land value of single family homes was $1,640,000. Suites skew toward
the east, where average land value was $1,080,000. We roughly average these and take $1,300,000 as our base value. As
average holing period we take 10 years, and we compute the average inflation-adjusted land value gain between 2005
and 2015 at 10.4% (9.7% on east side). So let&rsquo;s use 10%.</p>

<p>That gives an estimate of the annual land value gain of $850,000 over 10 years, or $85,000 on average per year.
As a sanity check, this is in line with estimates of average annual land value gain for single family properties
<a href="http://doodles.mountainmath.ca/blog/2016/01/24/work-vs-twiddling-thumbs/">we have done before</a>, although these weren&rsquo;t
inflation-adjusted.</p>

<p>Roughly estimating that on
average a secondary suite takes up about a quarter of the area of a
house, we attribute $21,250 of the $85,000 annual land value gains to the secondary suite for tax purposes.</p>

<p>Of course capital gains tax are only payable when the property sells, but the yearly average gains accumulate and eventually
properties will sell. In which case we expect capital gains taxes to be payed on $21,250 per year the suite was rented.
So if a person sells a home with a suite that was rented for the last 10 years, the person will have to pay capital gains
taxes on $212,500. On average, we expect $21,250 of taxable capital gains income per house with suite per year.</p>

<p>The way capital gains tax works is that half of the gains are taxed at the marginal tax rate. As these tend to be large
sums of money at a time, it is safe to assume that the the effective tax rate on the gains is relatively high, say 35% or
more. Some of the taxes could be deferred by e.g. transferring the gains into RRSPs and later taxed at a lower rate. But
we will ignore this, it has the effect of lowering the effective tax rate on the gains and move the tax payments into the future,
but will not effect the overall amount of capital gains declared.</p>

<p>Assuming an effective tax rate of 35% on the gains we expect on average $3,700 of taxes payed per home with suite per
year through this mechanism. With
conservatively estimated 30,000 secondary suites in Vancouver that adds up to a tidy sum of $111,000,000 for capital gains
taxes paid due to secondary suites in the City of Vancouver. Per year.</p>

<h2>To Rent or Not to Rent Out a Suite</h2>

<p>In the case of rental suites with owner-occupied main portion the suite incurs both income and capital gains tax obligations.
This begs the question what minimum rent is required
to offset the capital gains obligations in a particular year. Typically homeowners don&rsquo;t know the annual value value gains
ahead of time, so this is more of an academic exercise than a practical questions. The important takeaway is that the
capital gains exemption has the effect of dramatically lowering the cap rate for converting part of a principal residence
into a rental unit.</p>

<p>The math is quite simple, we need to compare the net rental income (rent minus deductions) to the capital gains taxes
payable due to the rental. A more comprehensive way to look at this is to look at the
CAP rate based on land value investment, in this case the net rental income (after-tax rental income minus deductions)
per land value attributed to the suite. With our standard assumptions this sits at 1.9%.</p>

<p>This we can compare to the effective tax rate on the capital gains, which is given by multiplying half of the tax rate
(as only half the gains are taxed at that rate) with the rate of land value rise, which comes in at 1.75% with our standard assumptions.</p>

<p>To conclude this calculation we define the net cap rate as the difference between the cap rate and the effective tax rate
on the capital gains. If this is positive, it is the advantageous to rent. If it is negative, leaving the property vacant
will yield higher returns.</p>

<p>More specifically if we want to understand if it was advantageous to rent out a suite in a particular year for a particular
property we can adjust the assumptions in the interactive at the bottom accordingly. For example, in the year 2015 we
saw an average land value gain of about 20%. Adjusting the rate in the interactive, and setting the holding period to 1 year,
we get a net CAP rate of -1.6%. The break-even rent, above which it is advantageous to rent out the suite, was $1,820.</p>

<h2>Taxes Collected</h2>

<p>It would be interesting to compare these estimates with actual taxes collected. But this won&rsquo;t be easy without internal
CRA data. The census for example does not break out rental income. But it does break out capital gains income. Not all
capital gains income stems from selling homes with secondary suites of course and again, the census does not break out
the sources of the capital gains income. But capital gains income is rare enough, especially on the suite-heavy east side,
to yield some information.</p>

<p><a href="https://censusmapper.ca/maps/480#11/49.2360/-123.1361" target="_blank"><img  src="http://doodles.mountainmath.ca/images/capital_gains.png" style="width:50%;float:left;margin-right:10px;"></a>
In the City of Vancouver, a total of
$830 million of net capital gains and losses was reported to the CRA in 2010,
most of which was claimed by people living on the west side. When comparing
to 2010 taxes we should adjust our calculation to the average east side single family land value of $620,000 in 2010 and
might want to assume a very conservative inflation-adjusted land value gain of 5% per year (I have no data before 2005,
but one could use sales data to estimate this better). This would yield an expected taxable annual capital gains of $10,000
per suite in each area (with expected annual taxes generated of $1,750 per suite), adding up to over one third of all
capital gains reported in the City of Vancouver that year. And that&rsquo;s not counting taxable capital gains from selling
investment properties that were not used as principal residence at all and where all the gains are taxable. Or any other
source of capital gains income.</p>

<p><a href="https://censusmapper.ca/maps/480">Eyeballing the total capital gains reported</a>  suggests that tax compliance could be improved. It seems that the
changes in requiring the reporting of a sale of a principal residence that were announced yesterday will do just that.</p>

<h2>Interactive</h2>

<p>For people interested in adjusting the assumptions made for these estimates I made a quick interactive to facilitate this.
Adjust to fit your own assumptions.</p>

<h4>Assumptions</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>Secondary Suites</td><td><input type="range" id="suite"></td><td id="suiteValue"></td></tr>
<tr><td>Average Portion of House Taken by Suite</td><td> <input type="range" id="area"></td><td id="areaValue"></td></tr>
<tr><td>Average Rent</td><td> <input type="range" id="rent"></td><td id="rentValue"></td></tr>
<tr><td>Average Rent Deductions</td><td> <input type="range" id="deductions"></td><td id="deductionsValue"></td></tr>
<tr><td>Average Marginal Tax Rate</td><td><input type="range" id="tax"></td><td id="taxValue"></td></tr>
<tr><td>Average SFH Land Value</td><td><input type="range" id="land"></td><td id="landValue"></td></tr>
<tr><td>Average SFH Holding Period</td><td><input type="range" id="years"></td><td id="yearsValue"></td></tr>
<tr><td>Average Inflation-Adjusted Land Value Gain</td><td><input type="range" id="gain"></td><td id="gainValue"></td></tr>
</table>


<h4>Computed Quantities of Interest</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>CAP Rate</td><td id="cap_rate"></td></tr>
<tr><td>Effective Cap Gains Tax Rate</td><td id="effective_tax_rate"></td></tr>
<tr><td>Net CAP Rate</td><td id="net_cap_rate"></td></tr>
<tr><td>Break-Even Rent</td><td id="minimal_rent"></td></tr>
</table>


<h4>Annual Taxes Generated</h4>

<table style="border-spacing:1em 0;border-collapse:separate;margin-bottom:20px;">
<tr><td>Annual Income Tax Generated</td><td id="income_tax"></td></tr>
<tr style="display:none;"><td>Average Annual Adjusted Total Land Value Gain</td><td id="av_lv_gain"></td></tr>
<tr><td>Annual Cap Gains Tax Generated</td><td id="cap_gains_tax"></td></tr>
<tr><td>Annual Total Tax Generated</td><td id="total_tax"></td></tr>
</table>




<div><script>
var percentageFormatter=d3.format(".1%");
var currencyFormatter=d3.format("$,.3r");
var numberFormatter=d3.format(",.0f");

var suiteValue=30000,
    rentValue=1000,
    deductionsValue=0.2,
    landValue=1300000,
    gainValue=0.1,
    yearsValue=10.0,
    areaValue=0.25,
    minimalRentValue=1000,
    taxValue=0.35;
document.getElementById('suite').value=(suiteValue-20000.0)/400.0;
document.getElementById('rent').value=(rentValue-500)/20;
document.getElementById('deductions').value=deductionsValue*100;
document.getElementById('area').value=areaValue*100;
document.getElementById('tax').value=taxValue*100;
document.getElementById('gain').value=(gainValue+0.1)/0.6*100;
document.getElementById('land').value=(landValue-200000)/20000;
document.getElementById('years').value=(yearsValue-1)*5;

function updateResults(){
   $('#suiteValue').html(numberFormatter(suiteValue));
   $('#rentValue').html(currencyFormatter(rentValue));
   $('#deductionsValue').html(percentageFormatter(deductionsValue));
   $('#areaValue').html(percentageFormatter(areaValue));
   $('#taxValue').html(percentageFormatter(taxValue));
   $('#landValue').html(currencyFormatter(landValue));
   $('#gainValue').html(percentageFormatter(gainValue));
   $('#yearsValue').html(numberFormatter(yearsValue));

   var value1=suiteValue*rentValue*(1-deductionsValue)*taxValue*12.0;
   $('#income_tax').html(currencyFormatter(value1));
   var lvGain=landValue*(1-Math.pow(1-gainValue,yearsValue))/yearsValue;
   var value2=suiteValue*taxValue*areaValue*lvGain/2.0;
   $('#av_lv_gain').html(currencyFormatter(lvGain));
   $('#cap_gains_tax').html(currencyFormatter(value2));
   $('#total_tax').html(currencyFormatter(value1+value2));
   var minimalRent=landValue*areaValue*gainValue/2*taxValue/(1-taxValue)/(1-deductionsValue)/12.0;
   $('#minimal_rent').html(currencyFormatter(minimalRent));
   var capRate=rentValue*12*(1-deductionsValue)*(1-taxValue)/(landValue*areaValue);
   $('#cap_rate').html(percentageFormatter(capRate));
   var effectiveRate=taxValue/2.0*gainValue;
   $('#effective_tax_rate').html(percentageFormatter(effectiveRate));
   $('#net_cap_rate').html(percentageFormatter(capRate-effectiveRate));
}

$('#suite').on('change',function(){
    suiteValue=parseFloat(this.value)*400.0+20000.0;
    updateResults();
});
$('#area').on('change',function(){
    areaValue=parseFloat(this.value)/100.0;
    updateResults();
});
$('#rent').on('change',function(){
    rentValue=parseFloat(this.value)*20+500;
    updateResults();
});
$('#land').on('change',function(){
    landValue=parseFloat(this.value)*20000+200000;
    updateResults();
});
$('#deductions').on('change',function(){
    deductionsValue=parseFloat(this.value)/100.0;
    updateResults();
});
$('#gain').on('change',function(){
    gainValue=parseFloat(this.value)/100.0*0.6-0.1;
    updateResults();
});
$('#years').on('change',function(){
    yearsValue=Math.round(parseFloat(this.value)/5.0 + 1.0);
    document.getElementById('years').value=(yearsValue-1)*5;
    updateResults();
});
$('#tax').on('change',function(){
    taxValue=parseFloat(this.value)/100.0;
    updateResults();
});

updateResults();
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sea Level Rise]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/10/02/sea-level-rise/"/>
    <updated>2016-10-02T21:22:25-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/10/02/sea-level-rise</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/elevation/map?sea_level=10&zoom=12&lat=49.2629&lng=-123.1176" target="_blank"><img  src="http://doodles.mountainmath.ca/images/van_sea_level.png" style="width:50%;float:right;margin-left:10px;"></a>
Sea level rise comes up regularly in coastal cities. And nowadays every costal area,
<a href="http://www.env.gov.bc.ca/wsd/public_safety/flood/pdfs_word/cost_of_adaptation-final_report_oct2012.pdf">including Vancouver</a>
has their flood assessment and detailed plans on how to deal with sea level rise, although some plans are
<a href="http://www.sfu.ca/rise/entries/Prescribe-mountains.html">more interesting than others</a>.</p>

<p>The web is awash with sea level rise maps, some static, some interactive, <a href="http://geology.com/sea-level-rise/">some global ones</a>
and some <a href="https://coast.noaa.gov/slr/">national maps</a>. Data sources range from high detail LIDAR data to satellite data
and other datasets. When Mapzen put out their <a href="https://mapzen.com/blog/elevation/">global elevation tiles</a> I gave it a quick
test drive to check it out and then forgot about it. When the topic inevitably
<a href="https://twitter.com/toddsmithdesign/status/782273909265620992">bubbled up on my twitter feed</a> I decided to do some
minimal styling using Mapzen&rsquo;s <a href="https://mapzen.com/products/tangram/">ridiculously easy to use Tangram map engine</a> and
added a search bar to make it easier to jump to different locations on the globe.</p>

<p>That&rsquo;s all there is to this. Check out <a class="btn btn-default" href="https://mountainmath.ca/elevation/map?sea_level=10&zoom=12&lat=49.2629&lng=-123.1176">yet another interactive global seal level rise map</a>.</p>

<p>The preset for the sea level rise is 10m, which is a little excessive. Current predictions hover around 1m until 2100.
Adjust the slider to see how the flooded areas change depending on the simulated sea level rise.</p>

<p>The map is global, and it&rsquo;s worthwhile to compare Vancouver&rsquo;s sea level threat to that of other places, for example
<a href="https://mountainmath.ca/elevation/map?sea_level=0&amp;zoom=9&amp;lat=52.8774&amp;lng=5.5701">Holland where 21% of the country is below current sea level</a>,
not counting any future sea level rise.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Measuring Housing Affordability]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability/"/>
    <updated>2016-09-14T12:06:06-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/assessment/split_map" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_price_2015.png" style="width:50%;float:right;margin-left:10px;"></a>
Housing affordability is a serious issue that deserves attention. Affordability is generally defined comparing incomes
to housing costs. And ideally also factoring in transportation cost, although that&rsquo;s seldom done and we will not attempt
today.</p>

<p>Recently we <a href="http://doodles.mountainmath.ca/blog/2016/08/31/incomes/">took a detailed look at income data</a>. Using what we
learned, together with our
<a href="https://mountainmath.ca/assessment/split_map">detailed data on the development of prices of single family properties in Vancouver</a>,
we turn to the never dying question of affordability of single family homes.</p>

<!-- more -->


<p><a href="https://mountainmath.ca/assessment/split_map?year=2010" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_price_2010.png" style="width:50%;float:left;margin-right:10px;"></a>
Let&rsquo;s go through the motions of how different choices in income data can lead to different stories. Some general choices of
what income to use is often pretty obvious. Others are more subtle and a matter of judgement. For simplicity we focus
entirely on the situation in 2010, because that&rsquo;s the last year we have detailed income data for the City of Vancouver
and we also have <a href="https://mountainmath.ca/assessment/split_map?year=2010">detailed publicly available single family housing price data</a>.</p>

<p>When talking about housing, the starting point is to look at income of (private) households (as opposed to individual income).
We may also want to consider the owner-renter split in the region we are interested in. For simplicity we will skip this.</p>

<h3>Household Income</h3>

<p>Households are as diverse as
dwelling types. If we write a story about single family housing, household income of all households is too broad to be
relevant. For example,
in the city of Vancouver there are about 75,500 single family lots, but 264,573 households. So at most 28% of households
can live in the main house on a single family lot. Taking the median household income makes no sense in this situation.
We need to narrow down the target group. In Calgary on the other hand,
59% of the dwelling stock is single detached (and there are more properties if we count the ones with suites like we
did for Vancouver), so in that case the assumption that the median household is looking to buy a single family home is
more reasonable. Although the median household probably won&rsquo;t be looking to buy the median single family home but a lower-priced one.</p>

<h3>Family Income</h3>

<p>So how should we measure the affordability of single family properties? That&rsquo;s not an easy question. A natural choice may
be to focus in on the 151,330 census families in Vancouver. Again, there are more than twice as many candidates as single
family properties. So maybe narrow it down even further an only look at the 88,515 census
families with children at home. Or the 63,790 couple families with children at home. Realistically speaking, even
going with couple families with children at home there just aren&rsquo;t enough single family properties to go around. Unless we
are willing to force out all of the roughly 45% of the occupants of the main house on single family lots that currently only have
1 or 2 people living in there. But overall, couple families with children is probably a better metric for affordability
for single family homes. Others will of course also buy single family homes, but maybe we will be less worried if
they can&rsquo;t afford one.</p>

<h3>Family with Children Income</h3>

<p>To complete the example, in 2010 the median single family property cost $848,000 (average $1,133,000) and the median
couple family with children income in private households was $92,068 (average $123,252).
That gives a dwelling value to income ratio of around 9.2, showing that the median single family property is not
affordable for the median couple family with children. By affordable we mean that with a 20% down payment the shelter
costs stay below 30% of pre-tax income, which requires a ratio of at most 6.6 assuming an interest rate of 3% and 25
years amortization.</p>

<p>If we were to more realistically assume that the median income couple family with children were to look to buy a single
family property priced at the 10 percentile level of $606,100 we get a dwelling value to income ratio of 6.6, barely
squeezing in below our affordability cutoff.</p>

<h3>Matching Income Quantiles with Housing Quantiles</h3>

<p>Another way to slice the data is to look at the household income distribution. By definition there are 37,750
single family homes more expensive than the median single family home. From the income distribution there are 44,215
households with income over $125,000. Taking $125,000 as our income we get a median dwelling value to income ratio of 6.8.
Only when throwing in some secondary suite rental income can we get to the
&lsquo;barely affordable&rsquo; 6.6 ratio. Adding rental income is double-dipping though, rental income should already be
included in our total income numbers. Assuming secondary suite rental income is correctly reported.</p>

<h3>Using Median Household Income</h3>

<p>Using the household income instead we would have gotten a ratio of 13.4, which is ridiculously unaffordable. But then
again, the notion that the median household should be able to purchase the median single family property
(or even a low-value single family property) is also ridiculous.</p>

<p><a href="https://censusmapper.ca/maps/37" target="_blank"><img  src="http://doodles.mountainmath.ca/images/local_affordability_index.png" style="width:50%;float:right;margin-left:10px;"></a>
Somewhat more reasonable is to <a href="https://censusmapper.ca/maps/37">compare household income to all housing</a>,
not just single family. This still ignores that
half of the population in Vancouver is renting, but still can yield some interesting insights if one is interested in
more detailed spatial distribution of affordability and compare it to other cities.</p>

<p>Adding a scatter plot of local affordability index by proportion of owner households shows how in Vancouver, unlike
in comparable cities, the percentage of owner households is a weak determinant of local affordability.</p>

<h3>What about Affordability Today?</h3>

<p>This analysis assumes that all these households are comfortable to max out when buying a home and that there are no other
competing significant financial obligations like heavy student loans. And, just as a reminder, we were looking at 2010.
As of 2015 the price of the median single family home has increased 67%. We don&rsquo;t have 2015 income numbers for the City of
Vancouver (yet), but Couple Family median income for Metro Vancouver has increased 13% between 2010 and 2014, the last
year with available data. Extrapolating out that trend to 2015, and assuming that whatever other income metrics we were
looking at, we get an estimated income increase by 16%. So any affordability ratio is about 1.4 times worse in 2015 compared
to the 2010 ratio. What may have been &lsquo;barely affordable&rsquo; in 2010 is clearly unaffordable in 2015.</p>

<p>So we used the detailed income data available for 2010 to get very good understanding of the affordability situation in 2010.
Then we used regional income trends to extrapolate that data to 2015 and matched it with 2015 housing data to get more up-to-date
estimates. This is generally an effective method that yields good results.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Quick Guide to Income Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/31/incomes/"/>
    <updated>2016-08-31T09:17:12-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/31/incomes</id>
    <content type="html"><![CDATA[<p>The news media has an extraordinarily difficult time with income data. And that&rsquo;s only partially the media&rsquo;s fault.
In general, income data is a funny beast. So I decided to give a quick overview over income data that&rsquo;s available through
Statistics Canada. To make things a little more concrete I focused on Vancouver as an example, but everything applies
equally well to any other area in Canada.</p>

<p>Most journalists I talked to care about accurate and relevant statements. If that&rsquo;s you, you will need to keep reading
and dive down the slightly wonkish income rabbit hole.</p>

<p>For those that don&rsquo;t really care, I made a
<em>quotable random income generator</em>. Just hit the &ldquo;generate&rdquo; button copy &amp; paste the result and link this post as source.
(Use at own risk!)</p>

<!-- more -->




<div class='income-generator'>
    <div class='income-choices'>
        <div class="geo"></div>
        <div class="med_av"></div>
        <div class="tax"></div>
        <div class="hh"></div>
        <div> income is </div>
        <div class="income"></div>
    </div>
    <a class="btn btn-default" style="background:orange;">Click to Generate Random Income Numbers</a>
</div>


<p>The income numbers don&rsquo;t fit the story? No problem, just play again until you get something you like!</p>

<h3>Geographic Regions</h3>

<p>The first thing to do when quoting income numbers of any sort is to decide what region to use. Seems straight forward
enough, but in reality <a href="https://twitter.com/vb_jens/status/744407354867736576">hardly ever done</a>. In the Vancouver
context, it simply comes down to deciding if one wants to
report on income for the City of Vancouver or Metro Vancouver. Both are frequently referred to as just &ldquo;Vancouver&rdquo;. Which
is just fine as long as it is clear from the context which region we are talking about. And more importantly, whatever
the income is compared to (e.g. housing price data) are taken for the same region.</p>

<h3>Base Demographics</h3>

<p>Next we have to choose a base demographic we are interested in, choose which income distribution is relevant for our context.
In some cases this choice is obvious. If we are writing a story on lone parents in the City of Vancouver, we would want
to look at the income distribution of lone parent households. If we are looking at the development of wages, we should
consider individual incomes. For a story on consumer spending we may want to look at after-tax income.</p>

<p>We may also be interested in specific type of income, for example only in investment income. Or the net capital gains
and losses. Or pension benefits. Or self-employment income.</p>

<h3>Statistic</h3>

<p>Often we would like to distill everything down to a single number. Typically we would choose the average or median
income from the distribution we are interested in, but we may also choose other statistics, for example the top quintile.
Which one we choose really depends on the story. As a rule of thumb, choose median incomes if you are interested in the
&lsquo;typical&rsquo; person or household. Choose average income if you are interested in the questions relating to the total amount
of money earned in a given area. Income quantiles are great to focus in on certain subgroups of the population.</p>

<h3>Availability</h3>

<p>Generally we also have to consider the availability of information. The census has very detailed income data in their
standard release that allow us to be very specific about what kind of incomes we are interested in. And if that&rsquo;s not
enough we can make a special request to StatsCan to narrow the incomes down to a group we are interested in, for example incomes
of renter households as was done in the <a href="http://rentalhousingindex.ca">rental housing index</a>.</p>

<p>Annual income data is available from CANSIM (Statistics Canada&rsquo;s socioeconomic database), but the geography is coarser
than in the census. Generally we can only
expect to get annual data for the whole country, provinces, census metropolitan areas, but not census
subdivisions (municipalities) or finer geographies.</p>

<h3>Sources and Comparability</h3>

<p>All income data eventually come down to CRA taxfiler data. But the devil is in the details. For the 2006 and 2011
censuses, there was a mixture between self-reporting and cross-referencing of individual level income data with CRA data.
And even self-reported data would again undergo quality control and get somewhat adjusted according to CRA data.</p>

<p>But there are important differences in the data, both on what kind of income is included and also what people are included.</p>

<p>The details are endless, many of them won&rsquo;t matter. Here are a couple to look out for:</p>

<ul>
<li>CANSIM is a comprehensive sample, census data is roughly a 1 in 5 subsample which may lead to sampling bias especially
in small geographies.</li>
<li>CENSUS data is sensitive to non-return bias. Not just no-return bias introduced by the NHS, but also by census undercounts
which, for example, were in the 10% range for the 25 to 29 year old demographic in both the 2006 and 2011 censuses.</li>
<li>CANSIM and the Census have different denominators for reporting average or median incomes. CANSIM reports on all
T1 taxfilers, as well as various family types. Some data can be broken out into age groups at
the 15 and 65 year cutoffs,
whereas Census reports only on people (15 or older) (or families or households) in &ldquo;private households&rdquo; with income greater
than zero.</li>
<li>the definition of &ldquo;private household&rdquo; changed between 2006 and 2011 censuses.</li>
<li>2011 and 2006 censuses differ slightly in what is included as income, for example
<a href="http://www12.statcan.gc.ca/census-recensement/2006/ref/dict/pop123-eng.cfm">2006 included RRSP withdrawls</a>,
<a href="https://www12.statcan.gc.ca/nhs-enm/2011/ref/dict/pop123-eng.cfm">2011 didn&rsquo;t</a> (both include pensions and RRIFs).
2011 includes net capital gains and losses as a percentage of total income in a separate category, 2006 did not
include any information on capital gains.</li>
</ul>


<p>So even when comparing CANSIM income data to census income data for the appropriate year we should expect some differences.
Or comparing 2006 to 2011 income, even if hypothetically an area had identical tax returns, we would still see differences.
Generally speaking, CANSIM average and median income estimates are lower than census estimates as it includes a larger pool
of people that are likely to have lower income.</p>

<h3>Where to get the goods?</h3>

<p><img  src="http://doodles.mountainmath.ca/images/yvr_income.png" style="width:50%;float:right;margin-left:10px;">
The latest census income numbers are available via <a href="https://www12.statcan.gc.ca/nhs-enm/2011/dp-pd/prof/index.cfm">Statistics Canada</a>.
I am biased and prefer the <a href="https://censusmapper.ca/maps/467">CensusMapper</a> interface. For 2011 data, choose any
2011 CensusMapper map, select the geographic
region you are interested in and press the &ldquo;more&rdquo; button on the popup to bring up the &ldquo;census wheel&rdquo;. Then drill into the
&ldquo;income&rdquo; section, the last NHS variable in the widget.</p>

<p>CANSIM has annual data based on taxfiler information for coarser geographies. So you won&rsquo;t be able to get data for the City of Vancouver
or neighbourhoods within the city like with census data, but you can get data for Metro Vancouver. And you can get it for
more recent years. Things get complex very fast there are
<a href="http://www5.statcan.gc.ca/cansim/a33?themeID=3868&amp;spMode=tables&amp;chunkSize=213">213 CANSIM tables with income data</a></p>

<p>At CensusMapper we are still firmly planning integrate CANSIM data into the CensusMapper interface, but their API refresh got pushed back
to sometime 2018 and we can&rsquo;t justify the extra resources to integrate CANSIM data temporarily using the old API just
to switch it over a year later.</p>

<h3>Too Abstract?</h3>

<p>Want to see how this works on an example? Just read the
<a href="http://doodles.mountainmath.ca/blog/2016/09/14/measuring-housing-affordability/">next post on using income data for housing affordability</a>.</p>

<script>
var geoData=['City of Vancouver','Metro Vancouver'];
var med_avData=['median','average'];
var taxData=['pre-tax','after-tax'];
var hhData=['individual','household','family','family with children'];
$('.income-generator .btn').on('click',function(e){
     $('.income-generator').addClass('active');
     $('.income-choices .geo').text(geoData[Math.round(Math.random())]);
     $('.income-choices .med_av').text(med_avData[Math.round(Math.random())]);
     $('.income-choices .tax').text(taxData[Math.round(Math.random())]);
     $('.income-choices .hh').text(hhData[Math.round(3.9999*Math.random()-0.5)]);
     $('.income-choices .income').text('$' + Math.round(80*Math.random()+40)+',000');
});
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mobi Running Stats]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/24/mobi-running-stats/"/>
    <updated>2016-08-24T09:45:54-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/24/mobi-running-stats</id>
    <content type="html"><![CDATA[<p><a href="http://mountainmath.ca/mobi#14.287582005629245/49.2742/-123.1277" target="_blank"><img  src="http://doodles.mountainmath.ca/images/mobi_main2.png"  style="width:50%;float:right;margin-left:10px;"></a>
I keep getting questions about Mobi stats these days. Rather than ansering them one by one I decided to just offer a live
view into data generated by our shadow API. I made two simple views, the most recent month of daily bike checkout counts
and the most recent week of hourly bike checkout counts. The data issues mentioned in our
<a href="http://doodles.mountainmath.ca/blog/2016/08/16/mobi-a-first-look/">previous post</a> still apply. For data geeks, here is a link to a
<a href="https://twitter.com/serialc/status/767096443165376512">very useful paper</a> that compared estimates like I make to real
usage data.</p>

<!-- more -->


<p>Apart from the usual caveats when dealing with scraped data, Mobi data comes with additional issues like duplicate stations
that need to be filtered out to get proper counts. The view into the database below filters out these and other current
known issues with Mobi data. But as this is a live view, it might not correctly deal with future unforseen issues with
Mobi data. New stations, once Mobi adds them, will automatically show up on our Mobi map and will also be counted in the
live usage graphs.</p>

<h3>Daily Usage</h3>

<p>This graphs shows the daily total counts of bikes checked out (with the usual data quality caveats) for the past month
(starting from August 12, 2016).</p>

<div style="margin:5px  0 20px 0;padding:2px;border: 1px solid black;border-radius:5px;width:100%;">
  <div id="graph_daily" style="height:200px;" data-url="https://mountainmath.ca/bike_providers/1/daily.json"></div>
</div>


<h3>Hourly Usage</h3>

<p>This graphs shows the hourly total counts of bikes checked out (with the usual data quality caveats) for the past week.</p>

<div style="margin:5px  0 20px 0;padding:2px;border: 1px solid black;border-radius:5px;width:100%;">
  <div id="graph_hourly" style="height:200px;" data-url="https://mountainmath.ca/bike_providers/1/hourly.json"></div>
</div>


<h3>Auto Updating</h3>

<p>The above graphs are dynamic, they display the latest available numbers. Feel free do come back to this page to check
how usage develops over time. If you come back in one hour, it will have the latest hourly counts. If you come back
tomorrow, it will have an additional day of data.</p>

<h3>Map Update</h3>

<p>We also thought that adding a little more context to the <a href="http://mountainmath.ca/mobi">bike share map</a> would be useful,
so we added some gentle colouring to highlight parks, retail and institutional land uses.</p>

<p>The bike infrastructure
(and land use) data comes straight from OpenStreetMap. Everyone is
welcome to help update OpenStreetMap data. If you are on a desktop and shift-click into our map it will bring up the
OpenStreetMap editor. There you can add the newest separated bike lane or make other changes (after logging in or signing
up for an account). It will take between 1 to 5 hours for changes to go live on our map, and the changes you make will
also be available to any other app relying on OpenStreetMap data.</p>

<div><script>

function graphBikeStation(selector,station_id){
  var outerHeight=$(selector).height(),
      outerWidth=$($(selector)[0].parentNode).width();
  var margin = {top: 20, right: 20, bottom: 30, left: 50},
      width = outerWidth - margin.left - margin.right,
      height = outerHeight - margin.top - margin.bottom;

  var formatDate = d3.time.format("%X");
  var x = d3.time.scale()
      .range([0, width]);

  var y = d3.scale.linear()
      .range([height, 0]);

  var xAxis = d3.svg.axis().scale(x).orient('bottom');

  var yAxis = d3.svg.axis().scale(y).orient('left').ticks(5);

  var line = d3.svg.line()
      .x(function(d) { return x(d.created_at); })
      .y(function(d) { return y(d.available_bikes); })
      .interpolate('step-after');
  var bikeArea = d3.svg.area()
      .x(function(d, i) { return x(d.created_at); })
      .y0(function(d) { return y(d.available_bikes); })
      .y1(function(d) { return height; })
      .interpolate('step-after');
  var dockArea = d3.svg.area()
      .x(function(d, i) { return x(d.created_at); })
      .y0(function(d) { return 0; })
      .y1(function(d) { return y(d.available_bikes); })
      .interpolate('step-after');


  var svg = d3.select(selector).append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  d3.json('http://mountainmath.ca/bike_providers/1/bike_stations/' + station_id + '.json?days=7',function(error,data){
  data=data[0].stations[0].statuses;
  data.forEach(function(d){type(d)});
  var last=data[data.length-1];
  var lastTime=new Date(d3.time.format.iso.parse(last.updated_at).getTime() + 5*60000);
  data.push({id:last.id,available_bikes:last.available_bikes,free_docks:last.free_docks,created_at:lastTime,updated_at:lastTime});

  x.domain(d3.extent(data, function(d) { return d.created_at; }));
  y.domain([0,data[0].available_bikes+data[0].free_docks]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//      .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Available Bikes");

  svg.append("path")
      .datum(data)
      .attr("class", "area bike")
      .style("fill",'rgba(33, 139, 51, 0.7)')
      .attr("d", bikeArea);
  svg.append("path")
      .datum(data)
      .attr("class", "area dock")
      .style("fill",'rgba(212, 10, 44, 0.7')
      .attr("d", dockArea);


  function type(d) {
    d.created_at = d3.time.format.iso.parse(d.created_at);
    d.available_bikes = +d.available_bikes;
    return d;
  }
  });
}



function bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter,rangeLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d");
    if (!rangeLabelFormatter) rangeLabelFormatter=rangeFormatter;
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;

d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  
  //data.forEach(function(d,i){d.date= d3.time.format.iso.parse(d.date)});
  
  var container=d3.select(div.node().parentNode);
  container.selectAll('.legend.no-margin').remove();
  var legend=container.append('div').attr('class',"legend no-margin");
  legend.append('p').html('<i style="background:'+graphData.color + '"></i>' + graphData.label +  '<span style="float:right;margin-right:10px;" id="' + graphData.class+'_value"></span>');
  
  x.domain(data.map(function(d) {return d.date }));
  y.domain([0, d3.max(data, function(d) { return d.count; })]);
  
  var domainTickValues=[];
  var skip=Math.round(60/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  //if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  -x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", graphData.class + " bar")
      .style("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.count); })
      .attr("height", function(d) { return height - y(d.count); })
      .on('mouseover',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('click',function(d){
       d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('touch',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('mouseout',function(){d3.select('#'+this.classList[0]+'_value').text('')});

      
});

}



var numberFormatter=d3.format(",");
var dateFormatter=function(d){return d};//d3.time.format("%a %I%p");//d3.time.format("%a %H:%M"); //d3.format(",");//
bar_graph(d3.select("#graph_daily"),false,dateFormatter,numberFormatter);
bar_graph(d3.select("#graph_hourly"),false,dateFormatter,numberFormatter);

graphBikeStation('#station_graph_os',1);
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mobi -- a First Look]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/16/mobi-a-first-look/"/>
    <updated>2016-08-16T13:06:58-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/16/mobi-a-first-look</id>
    <content type="html"><![CDATA[<p><a href="http://mountainmath.ca/mobi#14.287582005629245/49.2742/-123.1277" target="_blank"><img  src="http://doodles.mountainmath.ca/images/mobi_main.png"  style="width:50%;float:right;margin-left:10px;"></a>
Vancouver finally has a bikeshare system. And everyone is hoping it will succeed, despite the obstacles BC&rsquo;s mandatory
helmet law poses for the system. So we are eager to find out how things are going with Mobi.</p>

<p>To set the background, consider that
<a href="http://www.seattlemet.com/articles/2016/3/21/the-rise-and-fall-and-possible-rise-again-of-pronto">Seattle&rsquo;s Pronto is getting less than 1 ride per bike per day</a>
after half a year in operation. In comparison, bike shares that are considered &lsquo;successful&rsquo; in North America get 3 to 5
rides per bike per day. Taipei&rsquo;s system, which I am particularly fond of, gets over 11 rides per bike per day.</p>

<p>So how about Mobi? It barely started, and it&rsquo;s not really fair to run the numbers right now. But we just couldn&rsquo;t hold
our curiosity back.</p>

<!-- more -->


<h3>Data</h3>

<p>First off, some caveats. Mobi does not have an official API for their system. In fact, they only provide a barely usable
<a href="https://www.mobibikes.ca">map of station statuses at the bottom of their landing page</a>. So we decided to
jump in and scrape their data to <a href="http://doodles.mountainmath.ca/blog/2016/07/26/bike-share-map/">make our own map</a>. In
absence of better alternatives, the <em>official</em> Mobi smartphone app is still not released, the map has gotten quite popular.
And in absence of an official Mobi API there are now others, like <a href="http://transitapp.com/">TransitApp</a>, that are consuming our
<a href="http://mountainmath.ca/mobi/stations">station data shadow API</a>.</p>

<p>What that means in terms of data quality is that while we get fairly accurate station bike counts at about a 1-minute
interval, there are some issues with using the data for rigorous analysis. If a bike gets checked in while another one
gets checked out at about the same time there is a good chance that we will miss it. And we can&rsquo;t distinguish rebalancing
from a group of people checking out or dropping off a bunch of bikes at the same time. And we don&rsquo;t have individual bike
data to look at travel patterns, for example what popular trip patterns are. Moreover we currently don&rsquo;t collect and store
weather data, an important variable that should be included in any bike share analysis.</p>

<p>That pretty much rules out anything but high level analysis.</p>

<h3>Station History</h3>

<p>To get an initial idea we started to look at station history. We only started recording Saturday 13th. For the fun of it
we added one day history to our <a href="https://mountainmath.ca/mobi">Mobi bike station and bike infrastructure map</a>. Drop me
a line if you are interested in longer timeframes.</p>

<p>Taking a look at the daily overall usage patterns</p>

<div style="padding:2px;border: 1px solid black;border-radius:5px;">
<div id="graph_mobi_hourly" style="height:200px;max-width:640px;" data-url="/data/mobi_hourly.json"></div>
</div>


<p>things are pretty much as expected. Nice Gaussians for the weekend usage, and some commute spikes for the weekday usage.
Squinting really hard one might want to make out a slight lunchtime boost, we will have to collect more data to confirm
that.</p>

<p>Another thing we see is that usage seems to hit a low point around 4am, so that&rsquo;s a good time to divide up the days when
looking at daily usage. Adding up the rides we get around 1400 rides a day. At around 3am we detect 490 bikes in the
stations, so that makes about 3 rides per bike per day. On average. That a pretty impressive number for a system that is
just getting off the ground. And that&rsquo;s while still in &ldquo;members only&rdquo; mode. The nice weather has helped, but there is no
getting around the fact that Mobi is off to a great start!</p>

<p>Of course not every bike is getting 3 rides. Some get more, some get less. For example, a bike parked at the
<a href="http://mountainmath.ca/mobi#17/49.27147/-123.10407">Ontario &amp; Seawall</a> station has been very popular, here is live data
on the most recent days of usage.
 <div id="station_graph_os" style="height:150px;"></div></p>

<p><a href="http://mountainmath.ca/mobi#19/49.26084/-123.11418" target="_blank"><img  src="http://doodles.mountainmath.ca/images/yukon_12.png"  style="width:50%;float:right;margin-left:10px;"></a>
On the other hand, bikes at <a href="http://mountainmath.ca/mobi#19/49.26084/-123.11418">Yukon &amp; 12th</a> have been having a hard
time to find riders. Both stations are at the
current boundary of the system, it is hard to say what makes the difference. The particular location of the least used
station is sure to get some people talking.</p>

<p>Mobi is undoubtedly carefully
analyzing their station usage and incorporating that into their strategic planning how to expand their network. And
hopefully publish a useful API for all the data geeks out there.</p>

<div><script>

function graphBikeStation(selector,station_id){
  var outerHeight=$(selector).height(),
      outerWidth=$($(selector)[0].parentNode).width();
  var margin = {top: 20, right: 20, bottom: 30, left: 50},
      width = outerWidth - margin.left - margin.right,
      height = outerHeight - margin.top - margin.bottom;

  var formatDate = d3.time.format("%X");
  var x = d3.time.scale()
      .range([0, width]);

  var y = d3.scale.linear()
      .range([height, 0]);

  var xAxis = d3.svg.axis().scale(x).orient('bottom');

  var yAxis = d3.svg.axis().scale(y).orient('left').ticks(5);

  var line = d3.svg.line()
      .x(function(d) { return x(d.created_at); })
      .y(function(d) { return y(d.available_bikes); })
      .interpolate('step-after');
  var bikeArea = d3.svg.area()
      .x(function(d, i) { return x(d.created_at); })
      .y0(function(d) { return y(d.available_bikes); })
      .y1(function(d) { return height; })
      .interpolate('step-after');
  var dockArea = d3.svg.area()
      .x(function(d, i) { return x(d.created_at); })
      .y0(function(d) { return 0; })
      .y1(function(d) { return y(d.available_bikes); })
      .interpolate('step-after');


  var svg = d3.select(selector).append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
  d3.json('http://mountainmath.ca/bike_providers/1/bike_stations/' + station_id + '.json?days=7',function(error,data){
  data=data[0].stations[0].statuses;
  data.forEach(function(d){type(d)});
  var last=data[data.length-1];
  var lastTime=new Date(d3.time.format.iso.parse(last.updated_at).getTime() + 5*60000);
  data.push({id:last.id,available_bikes:last.available_bikes,free_docks:last.free_docks,created_at:lastTime,updated_at:lastTime});

  x.domain(d3.extent(data, function(d) { return d.created_at; }));
  y.domain([0,data[0].available_bikes+data[0].free_docks]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//      .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Available Bikes");

  svg.append("path")
      .datum(data)
      .attr("class", "area bike")
      .style("fill",'rgba(33, 139, 51, 0.7)')
      .attr("d", bikeArea);
  svg.append("path")
      .datum(data)
      .attr("class", "area dock")
      .style("fill",'rgba(212, 10, 44, 0.7')
      .attr("d", dockArea);


  function type(d) {
    d.created_at = d3.time.format.iso.parse(d.created_at);
    d.available_bikes = +d.available_bikes;
    return d;
  }
  });
}



function bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter,rangeLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d");
    if (!rangeLabelFormatter) rangeLabelFormatter=rangeFormatter;
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;

d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  
  data.forEach(function(d,i){d.date= d3.time.format.iso.parse(d.date)});
  
  var container=d3.select(div.node().parentNode);
  container.selectAll('.legend.no-margin').remove();
  var legend=container.append('div').attr('class',"legend no-margin");
  legend.append('p').html('<i style="background:'+graphData.color + '"></i>' + graphData.label +  '<span style="float:right;margin-right:10px;" id="' + graphData.class+'_value"></span>');
  
  x.domain(data.map(function(d) {return d.date }));
  y.domain([0, d3.max(data, function(d) { return d.count; })]);
  
  var domainTickValues=[];
  var skip=Math.round(60/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  //if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  -x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", graphData.class + " bar")
      .style("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.count); })
      .attr("height", function(d) { return height - y(d.count); })
      .on('mouseover',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('click',function(d){
       d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('touch',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('mouseout',function(){d3.select('#'+this.classList[0]+'_value').text('')});

      
});

}



var numberFormatter=d3.format(",");
var dateFormatter=d3.time.format("%a %I%p");//d3.time.format("%a %H:%M"); //d3.format(",");//
bar_graph(d3.select("#graph_mobi_hourly"),true,dateFormatter,numberFormatter);

graphBikeStation('#station_graph_os',1);
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What's up with RT?]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/08/04/rt/"/>
    <updated>2016-08-04T13:18:51-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/08/04/rt</id>
    <content type="html"><![CDATA[<p>RT is Vancouver&rsquo;s zoning for duplexes. Over time, various areas have been zoned to allow duplexes. Examples are
Kits Point, much of Point Grey Road reaching up to Broadway, much of Granview-Woodlands, parts of Mount Pleasant and many
other areas.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=4&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt_teardowns.png" style="width:50%;float:right;margin-left:10px;"></a>
Recently I have had some interesting conversations <a href="https://twitter.com/fixbced/status/748196970783637504">on Twitter regarding RM-6</a>
and over BBQ dinner about RT-7. Then the
<a href="http://vancouver.ca/home-property-development/grandview-woodland-community-plan.aspx">Granview-Woodland plan</a>
passed by council, and it contains a curious provision of reducing the outright FSR for the
RT-zoned properties from 0.6 to 0.5.</p>

<p>All of which got me thinking. What is RT supposed to accomplish, how does the diverse RT-zoning rules influence development
and how is RT overall performing?</p>

<!-- more -->


<p>To make things complicated many RT zoning rules contain provisions to allow for higher FSR, and more than two units,
under the &ldquo;heritage preservation&rdquo; program. Most people like the multi-plex developments that come out of this process,
but the road there is quite adurous. Permitting takes a long time and is marred by uncertainty. Those projects are
done by small developers, that are ill-equipped to deal with risky and drawn-out rezoning processes.</p>

<p>These would be great projects carried out by small developers that lead to gentle and affordable density,
as this kind of re-development does not require land-assembly and does not lead
to crazy land-value lifts that require CACs to claw back some of that value rise
<a href="http://doodles.mountainmath.ca/blog/2016/04/01/on-dirt-and-houses/">as we explained before</a>.</p>

<p>We have some ideas what a refreshed RT (and RS) should look like, and there are
<a href="https://pricetags.wordpress.com/2016/07/29/open-letter-on-the-downzoning-of-grandview-woodland-rt/">some efforts to push for changes</a>.
We leave the details of this to the experts and take a little field expedition to
see how the different flavours of RT (and RM) perform in data.</p>

<h3>Why RT?</h3>

<p>One central question to ask is: What is the purpose of RT (or any) zoning? The initial idea was to allow higher density
than RS, with two stratified properties on one lot. But since the creation of RT the RS zoning has undergone significant
changes and allows, in many cases, for higher FSR and higher unit count, although not stratified. In much of RS three
units are allowed on each lot, the main house, a secondary suite and a laneway house.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&zoom=13&lat=49.245&lng=-123.1166&layer=5&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rs_rt_land.png" style="width:50%;float:left;margin-right:10px;"></a>
So how does RT perform in the wild? There seems to be little effect RT vs RS zoning has on land values. The
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=6&amp;mapBase=2">boundaries between RS and RT</a>
can&rsquo;t be discerned from a
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT_RS_FSD,residential]&amp;zoom=13&amp;lat=49.245&amp;lng=-123.1166&amp;layer=5&amp;mapBase=2">land value map of all residential properties in RS, RT (and First Shaugnessey) zones</a>.</p>

<p>How good are RT lots at realizing &ldquo;zone capacity&rdquo;, that is how many of the historically SFH get turned over into duplexes,
or in some cases multi-plexes (through the heritage presercation program)?
That depends as the following graph shows.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_sfh" style="height:200px;max-width:640px;" data-url="/data/zone_sfh.json"></div>
</div>


<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/types_rt.png" style="width:50%;float:left;margin-right:10px;"></a>
We can also study this by mapping out
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">all residential lots in RT zones</a>,
and color them depending if they are single family lots, duplexes or multi-plexes.</p>

<p>Some RT areas are essentially indistinguishable from RS areas, they are almost entirely comprised of single family lots.
A good example is the
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-4,residential]&amp;zoom=14&amp;lat=49.2733&amp;lng=-123.0646&amp;layer=20&amp;mapBase=2">RT-4, most of which is in Grandview-Woodlands</a>.
And being in RT rathern than RS they often don&rsquo;t even get the benefits of a laneway house. Coach houses, which are legal
in many RT areas and could be stratified, come with such onerous side setbacks that they are very hard to build on
regular lots.</p>

<p>There is a lot of untapped &ldquo;zoned capacity&rdquo;. Similarly, some of the
newer RM zones show little appetite for realizing &ldquo;zoned capacity&rdquo;, possibly due to the added difficulty of having to
assemble lots to do so.</p>

<p>One can argue about whether this is good or bad. Or one can look at the variation between the different types of RT and RM
zones to see what causes the difference.</p>

<h3>Downzoning</h3>

<p>To understand how downzoning works we want to consider two different types on analysis. One is to look at what happened
after RS zone was changed to reduce site coverage in the 1980 in response to concerns about &lsquo;monster homes&rsquo;. We ran
an analysis using LIDAR data to understand the effect on the physical form of SFH and found that while site coverage
indeed decreased sharply, the <a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">bulk of the building remained unchanged</a>.
and the rule change seems to have done little in easing concerns about &lsquo;monster homes&rsquo;, it simply changed some of the
parameters determining what &lsquo;monster homes&rsquo; look like.</p>

<p>Another way to look at the matter is to compare how re-development happened in difference zones. This is very hard, since
there are many factors other than zoning that determine if a building gets re-developed. To get some idea we compiled two
numbers for each of the RS, RT and RM zones (ignoring some of the delicacies in the zoning code and lumping together all
sub-zones with the same leading number. So for example we lumped RT-4, RT-4A, RT-4N and RT-4AN into one category we simply
label &ldquo;RT-4&rdquo;.</p>

<p>First we check how many residential properties got re-developed since 2000.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_redevelopment" style="height:200px;max-width:640px;" data-url="/data/zone_redevelopment.json"></div>
</div>


<p>Next we take a look what percentage of the existing residential stock is in immediate danger of being torn down, using the
<a href="http://doodles.mountainmath.ca/blog/2016/01/18/redevelopment/">methodology developed earlier</a>.</p>

<div style="margin:10px 50px;padding:5px;border: 1px solid black;border-radius:5px;">
<div id="graph_teardown" style="height:200px;max-width:640px;" data-url="/data/zone_teardowns.json"></div>
</div>


<p>While there is some correspondence between re-development activity and ratio of teardowns, there are a number of notable
exceptions. RT-1 and RM-9 stand out, but these are
<a href="https://mountainmath.ca/map/assessment?filter=[zoneE_RM-9_RT-1]&amp;zoom=14&amp;lat=49.2146&amp;lng=-123.1282&amp;layer=5&amp;mapBase=2">oddball cases with just a few properties</a>.</p>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&zoom=13&lat=49.2581&lng=-123.1166&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/new_types_rt.png" style="width:50%;float:right;margin-left:10px;"></a>
We can also map just <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT,years_2000]&amp;zoom=13&amp;lat=49.2581&amp;lng=-123.1166&amp;layer=20&amp;mapBase=2">residential properties in RT that were re-developed since 2000</a>
and colour them by SFH, Duplex and Multi-plex status. We can clearly see how some RT areas, like RT-7, don&rsquo;t see much
re-development, others, like RT-6 see mostly multi-plexes being developed. Some zones, like RT-10, 11, 12 are too new
to be judged on development happening since 2000. For example, zooming in on
<a href="http://mountainmath.ca/map/assessment?filter=[zone_RT-10,residential,years_2009]&amp;zoom=15&amp;lat=49.2485&amp;lng=-123.0734&amp;layer=20&amp;mapBase=2">developments in RT-10 since 2009 paints a very different picture</a>.</p>

<p>There is lots of stuff to explore, but for today I want to look at RT-7 and RT-6 in more detail.</p>

<h4>RT-7</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&zoom=15&lat=49.2617&lng=-123.1654&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-7.png" style="width:50%;float:left;margin-right:10px;"></a>
A much more interesting case is RT-7, with 35% of properties teardowns but only 4.1% of properties re-developed since 2000.
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=4&amp;mapBase=2">Looking at the map</a>
we see that RT-7 is comprised of two pockets on the west side, and the teardown candidates stand out in red and orange.
Filtering further to see what
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-7,residential,years_2000]&amp;zoom=15&amp;lat=49.2617&amp;lng=-123.1654&amp;layer=20&amp;mapBase=2">has been re-developed since 2000</a>
we see that, considering the size of the two pockets, re-development favours the eastern pocket near 16th and Arbutus. We
can clearly see that that the eastern pocket has an overall more valuable building stock, although it is not clear if that
is due to higher rates of re-development or for other reasons, for example the presence of some slightly larger lots. We
also note that re-development does produce duplex units and even some multi-plex.</p>

<p>So what is going on here? Looking at the <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-7.pdf">RT-7 zoning</a> we
see that the area has been downzoned to 0.4 FSR as was rencently pointed out to me, which can conditionally be upzoned
to 0.6 FSR. Additionally, there are caps on the number of units per hectar to further restrict density.</p>

<h4>RT-6</h4>

<p><a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&zoom=16&lat=49.2606&lng=-123.1097&layer=20&mapBase=2" target="_blank"><img  src="http://doodles.mountainmath.ca/images/rt-6.png" style="width:50%;float:right;margin-left:10px;"></a>
Another interesting example is RT-6. RT-6 has seen modest levels of re-develpment and has a <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2606&amp;lng=-123.1097&amp;layer=4&amp;mapBase=2">relatively healthy building
stock</a>.
What&rsquo;s even more interesting is that it contains
<a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">many multi-plexes</a>.
And more importantly, <a href="https://mountainmath.ca/map/assessment?filter=[zone_RT-6,residential,years_2000]&amp;zoom=16&amp;lat=49.2597&amp;lng=-123.1101&amp;layer=20&amp;mapBase=2">developments since 2000 have mostly produced multi-plexes</a>.</p>

<p>Prime examples of the <em>gentle density</em> that we keep hearing about. I would say that something is working very well here.</p>

<p>So what&rsquo;s the difference? In contrast to RT-7 <a href="http://former.vancouver.ca/commsvcs/BYLAWS/zoning/rt-6.pdf">RT-6 zoning</a> allows for 0.6 FSR
outright, conditionally increased to 0.75. But there are other important differences too. The RT-7 lots are typically
smaller with many at about 340m&sup2; compared to the 580m&sup2; typical RT-6 lots.
(Although RT-7 also contains some 580m&sup2; lots).</p>

<h3>Conclusion</h3>

<p>Does downzoning work? It depends what the goal is. Looking at the RT-7 example, downzoning has slowed re-development compared
to other areas in the city, but it also lead to a deterioration in building stock in RT-7. This is a stop-gap measure,
eventually that lower value building stock will get re-developed.</p>

<p>The combination of larger lots and the heritage retention program in the RT-6 zoning seems to work in producing
gentle density, except that the permitting process takes too long and it is not immediately clear what purpose the
heritage preservation has that allows stripping the building down to the studs and possibly moving it to the front and
then building an infill in the back. There must be a better way to deal with concerns behind
heritage preservation (not much is &ldquo;preserved&rdquo; in this process) and at the same time cut down on the time it
takes to jump through all the permit hoops involved.</p>

<p>It is clear that RS and RT (and RM) zoning would hugely profit from a clearer vision what these zonings should accomplish
and by using data to benchmark how these targets are met.</p>

<div><script>

function bar_graph(div,shiftAxis,domainFormatter,rangeFormatter,domainLabelFormatter,rangeLabelFormatter){
    if (!domainFormatter) domainFormatter=d3.format("d");
    if (!rangeLabelFormatter) rangeLabelFormatter=rangeFormatter;
    if (!rangeFormatter)
     rangeFormatter = function (y) {
        return y;
     };
     if (!domainLabelFormatter) domainLabelFormatter=domainFormatter;

var margin = {top: 20, right: 20, bottom: 40, left: 70},
    width = parseInt(div.style("width")) - margin.left - margin.right,
    height = parseInt(div.style("height")) - margin.top - margin.bottom;

var x = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

var y = d3.scale.linear()
    .range([height, 0]);


var xAxis = d3.svg.axis()
    .scale(x)
    .tickFormat(domainFormatter)
    .orient("bottom");


var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(rangeFormatter)
    .ticks(5, rangeFormatter);

var svg = div.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data_url=div[0][0].dataset.url;

d3.json(data_url, function(error, json) {
  if (error) throw error;
  var graphData=json[0];
  var data=graphData.data;
  
  var container=d3.select(div.node().parentNode);
  container.selectAll('.legend.no-margin').remove();
  var legend=container.append('div').attr('class',"legend no-margin");
  legend.append('p').html('<i style="background:'+graphData.color + '"></i>' + graphData.label +  '<span style="float:right;margin-right:10px;" id="' + graphData.class+'_value"></span>');
  
  x.domain(data.map(function(d) { return d.date }));
  y.domain([0, d3.max(data, function(d) { return d.count; })]);
  
  var domainTickValues=[];
  var skip=Math.round(40/x.rangeBand());
  if (skip<=0) skip=1;
  for (var i=0;i<x.domain().length;i++) {
    if (i % skip==0) domainTickValues.push(x.domain()[i]);
  }
  if (x.domain().length % 5 !=0) domainTickValues.push(x.domain()[x.domain().length-1]);
  xAxis.tickValues(domainTickValues);

  var xShift=shiftAxis ?  x.rangeBand()/2.0 * 1.1 : 0;
  
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(" + xShift + "," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);
//    .append("text")
//      .attr("transform", "rotate(-90)")
//      .attr("y", 6)
//      .attr("dy", ".71em")
//      .style("text-anchor", "end")
//      .text("Probability");

  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", graphData.class + " bar")
      .style("fill", graphData.color)
      .attr("x", function(d) { return x(d.date); })
      .attr("width", x.rangeBand())
      .attr("y", function(d) { return y(d.count); })
      .attr("height", function(d) { return height - y(d.count); })
      .on('mouseover',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('click',function(d){
       d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('touch',function(d){
         d3.select('#'+this.classList[0]+'_value').text(domainLabelFormatter(d.date) + ': ' + rangeLabelFormatter(d.count)) 
      }).on('mouseout',function(){d3.select('#'+this.classList[0]+'_value').text('')});

      
});

}



var percentageFormatter=d3.format(".1%");
var textFormatter=function(d){return d};
var teardownLabelFormatter=function(d){return percentageFormatter(d) + " teardowns"};
var sfhLabelFormatter=function(d){return percentageFormatter(d) + " SFH"};
var redeveopmentLabelFormatter=function(d){return percentageFormatter(d) + " built since 2000"};
bar_graph(d3.select("#graph_redevelopment"),false,textFormatter,percentageFormatter,textFormatter,redeveopmentLabelFormatter);
bar_graph(d3.select("#graph_teardown"),false,textFormatter,percentageFormatter,textFormatter,teardownLabelFormatter);
bar_graph(d3.select("#graph_sfh"),false,textFormatter,percentageFormatter,textFormatter,sfhLabelFormatter);
</script></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bike Share Map]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/07/26/bike-share-map/"/>
    <updated>2016-07-26T15:12:06-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/07/26/bike-share-map</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/mobi" target="_blank"><img  src="http://doodles.mountainmath.ca/images/bike-share-image-large.png"  style="width:50%;float:right;margin-left:10px;"></a>
It is no secret that we at MountainMath like bikes. And maps. And open data and sharing. We guess you know where
this is going.</p>

<p>Vancouver has finally gotten a bike share system, and we are loving it. So we took the occasion to take our
<a href="http://doodles.mountainmath.ca/blog/2016/05/16/my-global-bike-map/">old bike infrastructure maps</a>, polished them up a
bit using <a href="https://mapzen.com/blog/targeted-editing-cycleways/">Mapzen&rsquo;s bike map style</a> and adapted it for our purposes.</p>

<p>The result is our <a href="https://mountainmath.ca/mobi" class="btn btn-primary">Vancouver Bike Share Map</a>. (Fair
warning. While this map works great on your iOS and Android phone, it may not work on old desktop computers.)</p>

<p>Add it to your phone home screen, and it will be right at your fingertips when you need it!</p>

<!-- more -->


<p>And we threw the <a href="https://www.mobibikes.ca/">Mobi Bike Share</a> station data on top. That last part turned out a little
more messy than expected, the API that was <a href="https://bikeshare-research.org/#bssid:vancouver">linked at the Bike Share Research website</a>
is broken, and the Mobi redirects are malformed and no guesswork would yield a working API. Luckily
the <a href="https://twitter.com/oobr">bike share map wizard</a> on
Twitter <a href="https://twitter.com/oobr/status/756211668141547520">had the answer</a> how to tease out the station data. And some
of the stations are duplicate, so it took some time to clean up the data properly.</p>

<p>We tried to keep our map as simple as possible. This iteration highlights three types of infrastructure, separated, bike lanes and
shared lanes. The map has some hill-shading for reference, and at high zoom level it shows some bike points-of-interest.
The rest is kept clean and simple.</p>

<p>For the stations, we weren&rsquo;t fans of the icons and presentation used on many other maps. We decided on a simple
donut-style presentation to visualize available bikes to check out and empty slots to return them. This is the most crucial
information for a bike share user. Where can I check out a bike, and where can I return one. There is nothing more frustrating
than having to go to a meeting and being unable to check the bike back into a station because it is full. The map gives
a quick visual guide for this, although the Mobi data lags quite a bit right now. Hopefully that will change in the future
once they get their API up and running.</p>

<p>On touch/hover the bike stations expand to give exact counts and the station name. Station sizes vary and counts can be
useful at times. We opted to keep the icon size independent of station size, trading added information for a cleaner
presentation by only revealing it on user interaction.</p>

<p>This map focuses on the bike share user. If you are more interested in stats and overview of various bike share systems
you want to head over to <a href="http://bikes.oobrien.com">Oliver O&#8217;Brien&rsquo;s excellent bike share map</a>.</p>

<h3>Bike Infrastructure</h3>

<p>The bike data we are using comes straight out of <a href="http://www.openstreetmap.org/search?query=vancouver%2C%20bc#map=12/49.2497/-123.1193">OpenStreetMap</a>.
That has some disadvantages as it can be less accurate
as the city bike data. But it also has a huge advantage. Anyone can edit OpenStreetMap to fix incorrect or missing
infrastructure designations. We kept some of the targeted editing capabilities intact on our map, if you view it on desktop
and <em>shift-click</em> anywhere, it will take you right into the OpenStreetMap editor at the position you clicked so you can
edit the infrastructure there.</p>

<p>If you are planning on helping out and improve OpenStreetMap bike data, you may want to read the
<a href="https://mapzen.com/blog/targeted-editing-cycleways/">excellent targeted editing post from Mapzen</a> and use their
<a href="https://mapzen-data.github.io/te-bike-lrm-mapzen/#point0lat=49.2820&amp;point0lng=-123.1204&amp;point1lat=49.2708&amp;point1lng=-123.1341&amp;mode=bicycle">map to brouse OSM tags</a>.
You may notice the similarity to our map, we borrowed heavily from that one. Updates you make will take between 1 to 4
hours before they percolate through into our map.</p>

<p>Data in OpenStreetMap is automatically accessible to other services too, so improving OSM will help out everyone. And not
just by making the maps better, routing gets better too!</p>

<p>And the other big advantage of OpenStreetMap is that our map is automatically global. Right now we still focus on
Vancouver, and we restrict the search function to Vancouver addresses. But in principle the infrastructure part of the
map works for anywhere on the planet.</p>

<h3>Next Steps</h3>

<p>Adding bike routing is an obvious next step. And there are lots of other refinements we can think of.</p>

<p>Hill shading has some issues right now, only some
hill aspects are visible right now. We may have to add some colour to hill shading to visualize all hill aspects better,
but that requires care to ensure the map retains it&rsquo;s clean looks.</p>

<p>The next step in the map evolution is to make a multi-modal map, toghet with multi-modal routing. The map will highlight
infrastructure based on what modes are preferred, and routing will do routing for these modes.</p>

<p>Using the great work of the <a href="https://bikeshare-research.org">Bike Share Research website</a> we can also parse the feeds
for all global bike share systems registered there and expand the bike share map to other systems around the world.</p>

<h3>Feedback</h3>

<p>Got ideas how to make the map better? Want some pointers how to adapt this map for your own purposes? Send us a tweet
or a message!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mixing Data]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data/"/>
    <updated>2016-07-06T09:19:04-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/07/06/mixing-data</id>
    <content type="html"><![CDATA[<p>Census data is very rich and with <a href="https://censusmapper.ca">CensusMapper</a> we now have about 1 billion data points right at
our fingertips. And we have managed to open up some of our interfaces for everyone to <a href="http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone/">explore data and make their own maps
and freely share them</a>.</p>

<p>Things really get interesting when one mixes custom data with census data. While, at this point, these are not part of
the freely available CensusMapper functionality we still wanted to share what can be done.</p>

<p>At CensusMapper we have developed three basic ways to rapidly mix custom data with census data. So this is really three
blog posts in one.</p>

<!-- more -->


<h3>1. Overlay Mapping</h3>

<p>First up, advanced users can upload custom datasets and map them on top of census data.
<a href="http://doodles.mountainmath.ca/images/restaurants_2.png"><img  src="http://doodles.mountainmath.ca/images/restaurants_2.png" style="width:50%;float:right;margin-left:10px;"></a>
For example, we took a
<a href="http://data.vancouver.ca/datacatalogue/businessLicence.htm">business license dataset</a> from the City of Vancouver open
data catalogue, filtered it by the <em>BusinessType</em> field to only include businesses starting with &ldquo;Restaurant&rdquo; or
&ldquo;Liquor Establishment&rdquo; and uploaded them to CensusMapper to map it on top of census data. We have used a map
for <em>median age</em> that was <a href="https://twitter.com/jofu_/status/750564269796823041">recently created using CensusMapper&rsquo;s free public interface</a>
(have you made <a href="https://censusmapper.ca/maps/new">your own CensusMapper map</a> yet?), we have faded out areas outside of
Vancouver and coloured <em>Liquor Establishments</em> in red and <em>Restaurants</em> in blue.</p>

<p>Giving a visual impression of your own dataset in relation to census data is the first step to location analysis.</p>

<h3>2. Populate Custom Data with Census Data</h3>

<p>Next
up is to populate your own dataset with census data for further analysis. For the restaurants, we may be interested in
attaching population estimates in 5 minute walking distance from each location. We might also be interested in specific
age brackets, or numbers of recent immigrants
from specific countries that we may want to target with a new restaurant, or maybe even     income data.</p>

<p>This can be a time consuming and painful process,
but we have automated this at CensusMapper.</p>

<p>To showcase how this works we will show an example using elementary school catchment areas in the City of Vancouver. The
areas we have (from the <a href="http://data.vancouver.ca/datacatalogue/publicPlaces.htm">Vancouver Open Data Catalogue</a>) are
quite out of date, but for the purpose of this example they work as we will compare them to 2011 census data. We will look at the
<a href="https://censusmapper.ca/maps/419">school aged population</a> in each catchment.</p>

<!--
The general census release data does not fit our task perfectly, the census splits by age in early May 2011 and not by
year born and it does not have fine enough age brackets to estimating accurate school catchment numbers.
[BC Stats](http://www.bcstats.gov.bc.ca/StatisticsBySubject/Demography/PopulationEstimates.aspx) has finer age brackets
computed to school district (not catchment) boundaries, but their estimates are ridiculously far off of census numbers
when using matching age brackets and years that their usefulness is highly questionable. 
-->


<p><a href="http://doodles.mountainmath.ca/images/e-schools.png"><img  src="http://doodles.mountainmath.ca/images/e-schools.png" style="width:50%;float:left;margin-right:10px;"></a>
Using the visual overlay we notice that the catchment areas do fit boundaries of Dissemination Areas shown on the map
reasonably well, with some exceptions. The same cannot be said for Census Tracts, we can be reasonably confident that
Dissemination Area data is fairly accurate.</p>

<p>Next we use the built-in CensusMapper functionality to automatically populate the catchment areas with the census
data we are interested
in. When Dissemination Areas don&rsquo;t line up with the catchment boundaries we go down to Dissemination Blocks to estimate
how many children live on what side of the catchment boundary. We
<a href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/">previously explained this process in more detail</a>, the result is
a spreadsheet with the population data by age for each catchment area.</p>

<div id='schools'></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/colorbrewer.js" charset="utf-8"></script></div>


<div><script src="http://doodles.mountainmath.ca/javascripts/school_bar_graph.js" charset="utf-8"></script></div>


<p>Here we show the results by school, the select element can be used to select any school of interest. The whole process
of populating the school data with census data just required uploading the catchment boundaries and selecting which
variables to attach.</p>

<h3>3. Custom Census Data Mapping</h3>

<p>Sometimes it is not practical to map custom data on CensusMapper. Maybe the custom data is too sensitive to be uploaded
to CensusMapper servers. Or it is quite complex and is better mapped separately. So we created an API to pull in
census data from CensusMapper to easily show census data on custom maps. And dynamically mix in your own data. As an
example we mix census data with data from BCAssessment, again obtained through the
<a href="http://vancouver.ca/your-government/open-data-catalogue.aspx">Vancouver Open Data Catalogue</a> (and enriched with
<a href="http://www.metrovancouver.org/data">open data from Metro Vancouver</a>).
For demonstration purposes take Dissemination Area
geographies and Dwelling Characteristic data from CensusMapper and mash it up with our
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2604&amp;lng=-123.1417&amp;layer=14&amp;mapBase=2">processed assessment data</a>
to explore the <a href="http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use/">differences in how single family properties are classified</a>.</p>

<p><a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=0" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh_unit_count.png" style="width:50%;float:right;margin-left:10px;"></a>
For example we can <a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=0">compare BC Assessment single family lot count to Stats Canada unit count</a>
in the dissemination areas
that are exclusively made up of single family lots. This gives an indication of how many suites and laneway houses there
are in those areas. The census is prone to undercount units, but still does a better job at estimating them than other data sources,
like the city or BC Assessment.</p>

<p>One of the reasons why census unit counts come up higher than other methods is that the census also counts illegal units,
which naturally are not part of other official government counts. There are different reasons why a suite may be illegal:
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&layer=5" target="_blank"><img  src="http://doodles.mountainmath.ca/images/illegal_units.png" style="width:50%;float:left;margin-right:10px;"></a>
It could simply be that the owner has not made the effort to register it. Or the suite may not be up to code.
And in some cases, a property may have more than one suite in the main building, which is illegal in the City of Vancouver.
The latter ones we can pick out in census data, since a house with two secondary suites &ndash; so three dwelling units in one building in
total &ndash; is classified as being an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. So, in census dissemination areas that
only have duplex or single family lots as residential land uses based on assessment and land use data, we can look for
how many dwelling units the census places in an &ldquo;Apartment, building that has fewer than five storeys&rdquo;. And
<a href="https://mountainmath.ca/census_mix/map?mapBase=2&amp;layer=5">map them</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SDH Zoning and Land Use]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use/"/>
    <updated>2016-06-17T09:34:37-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/06/17/sdh-zoning-and-land-use</id>
    <content type="html"><![CDATA[<p>Recently the question around the amount of space taken up (exclusively) by single detached houses has show up on my
Twitter feed citing that
SFH take up <a href="https://twitter.com/WayneFougere/status/743211599821844481">70%</a>,
<a href="https://twitter.com/MitchellReardon/status/739957295564476416">66%</a>,
and <a href="https://twitter.com/karensawa/status/743235428011020288">57%</a>,
<a href="http://www.cknw.com/2016/06/02/the-lynda-steele-show-bob-rennie-on-supply-and-demand/">56% (timestamp 3:50)</a>.
I personally have thrown in
<a href="https://twitter.com/vb_jens/status/738608945741238272">34%</a> as a contender. And, just for the fun of it, by the end of
this post I will have thrown 33% and 28% and my favorite, 81%, into the mix.</p>

<p>What&rsquo;s going on, how can there be such a large range of estimates for what seems to be a simple question? The answer
lies in the details of what exactly the question is asking, all of the above numbers are correct answers to one particular
version of very similar questions.</p>

<h3>TL;DR</h3>

<p>The takeaway I think is most useful for general purposes:</p>

<pre><code>35% of all households live on single family and duplex properties
making up 81% of Vancouver's residential land, while the     
remaining 65% of households live on 19% of the residential land. 
</code></pre>

<!-- more -->


<p>There are two fundamental ways to attack the question. One is through zoning, that is to look at area where only SDH can
be built. The other is through land use, that is looking at what area is currently occupied by SDH lots.</p>

<h3>Single Detached Houses</h3>

<p>First we need to understand what we mean by single detached house. There are two common, but quite different definitions
out there. One stems from the zoning code and refers to a property that is not stratified and has a single main structure
on it, possibly with one suite, and possibly a laneway house. This is the definition most commonly used. When someone says
they own a single family house, this is what they are talking about. Let&rsquo;s call them <em>single detached properties</em>.
There are around 75,000 of these in the City of Vancouver.</p>

<p>Stats Canada employs a different definition. To them a <em>single detached dwelling</em> is single dwelling unit comprised of a
free-standing (detached) structure. A <em>single detached property</em> may contain exactly one dwelling unit, in which case
Stats Canada would also call it a <em>single detached dwelling</em>. If the house has a secondary suite, Stats Canda would
classify it as a <em>duplex</em>. If it has a laneway house, Stats Canada would classify the laneway house as a separate
<em>single detached dwelling</em>. Stats Canada reports 47,530 <em>single detached dwellings</em> in the City of Vancouver.</p>

<p>Because of this discrepancy, sometimes it is useful to look as single family houses and duplexes combined. Especially
if one wants to mix in census data to for example look at the number of households that live in these dwellings. While
there are about 75,000 <em>single detached properties</em> in Vancouver, it is fair to assume that there are significantly more
than 75,000 households living on these properties once we account for secondary suites and laneway houses.</p>

<h3>Zoning</h3>

<p><a href="http://vancouver.ca/files/cov/Zoning-Map-Vancouver.pdf" target="_blank"><img  src="http://doodles.mountainmath.ca/images/zoning_van_pdf.png" style="width:50%;float:right;margin-left:10px;"></a>
Vancouver is divided up into zones that determine what can (and cannot) be legally built on the land.
If one is primarily concerned with the area of land that where only single detached houses can be built, then zoning is
the right metric to look at.</p>

<p>There are two zones that essentially only allow single family houses as residential properties, the RS zones and,
to some extent, First Shaughnessy. Each of these has it&rsquo;s own pitfalls. The first issue is that parks are generally zoned
RS, but one cannot build single family homes in parks. Moreover, while RS does not allow residential land uses other
than single detached houses, it does allow for other land uses, like parks, schools, assisted living and other institutional
uses. So RS zoned land area is a poor proxy for the question of where single family houses could be built. At the very
<a href="https://mountainmath.ca/map/assessment?zoom=13&lat=49.2517&lng=-123.1232&layer=6" target="_blank"><img  src="http://doodles.mountainmath.ca/images/zoning_van.png" style="width:50%;float:left;margin-right:10px;"></a>
least we should exclude parks from the equation, but probably also schools and other institutional land uses. After all,
it is delusional to think that even if a school were to close down and the land be sold for development that single
detached dwelling would be built on that land. Next comes the question if we should only include the lots that single
family homes could be built on, or also include the surrounding roads. After all, the roads are needed to serve the lots.
But they also serve the schools and parks, so maybe only a certain portion of the roads should be included? It gets messy,
the second image shows only non-institutional and non-park properties (no roads) coloured by zone, interactive version
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2517&amp;lng=-123.1232&amp;layer=6">here</a>.</p>

<p>The numbers between 70% and 56% mentioned up top are (probably) derived using some version of zoned area, possibly excluding
parks or schools for some, but including roads within RS zoning. It is easy to underestimate
the space roads take up in the City of Vancouver, overall roads right of ways make up 28% of City of Vancouver land.</p>

<p>At the end of this though process, we are starting to gravitate away from zoning and toward land use.</p>

<h3>Land Use</h3>

<p>We can simplify the discussion by asking how much space currently is taken up by single family properties. The answer
to this is 33%. I have previously written about the
<a href="http://doodles.mountainmath.ca/blog/2016/02/29/land-use/">land use breakdown</a> for Metro Vancouver municipalities, but
single detached homes were not broken out separately, single detached and duplex properties combined take up 34% of
Vancouver&rsquo;s land. One can play the numbers a little more, maybe only look at single detached properties within RS zoning.
That puts the number at 28%. Throw in Shaugnessy and it rises to 29%. Recall that this excludes roads right of way.</p>

<p><a href="https://mountainmath.ca/land_use/map?zoom=13&lat=49.2544&lng=-123.1268&mu_filter=[%22VA%22]&lu_filter_n=[]" target="_blank"><img  src="http://doodles.mountainmath.ca/images/land_use_van.png" style="width:50%;float:right;margin-left:10px;"></a>
Here is an interactive (data-heavy) map that shows the land use for
<a href="https://mountainmath.ca/land_use/map?zoom=13&amp;lat=49.2544&amp;lng=-123.1268&amp;mu_filter=[%22VA%22]&amp;lu_filter_n=[]">just for the City of Vancouver (plus Musqueam 2)</a>.</p>

<h3>Multi-Unit Housing</h3>

<p>One can ask the same question about other housing types, and we can read off the numbers from the
<a href="http://doodles.mountainmath.ca/blog/2016/02/29/land-use/">land use breakdown</a>. 3.2% of land is taken up with low rise
apartments, 1.9% with townhouses, 1.2% with high rise, 0.3% by non-market housing, 0.9% by mixed use low rise and 0.7%
by mixed use high rise. Adding all of this up we get that 8.2% of land is taken up by housing that is not single detached
or duplex. And it also includes some commercial space in the mixed use developments.</p>

<p>That means that overall in Vancouver 42.2% of the land is used for residential purposes, 81% of which is occupied by
single detached and duplex properties and the remaining 19% is occupied by all other building forms.</p>

<h3>Share of Households in Different Land Uses</h3>

<p>We may be interested in the population density these different land use patterns entail. That&rsquo;s where things get a little
tricky, we will turn to the census for answers. From the standard census releases we can only discern the share of
dwellings that are single detached and duplex properties combined, and that number is 93,370 dwelling units. Overall
there are 264,575 dwelling units, so single family and duplex units make up 35% of all dwelling units in CoV. Glossing
over the issue that some of these may not be occupied we conclude that 35% of all households live on single family and
duplex properties making up 81% of Vancouver&rsquo;s residential land,
while the remaining 65% of households live on 19% of the residential land.</p>

<h3>Fine Print</h3>

<p>There are a number of issues with the data that might change the numbers slightly, but not by much. The first is that
the land use dataset I use lump the City of Vancouver together with Musqueam 2. That slightly changes the land use mix
and areas reported, but the effect on all numbers mentioned here is very small. Next up is the number of dwelling units
on single detached or duplex properties. The census number is likely to under report some secondary suites (although it
captures more than BCAssessment does), and properties with more than one secondary suite (so some illegal suites) will
show up as an apartment building in census data. Moreover, the census data is from 2011, the land use data we used is
about a year old, and we have manually adjusted for some recent upzoning. So there is some give or take in the numbers,
I would not expect more than a one percent move in the numbers I reported as a result.</p>

<h3>Further Questions</h3>

<p>This does not answer the question what percentage of the population lives on single family or duplex properties. To
estimate that one would have to first estimate the number of people per houshold for the different land uses, as we
expect them to differ significantly. One can start exploring how the number of people per dwelling unit varies
<a href="https://censusmapper.ca/maps/391">on CensusMapper</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FSR]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/20/density/"/>
    <updated>2016-05-20T22:51:29-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/20/density</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/map/assessment?layer=16" target="_blank"><img  src="http://doodles.mountainmath.ca/images/fsr.png" style="width:50%;float:right;margin-left:10px;"></a>
Ever since I played with the <a href="http://mountainmath.ca/vancouver_lidar/map">LIDAR-generated building height data</a> I thought
that I should use that to map gross floor area (GFA) and floor space ratio (FSR). Gross floor area is the total floor area
inside the building envelope. So for a three storey building, it is the area of the footprint times three.
Floor space ratio is the GFA divided by the area of the parcel it sits on. There are several reasons why this may be
interesting.</p>

<p>GFA is the currency of the developer. Especially once we enter the world of apartment or commercial buildings,
gross floor area is directly proportional to the amount of money a developer can charge for a property, either when stratified
and sold or when rented out.</p>

<p>FSR on the other hand is a measure of density, and it is the currency of the zoning code. Height and site coverage are
also regulated in the zoning code and there is an obvious relationship to FSR. But because GFA is so important to the
developer, FSR usually receives more attention in public discussions.</p>

<p>Read on or <a href="https://mountainmath.ca/map/assessment?layer=16" target="_blank" class='btn btn-default'>head straight for the interactive map</a> to browse
Vancouver by FSR. Read the disclaimer at the bottom before using any data for purposes other than general reference.</p>

<!-- more -->


<h3>Maximum Allowable FSR and Spot Zoning.</h3>

<p>The maximum allowable FSR is set by the zoning code. Because land is so valuable in Vancouver, most people will try
to maximize GFA when building a new building, so they typically go right up to the maximum allowable FSR. Previously we have
<a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">examined the effects of various related metrics like height and site coverage</a>
for single family homes.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=15&lat=49.2599&lng=-123.1583&layer=6" target="_blank"><img  src="http://doodles.mountainmath.ca/images/spot-zoning.png" style="width:30%;float:right;margin-left:10px;"></a>
At least this is how it works for RS/RT zones. If you are looking to develop a different property, say a mixed use or
an apartment building or commercial building you will probably be looking to up-zone. That is, you will try to convince
the city (and the local population) to allow you to build more GFA than zoning would allow. If successful the city will
create a new zone just for your property and ask for some compensation in form of CACs (aiming to recoup about 80% of the
uplift in value the up-zoning creates) in return. That process is called
spot zoning and it can be seen in form of the little &ldquo;Comprehensive Development&rdquo; zones that are visible as yellow
sprinkles in the otherwise quite uniform zones on the map.</p>

<p>In reality the process of up-zoning a property is a lot more complex, arduous and time consuming, which favours larger
developers with deep pockets that can take the risk and sit out the long process of eventually obtaining higher GFA. One
of the many reasons why the &ldquo;missing middle&rdquo; is missing.</p>

<h3>Mapping Density</h3>

<p><a href="https://censusmapper.ca/maps/302#16/49.2375/-123.1573" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_people.png" style="width:30%;float:left;margin-right:10px;"></a>
From Census data we know the <a href="https://censusmapper.ca/maps/302">nighttime density</a>, that is where people live and sleep.
But we don&rsquo;t know where they are
during the daytime.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=16&lat=49.238&lng=-123.154&layer=16" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_fsr.png" style="width:30%;float:right;margin-left:10px;"></a>
FSR is also often seen as such a measure of density, although it only focuses on density on property parcels and neglects
all the space between parcels, like roads right of ways and parks.</p>

<p>In mostly residential neighbourhoods the two densities correspond quite closely, but in areas with large commercial buildings
(nighttime) population density can be quite low while FSR is very high as can easily be seen by comparing the two maps.</p>

<p><a href="https://mountainmath.ca/assessment_gl/map?zoom=16&lat=49.2384&lng=-123.1567" target="_blank"><img  src="http://doodles.mountainmath.ca/images/kerrisdale_tax.png" style="width:30%;float:left;margin-right:10px;"></a>
<a href="https://mountainmath.ca/assessment_gl/map">Tax density</a>, that is property taxes collected per area, give another view of
&ldquo;density&rdquo; in the city that highlights relative property values and emphasises commercial land use that pays five times
the residential tax rate.</p>

<p>There are lots of other measures of density that are important for different purposes, for example <a href="http://mountainmath.ca/census3">household density</a>
(in full 3D, requires modern computer),
<a href="https://censusmapper.ca/maps/359">the density of private dwelling units</a> or <a href="https://censusmapper.ca/maps/35">toddler density</a> just to name a few.</p>

<h3>Next Steps</h3>

<p>There are several directions I want to take this. Now that FSR is available for all properties, I can
compare purpose built rental buildings to strata buildings. For example, in my
<a href="http://mountainmath.ca/assessment/split_map">Buildings and Dirt map</a> I can&rsquo;t integrate purpose
built rentals because I don&rsquo;t know how many rental units they have. The assessment data from the Vancouver Open Data portal,
does not have that information, and BC Assessment won&rsquo;t share it (in a hassle-free way). But I can make a similar map based on GFA instead of
number of units and examine
how GFA effect land and building values across different land uses. And in many ways GFA may be a better unit for comparisons
than number of suites.</p>

<p><a href="https://mountainmath.ca/map/assessment?zoom=13&lat=49.2488&lng=-123.1211&layer=17&filter=res" target="_blank"><img  src="http://doodles.mountainmath.ca/images/value_per_gfa.png" style="width:50%;float:right;margin-left:10px;"></a>
Or I can just make a <a href="https://mountainmath.ca/map/assessment?zoom=14&amp;lat=49.2684&amp;lng=-123.1354&amp;layer=17">straight-up map of total assessed value per GFA</a>.
And maybe add a filter to only show this for <a href="https://mountainmath.ca/map/assessment?zoom=13&amp;lat=49.2488&amp;lng=-123.1211&amp;layer=17&amp;filter=res">residential and mixed use units</a>
like in the image if that&rsquo;s what we are interested in.</p>

<p>Another interesting application is to use this data to do something along the lines of this
<a href="http://www.nytimes.com/interactive/2016/05/19/upshot/forty-percent-of-manhattans-buildings-could-not-be-built-today.html?_r=0">excellent analysis the New York Times published</a>
for Vancouver. FSR, next to building heights and lot coverage that I
<a href="http://doodles.mountainmath.ca/blog/2016/03/05/physical-sfh-form-over-time/">have already analysed from a different angle</a>,
is an important metric to detect buildings that could not be rebuilt under regular zoning.</p>

<p>Lastly, having data on building GFA, together with assessment open data, allows for reverse-engineering of the GFA of individual
strata units. That makes the analysis of condo assessment data more meaningful as we can analyse assessed condo values by
unit size. One of the reasons why we are only talking about single family homes (or in some cases RS zoned homes) and
not condos is that it is very easy to compare single family homes. But comparing condos doesn&rsquo;t make much sense unless
one also has data on the size of each condo. And this has probably focused the public debate too much on single family
homes when we should be paying a lot more attention to condos. And purpose built rental units.</p>

<h3>Disclaimer</h3>

<p>The FSR was estimated using coarse building data extracted from LIDAR data. The motivation was to use the FSR for aggregate
analysis and not for getting accurate estimates of individual buildings.</p>

<p>Secondary buildings like garages or laneway houses are only inconsistently detected and mapped. The data is from 2009,
buildings built after that are greyed out.</p>

<p>The algorithm to compute FSR
from this building data is rather crude and only makes rudimentary attempts to adjust for varying floor heights of buildings
different for land uses, overhangs and eyebrows and dealing with pitched roofs or mechanical units.</p>

<p>Building data was clipped to property polygons to deal with cases of buildings spanning several legal lots or not properly
separated.</p>

<p>The FSR computed only roughly resembles the FSR defined in building codes. In particular our model with grossly
overestimate the FSR for buildings with overhanging features like
the Lookout on the Harbour Centre.</p>

<p>Block level aggregates will underestimate FSR in the presence of properties excluded from the FSR calculation.</p>

<p>Do not be use the FSR estimates as an authoritative source for any individual building FSR.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[My Global Bike Map]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/16/my-global-bike-map/"/>
    <updated>2016-05-16T21:39:07-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/16/my-global-bike-map</id>
    <content type="html"><![CDATA[<p><a href="http://doodles.mountainmath.ca/bike_global.html#14/49.2775/-123.1292" target="_blank"><img  src="http://doodles.mountainmath.ca/images/vancouver_bike.png"  style="width:50%;float:right;margin-left:10px;"></a>
Last week Mapzen <a href="https://twitter.com/mapzen/status/730782107685912576">announced</a> that they included bike data in their OSM vector tiles. That&rsquo;s just what the doctor ordered
to continue on my path towards the perfect bike map that I <a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">started on</a>,
<a href="http://doodles.mountainmath.ca/blog/2015/12/14/routing/">explored routing</a> and <a href="http://doodles.mountainmath.ca/blog/2015/12/15/bike-data/">looked at improving OSM bike data</a>.
Now that I don&rsquo;t need to extract bike data myself any more it is time to take these maps global. And maybe add some minor
improvements.</p>

<!-- more -->


<p>To make the bike map boils down to deciding what OSM roads, paths, etc to map and how to map them. And what contextual
information to display. The only choices we have to make is how to organize the bike related data that exists in open street maps. Let&rsquo;s be a little
radical! Our emphasis will be on safety and cycling comfort for the casual rider.</p>

<p>We will emphasise separated cycletracks by making them brightest and thickest. Shared pedestrian/bike infrastructure will
get a separate colour and be a little bit thinner. Next we layer on designated bike infrastructure by prioritizing lanes
on residential roads, then &ldquo;shared&rdquo; residential roads, then residential roads, then lanes and &ldquo;shared&rdquo; designations on
increasingly busy roads. Lastly we add residential and larger roads. And we only label roads that we are actually interested in.</p>

<p>We allow some customization by emphasizing or de-emphasizing certain types of infrastructure. By default, roads without
special bike designation are de-emphasized.</p>

<p>For good measure we added basic land use categories to highlight possible destinations, and we add building footprints
for reference as available.</p>

<p>This scheme is geared toward the safety conscious and motor-traffic-adverse cyclist in North America. In Europe other
designations exist that might call for a different priority. MAMILs might want a different colour scheme altogether.</p>

<iframe src="http://doodles.mountainmath.ca/bike_global.html#14/49.2775/-123.1292" width="80%" height="450" style="margin: 5px 10%;"></iframe>


<p>To get a better view you can also
<a href="http://doodles.mountainmath.ca/bike_global.html" target="_blank" class='btn btn-default'>take the map full-screen</a>.</p>

<h3>Data Quality</h3>

<p>The data for the map comes right out of Open Streets Map. That means that if something is missing or not right you can
just go and fix it! To make things a little easier when you are on a desktop computer, just &ldquo;shift-click&rdquo; where the problem
is and it will bring the open street map editor up for that position. You might have to log in first or create a free
account before you can help improve the bike map.</p>

<p>There is a bit of a lag between changes being made in open street map and them filtering down to the mapzen tiles so that
they will show up on the map on the map, so don&rsquo;t fret if things aren&rsquo;t up to date immediately.</p>

<h3>Global</h3>

<p><a href="http://doodles.mountainmath.ca/bike_global.html#13/52.3617/4.9051" target="_blank"><img  src="http://doodles.mountainmath.ca/images/amsterdam_bike.png"  style="width:50%;float:left;margin-right:10px;"></a>
And this bike map is global. The quality of the map depends on the quality of OSM data, in the case of Amsterdam it makes
it abundantly clear why casual cyclists keep dreaming about the infrastructure in this city.</p>

<p>The choice of emphasis for the
maps are based on North America, or more narrowly Vancouver, where I live. So this might need adjusting for local context
to better fit local OSM conventions. Use the search bar and explore your region.</p>

<h3>The Real Deal</h3>

<p><a href="https://ride.report" target="_blank"><img  src="http://doodles.mountainmath.ca/images/ride_report.png"  style="width:50%;float:right;margin-left:10px;"></a>
Sadly, all of this effort is really coming at things from the wrong angle. The best way to do this,
<a href="http://doodles.mountainmath.ca/blog/2015/12/13/how-to-make-a-bike-map/">as we outlined earlier</a>, is to base a bike map
on how cyclists actually use the roads and pathways, instead of how they got classified in Open Street Map or what
municipalities think they should be classified. The problem is that we don&rsquo;t have that data. At least not yet. But
there are really cool efforts out there to get that data and make it available.</p>

<p>I really like the approach that <a href="https://ride.report" target="_blank">Ride Report</a> has taken. Strava works
reasonably well for recreational cyclists, but it does a terrible job at capturing where transportation cyclists go and
makes no effort in understanding their comfort level. Ride Report takes a different approach by automagically figuring
out what you are doing and recording your cycling trips. All without you ever having to press a &ldquo;start&rdquo; or &ldquo;stop&rdquo; button,
which is key if you want to understand where transportation cyclists go. On top of that it prompts you to simply rate your
bike trip once you are done, and you can do this easily from your lock screen. Then Ride Report aggregates the data
to produce stress maps, and possibly other important data that can guide infrastructure improvements.</p>

<p>In this day and age of data driven decision making I would really like more municipalities to support efforts like Ride Report
that generate real meaningful data on transportation cycling. And as a by-product one could take cycling maps to the
next level and add actual cycling usage and comfort.</p>

<h3>Issues</h3>

<p>There are still some issues. Some bike infrastructure, for example OSM paths, only become visible at zoom level 13 or higher.
That&rsquo;s just the way the vector tile service works. Secondary roads are only visible at zoom level 12 or higher, and this
includes &ldquo;bike boulevards&rdquo;. Cyclepaths are only visible at zoom level 11 or higher. If one wants to have high-level bike
maps one probably needs a dedicated vector tile service for bike infrastructure.</p>

<h3>Apologies</h3>

<p>Since this is just a blog post I have not gone out of my way to make sure this map works on every computer and browser.
Basically, I am leaveraging off of <a href="https://mapzen.com">Mapzen&rsquo;s</a> awesome <a href="https://mapzen.com/projects/tangram/">Tangram</a>
mapping engine to keep things simple on my end, but that means the maps will only show on modern computers
(and modern browsers, so no IE). If your computer is having trouble displaying the map just pull out your phone, chances
are it it is much better equipped to handle modern web technology.</p>

<p>Also, I made a bunch of choices how to display bike infrastructure. These are just a function of my personal preferences
and what OSM data has to offer. If you notice issues with the OSM data, you can fix it in OSM and it will show on the map
once the changes have filtered through to Mapzen&rsquo;s tile service. If you don&rsquo;t like my personal prefernces, just grab the
html for the map and the scene file and change it at your heart&rsquo;s content. You don&rsquo;t need any special server to host these
files, I dumped them on my static blog. Even a public dropbox folder can host these maps.</p>

<p>So grab the code and customize it at your heart&rsquo;s content. Take full control on how to display bike infrastructure and
roads, and what amenities to show and how to style them.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Census Mapping for Everyone]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone/"/>
    <updated>2016-05-04T11:45:39-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/04/census-mapping-for-everyone</id>
    <content type="html"><![CDATA[<p>At CensusMapper, we have come a long way from first <a href="http://doodles.mountainmath.ca/blog/2015/06/23/vancouver-2011-census-data-on-housing/">dabbling in census data</a> to
building out a <a href="http://doodles.mountainmath.ca/blog/2015/09/28/census-mapper/">platform to map data Canada wide</a>, adding
the ability to <a href="http://doodles.mountainmath.ca/blog/2015/10/24/census-drilldown/">easily drill down into individual census regions</a>,
<a href="http://doodles.mountainmath.ca/blog/2015/12/27/canvas-vs-svg/">improving mapping efficiency</a>, adding the ability to
<a href="http://doodles.mountainmath.ca/blog/2016/04/20/tod-mode-share/">automatically populate custom geographic data with census variables</a>
and <a href="http://doodles.mountainmath.ca/blog/2016/05/02/census-week/">adding older census data</a>.</p>

<p>We believe all of these are comparatively small steps compared to the opening up of map making capabilities for everyone
that we are rolling out today. Free to use, free of charge. Statistic Canada <a href="http://www.statcan.gc.ca/eng/reference/licence-eng">opened up census data</a>
for anyone to use, but the sheer volume of available data and complexities of mapping geographic data has kept this
inaccessible to many.</p>

<p>By opening up basic map making capabilities to everyone we are putting the liberating that data from depth of spreadsheets and
database servers and opening it up to everyone. One map at a time.  Read on for tips and tricks or head right on over
to <a href="https://censusmapper.ca" class="btn btn-primary">Censusmapper</a> to make your first CensusMapper map!</p>

<!-- more -->


<h3>Simple Maps</h3>

<p><img  src="http://doodles.mountainmath.ca/images/make_a_map.png"  style="width:30%;float:right;margin-left:10px;">
To make your own map, start by choosing &ldquo;Start New 2011 Map&rdquo; from the &ldquo;Make a Map&rdquo; menu. If you are planning on saving
and sharing your map you should log in or create an account first, but you can play with mapping census data without an account.</p>

<p><img  src="http://doodles.mountainmath.ca/images/signin.png"  style="width:25%;float:left;margin-right:10px;">
We tried to make logging in super simple by providing oAuth signup with popular providers, but you can also go the old
fashioned way and create an account manually by providing username (email) and custom password.</p>

<p><img  src="http://doodles.mountainmath.ca/images/census_variables_menu.png"  style="width:30%;float:right;margin-left:10px;">
To start your new map, navigate down to the census variable picker at the bottom of the sidebar. Click the bars
to expand or collapse them. Once you found a variable you want to map, click
the &lsquo;globe&rsquo; icon and select how you want to map the variable.</p>

<p><img  src="http://doodles.mountainmath.ca/images/map_variable.png"  style="width:50%;float:left;margin-right:10px;">
Depending on what variable you choose you have the option to map simply map the variable, in this case the total number
of people that are married or living with a common law partner, or map the variable as a percentage of a &ldquo;parent&rdquo; variable,
so in this case map the percentage of people that are married or living with a common law partner out of all people 15 years
or over. If in doubt what the variables mean, head over to the
<a href="https://www12.statcan.gc.ca/census-recensement/2011/ref/dict/98-301-X2011001-eng.pdf">Census Dictionary</a>
to look up the definitions.</p>

<p><img  src="http://doodles.mountainmath.ca/images/finished_map_1.png"  style="width:50%;float:right;margin-left:10px;">
Once you press the button CensusMapper will do it&rsquo;s magic and map the data for you. Zoom pan and use the search bar to expore
the data across different regions and geographic aggregation levels in Canada. You may want to edit the automatically
generated map label to make it more concise.</p>

<p><img  src="http://doodles.mountainmath.ca/images/finished_map_2.png"  style="width:30%;float:left;margin-right:10px;">
To style your map you can select the &ldquo;Colors&rdquo; option in the orange map editor menu in the sidebar.</p>

<p><img  src="http://doodles.mountainmath.ca/images/finished_map_3.png"  style="width:50%;float:right;margin-left:10px;">
There you can style your map by selecting a custom color scheme and fine tune your domain cutoffs.</p>

<p><img  src="http://doodles.mountainmath.ca/images/finished_map_4.png"  style="width:50%;float:left;margin-right:10px;">
If you were signed in you could now select the &ldquo;Save Map&rdquo; option from the map editor menu and add a map title and a map
description. Map descriptions can be styled in <a href="https://daringfireball.net/projects/markdown/">markdown</a>.</p>

<p>Maps can tell many different stories, use the map description to give some background and rational for your
map. A good map story might link to different views of the map to support the story telling. You can use the &ldquo;Paste link
to current view into description&rdquo; button to link to different map views. You can also link to different CensusMapper maps
to create deeply integrated map stories. Rich map stories can provide powerful insights into our communities.</p>

<p>If you want to share your map with others, make sure you set the map visibility from &ldquo;Private&rdquo; to &ldquo;Published&rdquo;. Otherwise
others will get an &ldquo;access denied&rdquo; message when they attempt to view the map. Published maps will automatically appear on
the extended map list, so please take some time and write appropriate descriptions that others can enjoy them.</p>

<p>Head on over to <a href="https://censusmapper.ca" class="btn btn-primary">Censusmapper</a> to get started.</p>

<h3>Advanced Maps</h3>

<p>The ability to quickly map any census variable is quite liberating. At the same time it is also restrictive. Imagine
all the things that could be mapped if you could combine census variables in other ways. And CensusMapper has that
capability to dynamically weave a number of census variables into a function to be mapped. But with that comes another
level of complexity and potential pitfalls that, at the moment, prevents us from opening this up to the general public.</p>

<p>At the same time, we are still trying to figure out the overall funding model at CensusMapper. We believe that we have
plenty of value in our advanced mapping capabilities, as well as in our ability to
<a href="http://doodles.mountainmath.ca/blog/2016/04/20/tod-mode-share/">automatically populate custom geographic data with census variables</a>
and our backend data analysis capabilities to focus on paid products that allows us to open up the Simple Map model
for everyone for free. At CensusMapper, we love open data. And with time as we refine our funding model we may open up
more advanced mapping capabilities to put more data into the palm of everyone&rsquo;s hands.</p>

<h3>Our Worries</h3>

<p>We are also a bit worried about how CensusMapper will be used. The internet has the ability to turn the most beautiful
thing into something ugly, and we are hoping that mappers will use the tool responsibly and make meaningful maps that
tell a story, instead of vanity maps or maps meant to isolate or smear specific groups of people. If we feel that the
tool is being abused we might have to enforce a real name policy or partially close down CensusMapper. Please map responsibly.</p>

<h3>Bugs</h3>

<p>If you find any, let us know. The tool should work well on Mac using Chrome, Safari or Firefox and should work reasonably
well on Windows with Chrome and Firefox. iPad, iPhone and modern Android should also work well. Please contact us if you find
anything not working properly.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Census Week]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/05/02/census-week/"/>
    <updated>2016-05-02T11:07:07-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/05/02/census-week</id>
    <content type="html"><![CDATA[<p><img  src="http://doodles.mountainmath.ca/images/census.jpg"  style="width:50%;float:right;margin-left:10px;">
At CensusMapper we are super excited about Census Week 2016. Data is increasingly getting incorporated into local and
regional decision making. At CensusMapper we have been working to facilitate this by making this wealth of information
more accessible to everyone. To celebrate Census Week 2016 we have updated CensusMapper with 2006 census data for easy
comparisons with the 2011 data. And we have given CensusMapper a face lift by adding a histogram widget that interacts
with the mapping data. Watch for more exciting updates this week or read on for a sneak peak!</p>

<!-- more -->


<h3>2006 Census</h3>

<p><a href="http://http://censusmapper.ca/maps/37" target="_blank"><img  src="http://doodles.mountainmath.ca/images/affordability2011.png"  style="width:50%;float:right;margin-left:10px;"></a>
<a href="http://http://censusmapper.ca/maps/293" target="_blank"><img  src="http://doodles.mountainmath.ca/images/affordability2006.png"  style="width:50%;float:left;margin-right:10px;"></a>
We re-worked the backend to make it easy to add and map older censuses. And of course the 2016 census, once it becomes
available. At the first step, this allows side-by-side comparisons between different census years through our map-based
interface. As we explore this further we will add better ways to simultaneously browse two difference censuses, and we
will add a way to map data from two censuses on one the same map. Apart from some technical challenges that we know how
to handle, this also presents challenges when directly comparing the long form census to the 2011 NHS, which had different
collection methods that introduced biases that can be of the same magnitude as the changes one may want to measure.</p>

<h3>Widgets</h3>

<p>At CensusMapper we are all about interaction. We love exploring data visually, and our dynamic zoomable maps make browsing
census data very easy. But the maps are just scratching the surface. Often it is also usefuly to view a simple graph. That&rsquo;s
where the graph widgets come in, the first of which is the histogram that dynamically shows a histogram of the data visible
in the current map view.
<a href="http://censusmapper.ca/maps/76" target="_blank"><img  src="http://doodles.mountainmath.ca/images/animated_rent.gif" style="margin:10px;"></a></p>

<p>And of course the widget is fully linked with the map. Hover over a map region, and it will show where the mapped value fits into
histogram. Pan and zoom and the histogram updates automatically. The other way around, hover over a histogram bin and the
corresponding regions on the map get highlighted. That makes exploring the data so much easier.</p>

<h3>Make your own maps</h3>

<p>We will roll out basic map making capabilities for everyone later this week. How will this work? Census data is huge, so
it won&rsquo;t go completely without pain. But we try to make it as easy as possible. Once the new &ldquo;Make a Map&rdquo; option becomes
available you can browse through the list of census variables and simply select which one you want to map. You will have
the option to map the value or, if it makes sense, the value as a percentage of a &ldquo;parent&rdquo; variable.
<a href="http://censusmapper.ca" target="_blank"><img  src="http://doodles.mountainmath.ca/images/animated_simple.gif" style="margin:10px;"></a></p>

<p>A click of the mouse and you have a new map. Head over to the colour scheme picker and select the colour cutoffs to customize it.
You can even log in and save the map and write your own map story for the side bar, so that you can share and interactive
version of your map online. We can&rsquo;t wait getting census data into everyone&rsquo;s hands!</p>

<script>
function resetImages(){
    $('img').each(function(img){
        imgsrc = $(img).attr('src');
        if (imgsrc.slice(imgsrc.length-4)=='.gif') {
            $(img).attr('src', '');
            $(img).attr('src', imgsrc);
            
        }
    });
    setTimeout(function(){
        resetImages();
    },25000);
}
setTimeout(function(){
    resetImages();
},25000);
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TOD Mode Share]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/04/20/tod-mode-share/"/>
    <updated>2016-04-20T23:26:35-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/04/20/tod-mode-share</id>
    <content type="html"><![CDATA[<p><a href="http://doodles.mountainmath.ca/skytrain_mode_map.html" target="_blank"><img  src="http://doodles.mountainmath.ca/images/mode_share.png"  style="width:50%;float:right;margin-left:10px;"></a>
Just saw a <a href="https://pricetags.wordpress.com/2016/04/20/surprising-densities-at-some-skytrain-stations/">comment on the Pricetags blog</a>
pointing to a nice <a href="http://summit.sfu.ca/system/files/iritems1/9819/ETD4936.pdf">master&rsquo;s thesis</a>
investigating various TOD metrics around skytrain stations. I got curious how the 2011 transit mode share compares to the earlier
census years listed in the thesis. And how the mode share varies spatially.</p>

<!-- more -->


<p>With <a href="http://censusmapper.ca/maps/316">CensusMapper</a> at my finger tips and building on the
<a href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/">visuals from the previous post</a> this is an easy exercise.</p>

<p>We again simply map our concentric circles around the stations, but this time we turn them into pie charts to show the
commute to work mode share. And we show the values for the inner 400m circle and the 400m to 800m annulus separately. I
also added some basic land use data, green for parks, pink for instututional and light blue for commercial or industrial
to provide more context.</p>

<p>What we would expect to see is that the transit mode share is larger in the 400m buffer, but curiously this is not always the case.</p>

<p>Click, touch or hover to get the exact values. And sorry again, only new computers will get a meaningful result. Most
smart phones and tablets will have no problems.</p>

<iframe src="http://doodles.mountainmath.ca/skytrain_mode_map.html" width="80%" height="500", style="margin:5px 10%;"></iframe>


<p><a href="http://doodles.mountainmath.ca/skytrain_mode_map.html#11/49.2430/-123.0350" class="btn btn-primary">Full screen view</a></p>

<p>The City of Vancouver average transit mode share is 30%, for Metro it&rsquo;s 20%. Head over to <a href="http://censusmapper.ca/maps/316">CensusMapper</a>
to explore transit mode share in the region (or anywhere else in Canada) in more detail.</p>

<h3>What I missed</h3>

<p>The master&rsquo;s thesis was careful enough to exclude areas across the river from the analysis. That&rsquo;s good thinking, I only
took circular buffers around the stations to do this. As indicated in the <a href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/">previous post</a>,
in the future we will add the capability to automatically generate isochrones, so areas
within 5 or 10 minutes walking distance, and use these
as regions, instead of using circular 400m and 800m buffers around the stations.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TOD]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/04/06/tod/"/>
    <updated>2016-04-06T16:22:36-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/04/06/tod</id>
    <content type="html"><![CDATA[<p><a href="http://doodles.mountainmath.ca/skytrain_tod_map.html" target="_blank"><img  src="http://doodles.mountainmath.ca/images/skytrain_tod.png"  style="width:50%;float:right;margin-left:10px;"></a>
Just saw <a href="http://michaelmortensenblog.com/2016/04/05/transit-oriented-development-room-for-smart-growth-in-greater-vancouver/">this excellent post looking at density around transit stations</a>
today and though I should pull out some numbers
to go with the pretty visuals. And with CensusMapper&rsquo;s new capabilities of populating custom geometries with census data
estimates it&rsquo;s super-easy to do.</p>

<!-- more -->


<p>Population density is only one measure of interest here, job density or amenities density would be others. But for now let&rsquo;s
focus on population, so how many people live near the rapid transit stations. To keep things simple we checked for a 400m
and an 800m radius circle around the stations. At least roughly, if you need to know the details check the bottom.</p>

<p>To visualize this we simply map our concentric circles around the stations and use the population density as height.
Click, touch or hover to get the exact values. And sorry again, only new computers will get a meaningful result. Most
smart phones and tablets will have no problems.</p>

<iframe src="http://doodles.mountainmath.ca/skytrain_tod_map.html" width="80%" height="500", style="margin:5px 10%;"></iframe>


<p><a href="http://doodles.mountainmath.ca/skytrain_tod_map.html#11/49.2430/-123.0350" class="btn btn-primary">Full screen view</a></p>

<p>What immediately stands out is that for some stations inner orange circle is lower than the outer yellow circle. That means
the 400m radius area is less dense than the 800m radius area. It&rsquo;s as if
there was an inverse-TOD development. That&rsquo;s where local knowlege becomes important to see how exectly things are like
around the stations. Maybe the station primarily servers jobs or amenities, which we did not map. This definitely deserves
more scrutiny.</p>

<p><a href="http://censusmapper.ca/maps/302" target="_blank"><img  src="http://doodles.mountainmath.ca/images/population_density.png"  style="width:50%;float:left;margin-right:10px;"></a>
Of course we can also view this on the <a href="http://censusmapper.ca/maps/302?zoom=12&amp;lat=49.2545&amp;lng=-123.0433">CensusMapper population density map</a>
comes in handy, if we zoom in it breaks it down to the census block level. And CensusMapper will also function on your
old computer if that&rsquo;s what you are using.</p>

<h3>Next steps</h3>

<p>One clear drawback of the analysis is that it uses 2011 numbers, which are quite old by now. So it&rsquo;s probably worthwhile to
re-visit this once 2016 population numbers become available. In the meantime I should run the same analysis on the 2006
data to see how density around transit stations changed. Some other day.</p>

<h3>Details</h3>

<p>This section is only interesting for people who want to know how exactly the numbers were derived. Conveniently
<a href="https://twitter.com/dshkol/status/717768801664651264">Dmitry had the station data handy</a>, which I took and then threw out
the duplicates data for each station platform.</p>

<p>Getting exact number
of people in a given circle radius around a station would require a getting custom tabulation for Stats Canada. This
is clearly overkill for the application we are looking at, and if we really wanted to be more precise we should probably start
by using an isochrone, that is an area that is at a 10 minute walking distance from the station, instead of using a circle.</p>

<p>In the future we will bake the ability to compute isochrones right into CensusMapper. Right now CensusMapper
estimates population data for arbitrary regions, including circular ones, by checking which census blocks intersect
each circle and add up the populations. Actually, we have three differnt ways to do this</p>

<ol type="a">
<li>by just taking all dissemination blocks that intersect</li>
<li>by just taking all dissemination blocks with the majority of its area in the intersection with the region</li>
<li>by scaling all properties of the dissemination block according to the proportion of its area in the overlap with our region.</li>
</ol>


<p>Each has its own advantages and disadvantages, we felt that option 2 is best suited for our purposes.</p>

<p>So we end up with a slightly different areas from the circle, the area given by the
census blocks we included, and we compute population densities based on that area. Since we visualize the circles instead
of the union of the census blocks used the visualization is a little bit misleading, but there is some value in the simplicity
of sticking with circles.</p>

<p>Since we are only interested in population data
we are done. In the more general case, when we are interested in estimating other census variables, for example the average rent in the
area, CensusMapper would now go through the census geographies and match up appropriate geographies with the census blocks
to derive the appropriate estimates. The actual algorithm gets quite complex here. Extra weights, like the proportion of
households that rent (and not own), come into play, as well as data quality estimates. And yes, if we did opt to use area overlap
weights in the block level computation, we would base them on households instead of population. If I am vague here it&rsquo;s
because the algorithm is quite complex and not really fit for a blog post.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[On Houses and Dirt]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/04/01/on-dirt-and-houses/"/>
    <updated>2016-04-01T22:30:43-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/04/01/on-dirt-and-houses</id>
    <content type="html"><![CDATA[<p>The story of Vancouver real estate is mostly a story of dirt. After spending a bit of time to collect relevant data I
am now wondering how to make better visualizations to make that data more accessible.</p>

<!-- more -->


<p><a href="http://mountainmath.ca/map/assessment?zoom=13&lat=49.2483&lng=-123.1139&layer=9" target="_blank"><img  src="http://doodles.mountainmath.ca/images/sfh.png"  style="width:50%;float:right;margin-left:10px;"></a>
Looking at my <a href="http://www.mountainmath.ca/map/assessment">old maps based around assessment data</a>, there are a couple of things that bother me. They are not very
good at showing changes over time. And they are not very good at highlighting the different role of dirt and the
houses on top. Yes, they do have separate views for building value, land value and various changes over time.
But the visuals aren&rsquo;t catchy and intuitive. When mapping building values I show the properties the buildings sit
on, instead of the building footprint. When mapping value increases I just map a some kind of ratio of values between
specific years. I use colours to visualize values, highlighting large differences but losing the smaller differences
within the colour brackets.</p>

<p>What would a better visual look like? I want to better explain the different roles played by dirt and houses. But
retain interactivity and the ability to zoom and pan around.</p>

<h3>Better Visualizations</h3>

<p>The idea is to map buildings and properties on the same map. Using 3D mapping we can uses height as an intuitive
representation for value, adding colour brackets for additional reference as values push through emotionally relevant
brackets, like the $1m barrier. To show change over time we just add a time slider and animate the whole thing.
To keep things simple and comparable we will focus on single family homes for now.
<a href="http://www.mountainmath.ca/assessment/split_map" target="_blank"><img  src="http://doodles.mountainmath.ca/images/vanre.gif" style="margin:10px;"></a></p>

<p>We build three maps, one showing land and buildings on the same map, one just showing land values and one just showing building
values. All three can be animated over time.</p>

<p>We normalized all dollar amounts to 2015 by adjusting for inflation. There are good reasons for going either
way, adjusting for inflation or keeping it in original dollar amounts. For this animation we felt the it was better to show
real (inflation adjusted) value growth. Keep in mind that this means is that if a property cost $1,000,000 in 2005 dollars we will
show the value for 2005 to be $1,175,686 in 2015 dollars.</p>

<h3>The Rub</h3>

<p>I find these maps much more intuitive and instructive than earlier maps I did. But it comes at a price &ndash; these maps
will give your GPU a run for it&rsquo;s money. And they are only visible on modern computers and browsers. They can be viewed
on mobile too, but don&rsquo;t try to zoom out. They eat up quite a bit of memory and may crash your mobile browser.</p>

<p>Go test how &ldquo;modern&rdquo; your computer is. It&rsquo;s kind of fun to view the houses in different areas evolve over time. Try out
the <a href="http://www.mountainmath.ca/assessment/split_map">interactive animations</a> with just the houses or with both, houses and land.</p>

<h3>Local Stories</h3>

<p><a href="http://mountainmath.ca/assessment/split_map?zoom=17&lat=49.2362&lng=-123.1365&type=1&use3D=1&year=2015" target="_blank"><img  src="http://doodles.mountainmath.ca/images/s_vanre.gif" loop="0" style="width:50%;float:left;margin-right:10px;"></a>
Zooming into these maps we can start to see the local stories of the Vancouver single family homes during the last 11 years.
Over time one sees where the land value is doing almost all of the lifting, but occasionally one sees re-development or
extensive re-modeling activity that pushes up the building value as buildings try to catch up with the sharp rise in land
value.</p>

<p>And this is really the essence of the Vancouver real estate story when viewing dirt vs buildings. The land values are rising
so fast that the building values don&rsquo;t have time to catch up. In fact, during the last year alone the aggregate land values of all single family
homes <a href="http://doodles.mountainmath.ca/blog/2016/01/24/work-vs-twiddling-thumbs/">exceeded the combined pre-tax income of all Vancouverites</a>.</p>

<p>The speed of the rise in land values is also driving the rapid re-development
of buildings as explained <a href="http://doodles.mountainmath.ca/blog/2016/01/18/redevelopment/">in an earlier post</a>.</p>

<h3>Unaffordable Dirt</h3>

<p><a href="http://mountainmath.ca/assessment/split_map?zoom=17&lat=49.2362&lng=-123.1365&type=3&use3D=1&year=2006" target="_blank"><img  src="http://doodles.mountainmath.ca/images/b_vanre.gif" loop="0" style="width:50%;float:right;margin-left:10px;"></a>
The visualizations show that Vancouver&rsquo;s &ldquo;unaffordable housing&rdquo; is really all about &ldquo;unaffordable dirt&rdquo; and not &ldquo;unaffordable houses&rdquo;.
Looking at only the houses, we see that while there are some multi-million dollar houses, most houses are very affordable. It&rsquo;s just the
dirt they sit on that is really expensive.</p>

<p>This distinction does not matter much if one is buying a house. But it does matter when making policy decisions. One way
to make housing more affordable is to reduce the impact of the land value. Converting a single detached house into a
duplex immediately cuts the land value in half. If we replace it with a 4-plex, land values go down to a quarter for each
housing unit.</p>

<h3>Dividing Dirt (Update)</h3>

<p>We added stratified residential units into the visualization so we can take a closer look what happens when we <em>divide dirt</em>,
that is when we allow more housing units on a single property. In the RT zones
the city allows duplexes or coach houses, so two stratified units on a single property. In other zones, like RM, some CD and
some commercial (mixed use) the city allows for more strata units per property. We added a unit slider that allows to
filter residential properties by how many strata units they house. If upper and lower cutoffs are set to 1, we just get single
detached properties. If both are set to 2, we get duplexes. If the slider range is 4-20 then we see all buildings with somewhere
between 4 and 20 units. Note that we did not map any purpose built rental buildings, that is residential buildings that
have more than 2 units but are not stratified.</p>

<p><a href="http://mountainmath.ca/assessment/split_map?zoom=15&lat=49.2665&lng=-123.1496&type=1&use3D=1&year=2015&units=[1,700]" target="_blank"><img  src="http://doodles.mountainmath.ca/images/m_vanre.gif" loop="0" style="width:50%;float:left;margin-right:10px;"></a>
We then use the <em>average</em> value of the land and the building per unit to map colour and height. Starting out mapping
only buildings with at least 40 units we see that the average price of a unit is solidly in the bottom color bracket for most properties.
As we slowly add in buildings with fewer units we see that only once we get down to 3 and 4-plexes do we see a clear increase
in more expensive properties on our colour scale. Adding in duplexes then leaves a clear mark with, in genreal, twice the
value of 4-plexes on a comparably sized property, and then another jump by a factor of two as we add in the single detached
properties.</p>

<p>Looking at the general condo picture, we generally see savings on a per-unit basis as we increase the number of units per property.
Those savings are most pronounced for lower unit counts and seem to flatten out once we hit around 20 units as building values
per unit stabilize and land values also rise proportionally to the unit number.</p>

<p>Some luxury developments stand out, but even there land values dominate. There are very few strata buildings where
building values exceed land values. I would be curious to hear what economists think about this, to me it looks like a sign
that land values of condo buildings are inflated because of the artificial sparsity of available land for such developments
through restrictive zoning code.</p>

<h3>Data (only if you need to know)</h3>

<p>The data used for this consist of merging four datasets. The Vancouver property boundary data set, the Vancouver
tax assessment dataset (for tax years 2006 and 2016, estimating values on July 1st of each previous year),
the Vancouver building footprint dataset (based on 2009 LIDAR data)
and the Metro Vancouver land use dataset to help identify single family homes, especially the 15% outside of RS zoned areas.
The tax assessment dataset gives an estimate of the values on July 1st of the year indicated in the visualization.</p>

<p>The datasets all have their issues and are a little out of sync. The property dataset is for a fixed point in time and
may not properly reflect the legal state of properties for all years (when for example properties were joined or split).
The tax dataset is not in all cases properly linked to the properties, in particular if the tax code changed which happens
in some but not all cases when the building gets redeveloped. There are 854 such single family home properties in Vancouver
that we can&rsquo;t trace for the whole time period. On
the map they will be visible as greyed out properties for earlier years that in later years spring to life as we can trace them.</p>

<p>Especially in the earlier years the dataset will not properly identify all single detached homes if they have been converted
to duplexes or other multi-family units in the meantime.</p>

<p>The building dataset represents a snapshot in time around
2009. We don&rsquo;t show properties that did not have a building in 2009 (767 properties, 562 of which are single detached),
and if properties have been re-built since 2009 we show the old building.
The Land Use dataset is lagging behind a bit and has for example not caught up with recent re-developments along
the Cambie corridor.</p>

<p>We also dropped 296 residential properties that did not have a land value for 2016, most lightly because they are
being re-developed and linking the assessment to the property failed.</p>

<p>The land and building value data is estimated by BC Assessment and is based on sales of comparable properties in the time before and after July 1 and
takes into account information from building permits and other evaluations. On an individual building level, especially for older buildings that
have not been sold for a long time, the data can be somewhat inaccurate at times. But in aggregate it provides a fairly
accurate snapshot of the property and building values.</p>

<p>Neither the zoning information, not the land use have been updated to catch some of these freshly developed land assemblies.
I have manually removed a good dozen obvious ones from the dataset, there are probably some more hidden in there.</p>

<p>Most of the problems stem from the fact that BCAssessment data, which has much more comprehensive and cleaner data,
is not directly accessible.</p>

<script>
function resetImages(){
    $('img').each(function(img){
        imgsrc = $(img).attr('src');
        if (imgsrc.slice(imgsrc.length-4)=='.gif') {
            $(img).attr('src', '');
            $(img).attr('src', imgsrc);
            
        }
    });
    setTimeout(function(){
        resetImages();
    },25000);
}
setTimeout(function(){
    resetImages();
},25000);
</script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[On Mixed Use]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/28/on-mixed-use/"/>
    <updated>2016-03-28T23:37:16-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/28/on-mixed-use</id>
    <content type="html"><![CDATA[<p>Redeveloping single storey commercial properties into mixed use is taking off in Vancouver right now. It&rsquo;s a little frustrating
to see how pretty much every story I have seen on this get the effect this has on property taxes wrong, including one on the generally quite good
<a href="https://pricetags.wordpress.com/2016/01/25/guest-on-retail-and-an-evolving-environment-with-a-short-historic-note/">Price Tags blog</a>. People
claim that converting single story commercial to mixed use pushes up the property taxes for the commercial tenants.
Property taxes are an important piece of the puzzle in Vancouver, so I decided to go into a little detail on this.</p>

<p>Long story short, re-developing single story commercial into mixed use lowers the commercial property taxes. Dramatically.</p>

<!-- more -->


<h3>Commercial Property Taxes</h3>

<p>In Vancouver, the commercial property tax rate is five times the residential rate. Toronto also has higher property tax
rates for commercial, 3x in their case, I don&rsquo;t know how this plays out more broadly. Nor do I know when and why these
decisions were made. Generally cities have a hard time to keep space for residential areas in or close to the central
business district, and higher property taxes may help to uphold the zoning restrictions in place and keep residential
properties in close proximity to commercial.</p>

<p>The effect of the unequal tax rates is quite stark
<a href="http://www.mountainmath.ca/assessment_gl/map">when visualizing taxes collected per area</a>. And this keeps residential
property taxes low.</p>

<p>If Vancouver were isolated from everyone else it would not make much of a difference. Stores pass the
higher property taxes on to residents by charging higher prices, and offices pass them on to employees through lower wages.
Things get more complex when Vancouver is seen as part of metro, or Canada or in the world. But that discussion goes into
a different direction.</p>

<p><a href="http://www.mountainmath.ca/assessment_gl/map" target="_blank"><img  src="http://doodles.mountainmath.ca/images/tax_density_mixed_use.png" style="width:50%;float:right;margin-left:10px;"></a>
On the <a href="http://www.mountainmath.ca/assessment_gl/map">interactive 3D tax density map</a> we can clearly see that the some mixed use properties (in darker red) generate lower total property
taxes than comparable pure commercial properties nearby. We will explore this in more detail in the next section.</p>

<p>For Vancouver it is also important to note that commercial leases are generally trip net, in particular the tenant pays
the property taxes. And they are quite substantial. The important number is the gross rent, which is the sum of rent, taxes,
utilities and other costs borne by tenants. That number is determined by the willingness of a tenant to lease the commercial
space, which in turn determines the rent a commercial landlord can charge for the space. In theory at least, in practice
some commercial landlords develop a relationship with their tenants and don&rsquo;t increase rents for old tenants as much as
the market would bear.</p>

<h3>Taxes for Commercial vs Mixed Use</h3>

<p><img  src="http://doodles.mountainmath.ca/images/w_broadway.png" style="width:50%;float:left;margin-right:10px;">
Let&rsquo;s look at and example, the adjacent properties at
3071 and 3063 W Broadway. The first is single story commercial, the latter two story mixed use. They have almost identical
lot sizes and assessed land and building values, with the mixed use property having slightly higher overall assessed value.</p>

<p>How about the property taxes? In 2015, the 2016 taxes aren&rsquo;t out yet, the single story generated $47,797 in taxes, the mixed
use only $32,031. The reason is simple. The single story property
simply pays 5x the residential rate. For mixed use, the value gets divided up between two stories, so half the value pays
5x residential rate, the other half gets taxes at 1x residential rate. So the effective tax rate for the mixed use is 3x
residential rate. Well, the actual effective rate is 3.35x residential, probably because the first floor carries a little
higher value than the second floor.</p>

<p>The net effect is that the mixed use commercial tenant pays just over half of the property taxes as the pure commercial
tenant next door. So the mixed use commercial landlord will charge exactly that much more rent, so that the gross rent
for both commercial tenants is about the same.</p>

<p>Feel free to play with the <a href="http://mountainmath.ca/map/assessment?zoom=14&amp;layer=10">tax density</a> and
<a href="http://mountainmath.ca/map/assessment?zoom=14&amp;layer=14">land use</a> map and click into properties to see a more detailed break-down of
taxes. Be warned that the land use dataset is not perfect in identifying every commercial vs mixed use place.</p>

<h3>A Re-Developmet Example</h3>

<p><img  src="http://doodles.mountainmath.ca/images/main1.png" style="width:50%;float:right;margin-left:10px;">
Let&rsquo;s see how this works when a property gets re-developed. To keep things simple, let&rsquo;s look at something that went
from single story commercial to two story mixed use. 6621 Main Street got re-developed around 2009/2010 and now spans
addresses 6615, 6621 and 6623.</p>

<p>Behind the original 6621 are now three stratified residential units, the other two addresses are the front doors for the
two commercial units that replace the two commercial units behind the original 6621 address.</p>

<p><img  src="http://doodles.mountainmath.ca/images/main2.png" style="width:50%;float:left;margin-right:10px;">
So what happened to property taxes from 2009 to 2010? In 2009 the combined tax levy was $22,102,
in 2010 it was $16,859, of which $2,994 was payed by residential stratas and $13,865 by the two commercial.</p>

<p>For comparison,
the commercial property next door saw their property tax climb lightly from $20,754 in 2009 to $20,794 in 2010. So the
decrease in property taxes we see is really due to the re-development to mixed use.</p>

<h3>Bottom Line</h3>

<p>So what&rsquo;s the bottom line for mixed use re-development? Overall it looks pretty good, let&rsquo;s go down the list of all
parties involved.</p>

<h5>City bottom line</h5>

<p>For conversion to two story mixed use, the city collects less
property taxes than before and the overall mill rate goes up a tiny amount. Conversion to three stories or higher and
total tax revenue for the property goes up and the overall mill rate goes down a tiny amount.</p>

<h5>Commercial tenant bottom line</h5>

<p>The property tax rate goes down substantially, but rent will go up as the gross rent is determined by the market. So not
much changed assuming the form factor of the stores stay the same. In theory at least. If the commercial land lord was
giving a long time tenant a break on their rent before re-development, the tenant will have a hard time to find a different
commercial location with comparable gross rent.</p>

<h5>Residential tenant bottom line</h5>

<p>Added supply can only help. In some cases units will get stratified and sold off, in other cases the property owner keeps
the residential units as rental.</p>

<h5>Property owner bottom line</h5>

<p>Especially with the recent change in lending practices that focus on cache flow, mixed use re-development becomes very attractive.
After re-development, landlords can charge higher rents because commercial property taxes go down. And they can rent out
the residential units for added cash flow. That way, when they take that property to the bank to get a loan for their
next project they can show a large cache flow and get a bigger loan. And the re-development cycle keeps going. And with
almost everyone re-financing their properties a couple of years ago at roughly the same time, when interest rates hit rock-bottom, everyone is
now gearing up at the same time to re-develop.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Surrey Traffic Loop Counts]]></title>
    <link href="http://doodles.mountainmath.ca/blog/2016/03/27/surrey-traffic-loop-counts/"/>
    <updated>2016-03-27T01:04:45-07:00</updated>
    <id>http://doodles.mountainmath.ca/blog/2016/03/27/surrey-traffic-loop-counts</id>
    <content type="html"><![CDATA[<p><a href="https://mountainmath.ca/land_use/map"><img  src="http://doodles.mountainmath.ca/images/surrey_traffic.png" style="width:50%;float:right;margin-left:10px;"></a>
Surrey published a <a href="http://data.surrey.ca/dataset/ff9c223a-57e2-49b8-900f-e4b9d9423b4b">beta version of their traffic loop counts</a>,
which is pretty awesome. Real life traffic data is very exciting, and there are lots of fun things one could do with that.
So last night I decided to take a look and make a quick map. Nothing exciting yet, just to feel may way around
what&rsquo;s there.</p>

<!-- more -->


<p>To keep things simple I again took advantage of the <a href="https://mapzen.com/projects/tangram/">awesome Tangram mapping enginge</a>
and turned it onto the traffic loop data. All I did was plot circles for each traffic loop with the area proportional to
the count. Just to get an idea what the traffic data looks like.</p>

<iframe src="http://doodles.mountainmath.ca/surrey_traffic_map.html" width="100%" height="550"></iframe>


<p><a href="http://doodles.mountainmath.ca/surrey_traffic_map.html">Full screen view</a></p>

<h3>What do we see?</h3>

<p>Really not much at this point, it&rsquo;s just a snapshot of one hour of traffic on March 24 between 9am and 10am. But it&rsquo;s pretty
obvious where to go from here. One should add some dynamic way to select the time frame. And add some animations to better
represent car traffic and the direction in which it is moving. The cool <a href="https://tangrams.github.io/carousel/?tron#15/49.1055/-122.8244">tron demo</a>
simulates traffic movement, maybe the loop count data could be massaged in a way to give a more accurate representation
of actual traffic.</p>

<p>And of course one could start to run some analysis. The fifteen minute aggregates which the server sends down are a little rough for doing some
traffic flow analysis, but I am sure that together with the lane direction information attached to the traffic loop geographic
data something interesting can be done.</p>

<h3>Hickups and feedback</h3>

<p>There were a couple of hickups along the way. The Surrey Open Data API sends down GeoJSON data in NAD 83 UTM Zone 10
instead of the default WGS84. Which is just fine, but when using the Mapzen Tangram engine we need to transform
it into WGS84. The fancy way would be to do that dynamically after directly consuming the Surrey API, but we were lazy
and just downloaded and transformed the file. So now we have the loop counter locations and can map them.</p>

<p>Next up, we want to add the traffic count data to the loop counter locations. Ideally we want to consume the Surrey open
data API and link it with the geographic loop data, but the API does not set the <code>Access-Control-Allow-Origin: *</code>
http header to allow cross-origin requests to consume the API directly from their web app. Again, no big deal when building a small
testing app, we simply downloaded the traffic loop counts for noon on March 23 and threw them up on our server.</p>

<p>Pretty smooth overall for a first run. Timestamps are a little funny, they are in local time. While easy to interpret, this
will cause problems when analysing data around daylight savings time changes.</p>

<p>Lastly we needed to add a quick hack to the Tangram mapping engine. For some reason the <a href="https://mapzen.com/documentation/tangram/sources/#transform">transform</a>
function does not get called when adding static (non-tiled) data sources. But that was easy to fix, although it took some
sloothing to track down.</p>

<p>At this point it seems that not all traffic loops are hooked up to the API yet. Going through the data, on the March 23
there are only a handful of traffic loops active, on the 24th the number of active loops jumps up significantly.
I also plotted the traffic loop locations without data (in yellow), just to give
and idea what will become available. Curious to see where this will go once out of beta mode.</p>

<h3>Want to make your own map?</h3>

<p>It&rsquo;s pretty easy. Just grab the html file from the &ldquo;full screen&rdquo; link above and download the <a href="http://doodles.mountainmath.ca/surrey_traffic_scene.yaml">Tangram scene file</a>
and add your own twist to the map. Also grab a copy of the tangram engine <a href="http://doodles.mountainmath.ca/javascripts/tangram.debug.js">with the quick-fix for the transform function</a>.</p>
]]></content>
  </entry>
  
</feed>
